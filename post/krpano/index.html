
<!DOCTYPE html>
<html lang="zh-CN">
<head>
 <meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no" />
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
<meta HTTP-EQUIV="pragma" CONTENT="no-cache">
<meta HTTP-EQUIV="Cache-Control" CONTENT="no-cache, must-revalidate">
<meta HTTP-EQUIV="expires" CONTENT="0">
<meta name="author" content="bwrong, wang11535041@qq.com"/>
<meta name="keywords" content="Krpano全景漫游开发手册 | BWrong的小站,前端,krpano,js,vue"/>
<meta name="description" content="天青色等烟雨，而我在等你"/>
<!-- <title>Krpano全景漫游开发手册 | BWrong的小站</title> -->
<title>网站搭建测试</title>
<link href="https://www.bwrong.cn/media/css/fz.css" rel="stylesheet">
<link rel="stylesheet" href="https://www.bwrong.cn/styles/main.css">
<script type="text/javascript">
function getCSS()
{
        datetoday = new Date();
        timenow=datetoday.getTime();
        datetoday.setTime(timenow);
        thehour = datetoday.getHours();

        if (thehour<5)

            display = "https://www.bwrong.cn/media/css/night.css";

       else if (thehour>20)

            display = "https://www.bwrong.cn/media/css/night.css";

        else if (thehour>5)
     
            display = "https://www.bwrong.cn/media/css/day.css";

        else if (thehour<20)

            display = "https://www.bwrong.cn/media/css/day.css";


var css = '<';
        css+='link rel="stylesheet" href='+display+' \/';
        css+='>';
        document.write(css);
}
</script>
<link href="https://at.alicdn.com/t/font_1306644_ko4c4at97is.css" rel="stylesheet" />
<script src="https://cdn.bootcss.com/jquery/3.4.1/jquery.min.js"></script>
<link rel="stylesheet" href="https://www.bwrong.cn/media/css/katex.min.css">
<script type='text/javascript' src='https://www.bwrong.cn/media/scripts/script.js'></script>
<link href="https://cdn.bootcss.com/animate.css/3.5.2/animate.min.css" rel="stylesheet" />
  <script src="https://cdn.bootcss.com/wow/1.1.2/wow.min.js"></script>
  <script src="https://cdn.bootcss.com/highlight.js/9.15.8/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>
  <script>wow=new WOW({boxClass:'wow',animateClass:'animated',offset:0,mobile:true,live:true});wow.init();</script>

<script type="text/javascript">
window.onload=getCSS();
</script>
<!-- 百度统计 -->
<script>
var _hmt = _hmt || [];
(function() {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?2c0e9e3f54ae20480b34c178578c4df8";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
})();
</script>


</head>
<body class="post-template-default single single-post postid-70 single-format-standard">
    <div id="wrapper">

	
<header id="header" class="site-header"
		
		style="background-image: linear-gradient(rgba(0, 0, 0, 0.2), rgba(0, 0, 0, 0.2)),url(https://www.bwrong.cn/post-images/krpano.jpg)"
		
		>
			<div class="site-branding">
									<h1 class="site-title"><a href="https://www.bwrong.cn" rel="home">BWrong的小站</a></h1>

					<h2 class="site-description">天青色等烟雨，而我在等你</h2>

							</div>
			<nav id="nav-wrapper">
				<div class="container">
					<div class="nav-toggle">
						<div class="bars">
							<div class="bar"></div>
							<div class="bar"></div>
							<div class="bar"></div>
						</div>
					</div>
					<div class="clear"></div>
					<ul id="" class="dove">
		 

<li>

	
		<a href="/">
		  首页
		</a>
	  

    

<li>

	
		<a href="/archives/index.html">
		  归档
		</a>
	  

    

<li>

	
		<a href="/post/about/">
		  关于
		</a>
	  

    

</ul>
</li>

</ul>				</div>
			</nav>
						<div class="jingge">


    

    

<a  href="https://github.com/BWrong" target="_blank" ><i class="iconfont icon-github"></i></a>
 
    

    

    

    

<a  href="https://juejin.cn/user/3421335914820280" target="_blank" ><i class="iconfont icon-telegram"></i></a>
 
    

    

    

    

    

    
        </header>


		<div id="content" class="container">
			<div class="row">
	<div class="col-md-8 site-main">

<article id="post-70" class="post-70 post type-post status-publish format-standard hentry category-5 tag-10 tag-9 tag-11">



		<div class="entry-content">
			<h1 data-wow-delay="0.4s"  class="wow fadeInUp entry-title">Krpano全景漫游开发手册</h1>
<div class="entry-meta">
<div class="wow fadeInUp"  data-wow-delay="0.6s">
	<i class="iconfont icon-rili"> <time class="lately-a" datetime="2017-08-17 22:35:21" itemprop="datePublished" pubdate="">2017-08-17</time></i>
	          </div>

</span>

		</div>

			<div class="wow fadeInUp entry-summary song"  data-wow-delay="0.1s">
				<p>*声明： 本文档由作者收集整理，并非全部原创，如有侵权，请联系删除！另外由于Krpano本身内容较多，不可能面面聚到，如有不足，欢迎大佬指正。</p>
<h1 id="概述">概述</h1>
<p>本文档基于版本1.19 pr14。</p>
<p>官网：<a href="https://krpano.com">地址</a></p>
<p><strong>概念</strong></p>
<p>全景漫游（英文：panorama）技术可以让体验者在全景图像构建的全景空间里切换视角的浏览。它是通过拍摄全景图像，再采用计算机图形图像技术构建出全景空间，让使用者能用控制浏览的方向，或左或右、或上或下观看物体或场景，仿佛身临其境一般。与传统的3D建模相比，全景漫游技术制作简单，数据量小，系统消耗低，且更有真实感。</p>
<p>早期270°或者360°全景漫游（柱状全景）：<br>
<img src="https://www.bwrong.cn/post-images/1566707376255.png" alt="" loading="lazy"></p>
<p>720°全景漫游：<br>
<img src="https://www.bwrong.cn/post-images/1566707383508.png" alt="" loading="lazy"></p>
<p><strong>全景图</strong></p>
<p>全景图（这里特指<strong>球面全景图</strong>）是指一种图片宽高比为<strong>2比1</strong>的包含了360°x180°空间的图片，例如8000*4000的jpg图片或tiff图片等。</p>
<p>注：宽高比2：1为水平方向（360°）：垂直方向（180°）</p>
<p><strong>Krpano简介</strong></p>
<p>krpano是一款全景漫游制作软件和工具。其具有以下特点：</p>
<ul>
<li>高度灵活、性能卓越的轻量化全景漫游浏览器。</li>
<li>兼容HTML5和Flash，支持Webgl下的WebVR展示。</li>
<li>使用专用的krpano xml代码编写全景漫游，可开发出高度定制化的项目，也可利用krpano工具开发在线全景制作及展示平台。</li>
<li>支持多种类型的全景图以及全景视频和环物全景。</li>
<li>支持多种投影模式。</li>
<li>同时提供简单高效的批处理方式，可在无需代码干预下迅速生成一个基本功能兼备的全景漫游项目。</li>
</ul>
<p><strong>如何选择</strong></p>
<p>如果只想简单展示全景，无特殊定制需求，那么可以使用默认皮肤，或者使用全景平台进行开发。<br>
如果需要开发全景平台、定制全景功能或者对全景开发有浓厚兴趣的可以学习和深入了解krpano。</p>
<p><strong>特性</strong></p>
<ul>
<li>兼容Flash和HTML5</li>
<li>高性能和高质量的渲染</li>
<li>高度可定制的</li>
<li>丰富的全景格式和图像文件格式的支持</li>
<li>多分辨率</li>
<li>三维投影</li>
<li>虚拟旅游热点/脚本</li>
<li>渐进式</li>
</ul>
<p><strong>案例展示</strong></p>
<p>见软件下载包或者<a href="https://krpano.com/examples/vtour/#top">官方网站</a><br>
<strong>资源</strong></p>
<ul>
<li><a href="https://krpano.com/">KRPANO官网</a></li>
<li><a href="https://720yun.com/">720云平台</a></li>
<li><a href="http://www.krpano.tech/">KRPANO技术解密</a></li>
<li><a href="http://www.krpano360.com/">KRPANO中文网</a></li>
</ul>
<hr>
<h1 id="文件说明">文件说明</h1>
<h2 id="下载包使用说明">下载包使用说明</h2>
<h3 id="examples文件夹">examples文件夹</h3>
<p>这是krpano的案例文件夹 <strong>（1.19的examples文件夹在viewer文件夹下）</strong>，里面包含了官方的绝大部分案例，这些案例都是学习krpano代码的很好的素材。注意下载包的案例所使用的viewer是下载包自身的默认viewer文件夹。因为你不能简单复制案例文件夹，你还需要设置一下对应viewer的路径，而且该viewer还必须是你自己的viewer。</p>
<h3 id="templates-文件夹">templates 文件夹</h3>
<p>官方一系列模版所在的文件夹，包括了图片、xml、html以及相关配置文件等。通过对这里的了解和修改，我们可以做出自己的皮肤模版，然后一键生成，实现批量的工作流。当然，正常情况下，你也无需从这里拷贝，因为在droplet过程中会自动生成。部分模版在默认droplet过程中并没有使用到。</p>
<figure data-type="image" tabindex="1"><img src="https://www.bwrong.cn/post-images/1566707587261.png" alt="" loading="lazy"></figure>
<h3 id="viewer-文件夹">viewer 文件夹</h3>
<p><img src="https://www.bwrong.cn/post-images/1566707602925.png" alt="" loading="lazy"><br>
krpano 下载包的官方插件、引擎、案例的存放位置，同时也是让案例文件夹能够正确显示的 viewer 所在的位置。其中plugins是当前版本的所有官方插件；examples是官方提供的案例。</p>
<p><strong>小贴士</strong></p>
<p>自身项目的 viewer（js和swf）会在droplet过程中自动生成无需从这里拷贝</p>
<h3 id="dropletbat-文件">droplet.bat 文件</h3>
<p>Krpano Droplets 是krpano命令行工具加上配置文件config的一个快捷方式。droplets使用方式非常简单，将文件（通常是图片或者xml等文件）直接拖放在droplet图标上松开即可。</p>
<p><img src="https://www.bwrong.cn/post-images/1566707627791.jpg" alt="" loading="lazy"><br>
krpano droplet （图中齿轮状图标文件）</p>
<p><strong>MAKE PANO (NORMAL) Droplet</strong></p>
<p>用法说明:</p>
<ul>
<li>生成普通 (=单分辨率) 全景.</li>
<li>制作典型的360度全景.</li>
<li>全部全景图将会一次性载入. 默认下方块最大边长为2048像素(可以在config配置文件中修改).</li>
<li>包括默认的导航皮肤.</li>
<li>支持Flash和HTML5.</li>
</ul>
<p>Droplet 说明:</p>
<ul>
<li>基于kmakemultires工具.</li>
<li>配置文件:<code>normal.config</code></li>
<li>默认模版/皮肤配置文件:<code>defaultbuttons.skin</code></li>
</ul>
<p><strong>MAKE PANO (MULTIRES) Droplet</strong></p>
<p>用法说明:</p>
<ul>
<li>生成多分辨率全景</li>
<li>制作所有类型的全景</li>
<li>只有特定的切片在需要时载入. 没有尺寸/分辨率限制.</li>
<li>包含默认的导航皮肤.</li>
<li>支持Flash和HTML5.</li>
</ul>
<p>Droplet 说明:</p>
<ul>
<li>基于kmakemultires工具.</li>
<li>配置文件:<code>multires.config</code></li>
<li>默认模版/皮肤配置文件:<code>defaultbuttons.skin</code></li>
</ul>
<p><strong>MAKE PANO (SINGLESWF)Droplet</strong></p>
<p>用法说明:</p>
<ul>
<li>生成普通 (=单分辨率) 全景同时将所有文件嵌在一个SWF文件中.只输出一个SWF文件和一个HTML文件.</li>
<li>制作典型的360度全景 .</li>
<li>全部全景图将会一次性载入. 默认下方块最大变长为2048像素(可以在配置文件中修改).</li>
<li>包含默认的导航皮肤.</li>
<li>仅支持Flash.</li>
</ul>
<p>Droplet 说明:</p>
<ul>
<li>基于kmakemultires工具.</li>
<li>配置文件:<code>singleswf.config</code></li>
<li>默认模版/皮肤配置文件:<code>defaultbuttons.skin</code></li>
</ul>
<p><strong>MAKE PANO (FLAT)Droplet</strong></p>
<p>用法说明:</p>
<ul>
<li>生成平面切片多分辨率图像.</li>
<li>制作平面图像. 输出时既定为平面图像.</li>
<li>只有特定的切片在需要时载入. 没有尺寸/分辨率限制.</li>
<li>包含有默认导航按钮的皮肤，针对特定的视角.</li>
<li>支持Flash与HTML5.</li>
</ul>
<p>Droplet 说明:</p>
<ul>
<li>基于kmakemultires工具</li>
<li>配置文件:<code>flat.config</code></li>
<li>默认模版/皮肤配置文件:<code>flat.xml / flatskin.xml</code></li>
</ul>
<p><strong>MAKE VTOUR (NORMAL)Droplet</strong><br>
用法说明:</p>
<ul>
<li>生成普通 (=单分辨率) 全景并将它们整合到一个虚拟漫游中.</li>
<li>制作典型的360度全景.</li>
<li>全部全景图将会一次性载入. 默认下方块最大边长为2048像素(可以在配置文件中修改).</li>
<li>包含一个包括导航按钮、可滚动缩略图以及可选择必应地图以及重力感应插件的默认皮肤.</li>
<li>支持Flash和HTML5.</li>
</ul>
<p>Droplet 说明:</p>
<ul>
<li>基于kmakemultires工具.</li>
<li>配置文件:<code>vtour-normal.config</code></li>
<li>默认模版/皮肤配置文件:<code>vtourskin-thumbnails-bingmaps-gyro.skin</code></li>
</ul>
<p><strong>MAKE VTOUR (MULTIRES)Droplet （正常生成不考虑VR的漫游推荐使用这个dropelt）</strong></p>
<p>用法说明:</p>
<ul>
<li>生成多分辨率全景并将它们整合到一个虚拟漫游中.</li>
<li>制作所有类型全景图像.</li>
<li>只有特定的切片在需要时载入. 没有尺寸/分辨率限制.</li>
<li>包含一个包括导航按钮、可滚动缩略图以及可选择必应地图以及重力感应插件的默认皮肤.</li>
<li>支持Flash和HTML5.</li>
</ul>
<p>Droplet 说明:</p>
<ul>
<li>基于kmakemultires工具.</li>
<li>配置文件:<code>vtour-multires.config</code></li>
<li>默认模版/皮肤配置文件:<code>vtourskin-thumbnails-bingmaps-gyro.skin</code></li>
</ul>
<p><strong>MAKE VTOUR (VR-OPT)droplet （正常生成带有VR的漫游推荐使用这个dropelt）</strong></p>
<p>用法说明:</p>
<ul>
<li>生成多分辨率全景并将它们整合到一个虚拟漫游中.</li>
<li>制作所有类型全景图像.</li>
<li>只有特定的切片在需要时载入. 没有尺寸/分辨率限制.</li>
<li>包含一个包括导航按钮、可滚动缩略图以及可选择必应地图以及重力感应插件的默认皮肤.</li>
<li>支持Flash和HTML5.</li>
<li>krpano 1.19 pr9后，可生成为VR优化的全景图。如果包含立体图像的输入时，会生成针对VR使用的立体图像。</li>
</ul>
<p>Droplet 说明:</p>
<ul>
<li>基于kmakemultires工具.</li>
<li>配置文件:<code>vtour-vr.config</code></li>
<li>默认模版/皮肤配置文件:<code>vtourskin-thumbnails-bingmaps-gyro.skin</code></li>
</ul>
<p><strong>MAKE OBJECTDroplet</strong></p>
<p>用法说明:</p>
<ul>
<li>生成若干个平面多分辨率图像并将它们整合到一个可缩放旋转的360物体影像中.</li>
<li>制作平面图像物体. 所有物体图片的尺寸必须一致.</li>
<li>只有特定的切片在需要时载入. 没有尺寸/分辨率限制.</li>
<li>包含一个特定的控制物体的皮肤.</li>
<li>仅支持Flash.</li>
</ul>
<p>Droplet 说明:</p>
<ul>
<li>基于kmakemultires工具.</li>
<li>配置文件:<code>object.config</code></li>
<li>默认模版/皮肤配置文件:<code>object.xml / objectskin.xml</code></li>
</ul>
<p><strong>Convert SPHERE to CUBEDroplet</strong></p>
<p>用法说明:</p>
<ul>
<li>将球面图像转换至立方体图.</li>
<li>输出的立方体格式、尺寸以及图像尺寸可以在配置文件中修改.</li>
</ul>
<p>Droplet 说明:</p>
<ul>
<li>基于ktransform 工具.</li>
<li>配置文件: <code>convertdroplets.config</code></li>
</ul>
<p><strong>Convert CUBE to SPHEREDroplet</strong></p>
<p>用法说明:</p>
<ul>
<li>将六张立方体图像转换成一张球面全景图.</li>
<li>输出的图像尺寸和格式可以在配置文件中修改.</li>
</ul>
<p>Droplet 说明:</p>
<ul>
<li>基于kcube2sphere工具.</li>
<li>配置文件: <code>convertdroplets.config</code></li>
</ul>
<p><strong>Encrypt XMLDroplet</strong></p>
<p>用法说明:</p>
<ul>
<li>将xml文件拖放进droplet进行加密.</li>
<li>加密过程中xml文件会自动被压缩.</li>
</ul>
<p>Droplet 说明:</p>
<ul>
<li>基于encrypt工具.</li>
</ul>
<p><strong>制作自定义droplet</strong></p>
<p>内置 droplets 只是针对最常见的情况的范例。制作自定义的krpano droplet是非常简单的。你只需要编辑配置文件，然后复制并重命名一个已有的krpano droplet并对droplet本身进行编辑即可。</p>
<ul>
<li>Windows下编辑krpano droplet</li>
<li>krpano droplet实际上是批处理文件 (.bat).</li>
<li>可以在任意文本编辑器下进行编辑.</li>
<li>用文本编辑器打开krpano droplet，将配置文件的名字和路径修改为你自己的配置文件.</li>
<li>Mac OSX下编辑krpano droplet</li>
<li>droplet实际上是”AppleScript Droplet’.</li>
<li>可以使用 ‘Apple Script Editor’打开</li>
<li>在 Apple Script Editor打开krpano droplet，将配置文件的名字和路径修改为你自己的配置文件.</li>
</ul>
<h3 id="两个txt文件">两个txt文件</h3>
<p>krpano授权的法律声明以及版本发行说明。</p>
<h3 id="krpanotools">krpanotools</h3>
<p>包含 32/64 位的 <code>krpanotools32.exe</code> 与 <code>krpanotools64.exe</code>，该两个文件为 krpano 项目核心，会在命令行中调用它们。</p>
<h3 id="krpano-testing-server">krpano Testing Server</h3>
<p>krpano 自带的静态文件本地服务环境，使用它可以路过本地文件案例限制来查看 Flash 与 HTML5 效果，另外它还可以控制浏览器缓存、限制下载速度模拟网络条件。</p>
<figure data-type="image" tabindex="2"><img src="https://www.bwrong.cn/post-images/1566707701462.jpg" alt="" loading="lazy"></figure>
<h3 id="krpano-tools">krpano tools</h3>
<p>用来加密保护全景项目的可视化工具，需要注册才可以使用，这里就不扩展。</p>
<figure data-type="image" tabindex="3"><img src="https://www.bwrong.cn/post-images/1566707713078.jpg" alt="" loading="lazy"></figure>
<h2 id="成果文件说明">成果文件说明</h2>
<h3 id="vtour-文件夹结构">vtour 文件夹结构</h3>
<p>以下是默认与比较基础文件结构与文件名，根据droplet的不同，文件可能更多或更少，同时文件名也并不一定和这些一样。</p>
<pre><code>vtour/
| -- panos/             #存放全景切片图片的文件夹
| -- skin/              #存放皮肤相关文件
| -- plugins/           #用来存放插件
| -- tour.swf           #krpano flash viewer
| -- tour.js            #krpano HTML5 viewer
| -- tour.xml           #生成全景的相关配置
| -- tour.html          #用来浏览全景的页面，需要本地服务环境
| -- tour_editor.html   #添加热点（hotspot）与初始化视角设置的编辑器
| -- tour_testingserver.exe #windows系统中打开测试服务器并打开html文件进行本地浏览。
| -- tour_testingserver_macos #mac系统中打开测试服务器并打开html文件进行本地浏览。
</code></pre>
<h3 id="vtour-运作机制">vtour 运作机制</h3>
<p>Krpano 是通过viewer引擎来实现浏览静态图片时产生“三维”效果，而这一切则是通过tour.html这个入口文件。</p>
<p>过滤掉一些没用的代码，可以看到入口文件主代码如下：</p>
<pre><code>&lt;div id=&quot;pano&quot;&gt;&lt;/div&gt;
&lt;script src=&quot;tour.js&quot;&gt;&lt;/script&gt;
&lt;script&gt;
    embedpano({
        swf: &quot;tour.swf&quot;, //有则表示加载flash引擎，如果设置html5:only则不需要该值
        xml: &quot;tour.xml&quot;, //启动时的配置文件
        target: &quot;pano&quot;, //要渲染到的目标容器ID
        html5: &quot;only&quot;, //如果有需要用到flash，可设置为auto
        //id: &quot;krpanoSWFObject&quot;, //默认的krpano对象，每一个viewer对应唯一id，与JS交互时要用到
        mobilescale: 1.0, //移动设备缩放，1表示不缩放，默认0.5
        passQueryParameters: false //是否接受URL传参，例如：tour.html?html5=only&amp;startscene=scene2
    });
&lt;/script&gt;
</code></pre>
<figure data-type="image" tabindex="4"><img src="https://www.bwrong.cn/post-images/1566707754822.png" alt="" loading="lazy"></figure>
<hr>
<h1 id="载入全景">载入全景</h1>
<p><strong>引入脚本（html5渲染器）</strong></p>
<pre><code>&lt;script src=&quot;./tour.js&quot;&gt;&lt;/script&gt;
</code></pre>
<p><strong>创建嵌入容器</strong></p>
<pre><code>&lt;div id=&quot;pano&quot; style=&quot;width:100%;height:100%;&quot;&gt;&lt;/div&gt;
</code></pre>
<p><strong>创建对象及配置参数</strong></p>
<pre><code class="language-js">embedpano({
    swf:&quot;krpano.swf&quot;, // flash渲染器
    xml:&quot;krpano.xml&quot;, // 主配置文件   缺省的时候会调用krpano.xml和krpano.swf  不加载设置0即可
    target:&quot;pano&quot;, // 嵌入容器id
    id:&quot;krpanoSWFObject&quot;, // 当前全景id，javascript接口调用会使用此id
    bgcolor:&quot;#000000&quot;,// 背景颜色
    html5:&quot;auto&quot;, // html5模式（auto：自动；prefer：优先使用html5；fallback：优先flash；only：只使用html5；always：始终使用html5-仅用于测试；never：始终使用flash；可加上webgl或css3d渲染技术，如auto+css3d）
    flash：&quot;auto&quot;,// flash模式（auto,prefer,fallback,only,never和html设置类似）
    wmode:&quot;window&quot;,// flash模式设置（window：窗口；opaque：不透明；opaque-flash：不透明，仅限flash；transparent：透明的；transparent-flash：透明的，仅限flash；direct：最佳性能，但可能不兼容旧系统和浏览器）
    localfallback:&quot;http://localhost:8090&quot;,
    vars:{},// 在xml加载解析后设置启动变量
    initvars：{},// 在xml加载解析前设置启动变量，可以在地址进行查询（our.html?initvars.variable=value）
    basepath:...// 基本路径 （相对于krpano.swf）
    consolelog:false,// 是否在浏览器控制台打印日志信息
    mwheel:true,// 是否启用鼠标滚轮
    focus:true,// 获得焦点
    webglsettings:{preserveDrawingBuffer:false, depth:false, stencil:false},//webgl设置
    mobilescale:0.5, // 移动设备缩放
    fakedevice:&quot;&quot;,// &quot;mobile&quot;, &quot;tablet&quot;, &quot;desktop&quot;；模拟设备 （仅限测试）
    onready:function(){},// 准备就绪回调函数，一般当javascript调用krpano接口的时候，需要在此方法内
    onerror:function(){},// 错误回调函数
    passQueryParameters:true, // 启用url查询参数（ html5, flash, wmode, mobilescale, fakedevice, initvars）作为变量传递，如tour.html?html5=only&amp;startscene=scene2&amp;initvars.design=flat
    });
</code></pre>
<p><strong>移除全景</strong></p>
<pre><code>removepano(id);
</code></pre>
<p>官网文档：<a href="https://krpano.com/docu/html">地址</a></p>
<hr>
<h1 id="krpano-xml语法">Krpano XML语法</h1>
<p><strong>krpano xml</strong></p>
<p>xml本身是一种<strong>文本传输格式</strong>，这意味着只能用于在krpano viewer内传输数据。当xml被解析时，xml元素才会被传输/映射到krpano的内部数据结构。这就是说当解析结束后，本质上就再也没有xml。</p>
<p>krpano xml 本身是xml 语言，但有着自己特定的元素和语法。krpano xml 包括静态代码和动态代码部分。</p>
<p>静态代码就是由 26 个krpano 元素（包含废弃的两个）组成的代码，它们有着自己的属性，通常属性的值都是字符串或者数字或者是布尔值，因为这些属性的默认值规定了只能用这些类型。</p>
<p>相关的数值类型包括 string （字符串）、number （浮点数）、int（整数）、boolean （布尔值， true 或者false ）。</p>
<ul>
<li>有些属性只在 Flash 下有意义，例如<code>layer[name].smoothing</code>;</li>
<li>有些属性只在 HTML 下有意义，例如<code>layer[name].jsborder</code></li>
<li>有些属性是只读属性， 你不能就这样写在上面的静态代码中， 只能通过get() 来获取其数值，<br>
如<code>layer[name].pressed 、layer[name].imagewidth 、layer[name].imageheight</code></li>
<li>还有一些属性是比较特别的，他们的数值类型是 Action Event 、也就是属性的数值实际上是填入动态代码，例如我们一开始遇到的<code>onclick =&quot;openurl('http://...');&quot;</code>，类似的还有几个 on 字辈的属性，像</li>
</ul>
<pre><code>onover =&quot;&quot;
onhover =&quot;&quot;
onout =&quot;&quot;
onclick =&quot;&quot;
ondown =&quot;&quot;
onup =&quot;&quot;
onloaded =&quot;&quot;
</code></pre>
<p><strong>xml标签/节点</strong></p>
<pre><code>&lt;element /&gt; //无子元素
&lt;element&gt;&lt;/element&gt; //有子元素
</code></pre>
<p><strong>属性</strong></p>
<p>一个xml元素可以有一个或多个属性,由属性名和属性值构成，属性值必须放在单引号或者双引号中，且属性不允许重复</p>
<pre><code>&lt;element attribute=&quot;value&quot;&gt;
   &lt;childrenelement test1=&quot;value1&quot; test2=&quot;value2&quot; /&gt;
&lt;/element&gt;
</code></pre>
<p><strong>根元素krpano</strong></p>
<p>所有元素需要位于krpano元素内部</p>
<pre><code>&lt;krpano onstart=&quot;...&quot;&gt;
   ...
   &lt;preview url=&quot;...&quot; /&gt;
   &lt;image&gt;
     &lt;cube url=&quot;...&quot; /&gt;
   &lt;/image&gt;
   ...
&lt;/krpano&gt;
</code></pre>
<p><strong>注释</strong></p>
<p>不能包含两个连字符--<br>
<code>&lt;!--  --&gt;</code><br>
<strong>大小写</strong><br>
xml元素的名称和xml属性都会被转换成小写，所以是不区分大小写的<br>
<strong>编码</strong><br>
为了避免字符编码问题，所有xml文件应保存为<code>utf-8</code>或<code>utf-16</code>文件<br>
<strong>自定义元素</strong><br>
krpano允许添加自定义的元素、允许在系统定义的元素中添加自定义属性，方便我们进行其它操作。krpano在载入xml文件解析静态代码时会忽略掉自定义元素。自定义的元素和属性除了语法上不能违反krpano的规定，在属性值设置上更为自由。<br>
<strong>其他</strong><br>
xml元素间的空格字符空格、制表符和换行符将被忽略</p>
<p>保留字，不能直接使用，需要使用转义</p>
<figure data-type="image" tabindex="5"><img src="https://www.bwrong.cn/post-images/1566707895068.png" alt="" loading="lazy"></figure>
<p>出现相同name的元素后面会覆盖前面的</p>
<p>注意：html5模式会比flash模式严格。</p>
<hr>
<p>官方文档：<br>
<a href="https://krpano.com/docu/xml/syntaxrules">地址</a></p>
<h1 id="krpano-xml内置元素">Krpano XML内置元素</h1>
<p>krpano的XML结构</p>
<pre><code>&lt;krpano&gt;
    &lt;include&gt;
    &lt;preview&gt;
    &lt;image&gt;
    &lt;view&gt;
    &lt;autorotate&gt;
    &lt;plugin&gt;
    &lt;layer&gt;
    &lt;hotspot&gt;
    &lt;events&gt;
    &lt;action&gt;
    &lt;scene&gt;
&lt;/krpano&gt;
</code></pre>
<p>krpano xml中的所有xml元素和属性是可选的,可以定义多次。 当相同的元素将再次定义两个或两个以上的时候,那么以后/声明 将会覆盖之前的。</p>
<p><code>&lt; krpano &gt;</code> 根元素内 也可以包含<code>&lt; krpano &gt;</code> 元素</p>
<p>xml本身只是一个 传送格式 ——这意味着它将只用于传送krpano view的数据。 当xml解析,那么xml元素将转换/映射到krpano内部数据结构。 这意味着xml解析后就没有了。</p>
<p>官方文档：<a href="https://krpano.com/docu/xml/#top">地址</a></p>
<h2 id="特殊属性">特殊属性</h2>
<h3 id="name">name</h3>
<pre><code>&lt;xmlelement name=&quot;...&quot; ... /&gt;
</code></pre>
<p>name属性 ⇒定义Array元素:</p>
<p>当一个xml元素有name属性,那么这个元素将被解释为元素的Array 。 neme名字的 Array 即是该元素本身。</p>
<p>当没有 Array 这个名字已经存在,它将被自动创建。</p>
<p>当元素已经存在,然后被定义 xml元素将仍然创建，但会覆盖已经存在的元素。</p>
<p><strong>名称属性名字规范：</strong></p>
<ol>
<li>必须以英文字母开始，不能使用数字，汉字开始 !</li>
<li>当一个名称仍以数字字符开始，然后将解释为Array索引名称。</li>
<li>所有名称会自动转换成小写,允许直接不分大小写访问!</li>
</ol>
<h3 id="url">url</h3>
<pre><code>&lt;xmlelement url=&quot;...&quot; ... /&gt;
</code></pre>
<p>资源路径，用于引入插件、图片、音频等。</p>
<p>更以根据需要使用下面的占位符：</p>
<pre><code class="language-js">%FIRSTXML% – //第一个载入的xml文件的路径。
%CURRENTXML% – //当前载入的主xml文件路径（非嵌入的文件）。
%SWFPATH% – //viewer文件的路径。
%HTMLPATH% - //html文件的路径。
%BASEDIR% – //使用basedir的路径。
%$VARIABLE% – //使用指定的“VARIABLE” – 这可以是任意的krpano变量，但必须当前xml或场景完全载入之前定义，例如已经存在于HTML文件中或在loadpano()、loadscene()调用之前。
</code></pre>
<h3 id="devices">devices</h3>
<pre><code>&lt;xmlelement ... devices=&quot;...&quot;&gt;
    &lt;childrenelement ... /&gt;
    ...
&lt;/xmlelement&gt;
</code></pre>
<p>如果xml元素在某个设备渲染或者忽略，可以给该元素设置devices属性，可以设置多个。它可以在每个xml元素上设置，当xml文件将被解析并转换为krpano内部数据结构时,将会检查每个xml元素的devices属性。当当前设备不匹配devices属性,那么这个xml元素及其所有子元素将被忽略。</p>
<p>运算符：</p>
<pre><code>+  .and.  且
|  .or.   或
！  no-   否
</code></pre>
<p>属性值（可以通过上面的运算符组合使用）</p>
<figure data-type="image" tabindex="6"><img src="https://www.bwrong.cn/post-images/1566707932933.png" alt="" loading="lazy"></figure>
<p>例子</p>
<pre><code>devices=&quot;all&quot;（默认）
devices=&quot;html5&quot;
devices=&quot;flash|webgl&quot;
devices=&quot;flash.or.webgl&quot;
</code></pre>
<h3 id="attributedevicecheck">attribute.devicecheck</h3>
<pre><code>&lt;xmlelement attribute.devicecheck=&quot;...&quot;
            attribute.devicecheck=&quot;...&quot;
            ...
            /&gt;
</code></pre>
<p>在不同中设置不同的属性值，属性值同device</p>
<pre><code>+  .and.  且
|  .or.   或
！  no-   否
</code></pre>
<p>例子</p>
<pre><code>scale.normal=&quot;1.0&quot;
width.desktop=&quot;200&quot;
visible.fullscreensupport=&quot;true&quot;
visible.html5.and.webgl.or.flash=&quot;true&quot;
visible.html5.and.no-webgl=&quot;false&quot;
</code></pre>
<h3 id="if">if</h3>
<pre><code>&lt;xmlelement ... if=&quot;condition&quot;&gt;
    &lt;childrenelement ... /&gt;
    ...
&lt;/xmlelement&gt;
</code></pre>
<p>根据条件渲染元素</p>
<p>例子</p>
<pre><code>embedpano({..., initvars:{design:&quot;flat&quot;}, ...});
&lt;include url=&quot;design_default.xml&quot; if=&quot;design == default&quot; /&gt;
&lt;include url=&quot;design_flat.xml&quot;    if=&quot;design == flat&quot;    /&gt;
</code></pre>
<h3 id="style">style</h3>
<pre><code>&lt;style name=&quot;stylename&quot; attributes ... /&gt;
&lt;xmlelement ... style=&quot;stylename&quot; ... /&gt;
</code></pre>
<p>调用styleneme属性集，并应用到该元素，优先级低于行间，可用行间属性覆盖</p>
<p>例子</p>
<pre><code>&lt;style name=&quot;spotstyle&quot; url=&quot;spotimage.png&quot; /&gt;
&lt;hotspot name=&quot;spot1&quot; style=&quot;spotstyle&quot; ... /&gt;
&lt;hotspot name=&quot;spot2&quot; style=&quot;spotstyle&quot; ... /&gt;
</code></pre>
<h3 id="get-calc">get、calc</h3>
<pre><code>&lt;xmlelement attribute=&quot;get:variable&quot; ... /&gt;
&lt;xmlelement attribute=&quot;calc:expression&quot; ... /&gt;
</code></pre>
<p>获取、计算属性值</p>
<p>例子：</p>
<pre><code>&lt;settings width=&quot;100&quot; height=&quot;50&quot; /&gt;
...
&lt;layer ...
       width=&quot;get:settings.width&quot;
       height=&quot;calc:settings.height * 2&quot;
       /&gt;
</code></pre>
<h3 id="keep">keep</h3>
<p>场景之间的转换时（包括场景内外的切换），layer元素、hotspot元素以及events元素是否保留，默认为false。</p>
<p>注：</p>
<ul>
<li>我们平常实际上每个项目开始时都是先从scene之外到scene内，所以一开始就有场景的切换。因此说，你写在scene外面的layer元素、hotspot元素以及event元素，你应该设置一个keep=”true”，才能够让场景切换时这些元素或事件不会移除。</li>
<li>静态元素会继承父元素的keep属性；动态创建的为false，不会继承。</li>
</ul>
<h2 id="krpano">krpano</h2>
<p>krpano 根元素,当xml进入解析数据结构阶段，会将该标签移除，你可以在当前krpano内定义另外的krpano</p>
<pre><code>&lt;krpano version=&quot;1.19&quot;     //版本号
        onstart=&quot;&quot;         //进入漫游时，xml加载和解析后执行的动作
        basedir=&quot;%FIRSTXML%&quot; //设置程序根目录
        bgcolor=&quot;&quot;      //全景播放器的背景色，不设置则为透明
        idletime=&quot;0.5&quot;  //无用户交互操作的多长时间后执行onidle动作
        colorcorrection=&quot;default&quot; //改变Flashplayer 10的色彩修正设置(Flash only)　可选的值：default、on、off
        logkey=&quot;true&quot;     //当为Ture时，按O可查看log日志
        strict=&quot;false&quot;			//严格代码模式
        showerrors=&quot;true&quot;  //是否输出错误信息
        debugmode=&quot;false&quot;  //当为True时，显示来自插件中的trace(0,text)中的text信息
    &gt;
    ...
&lt;/krpano&gt;
</code></pre>
<p>krpano作为XML文件唯一根元素，必须设置！</p>
<p><strong>进阶提示</strong> – 当xml进入解析数据结构阶段，则主标签“krpano”将被移除。所以你可以在当前krpano标签内定义另一个krpano元素，定义新的设置或重新定义先前的设置。</p>
<p>样例：</p>
<pre><code>&lt;krpano&gt;
&lt;!-- 仅仅使用网格预览全景(节约下载空间--&gt;
&lt;preview type=&quot;grid(cube,16,16,512,0xCCCCCC,0xFFFFFF,0x999999);&quot;
details =&quot;16&quot; /&gt;
&lt;/krpano&gt;
</code></pre>
<p><code>grid(type，xsteps，ysteps，res，lincol，bkcol，pntcol)</code> 可选参数： xsteps =行像素之间的水平距离，默认= 10 ysteps =行像素之间的垂直距离，默认= 10 res =解决 gridimage，默认= 400 lincol = hex-format 线条的颜色(默认= 0 x666666) bkcol =背景颜色(默认= 0 x222222) pntcol =点的颜色(默认= linecolor)</p>
<pre><code>&lt;krpano version=&quot;1.17&quot; onstart=&quot;loadscene(scene1);&quot;&gt;
  &lt;scene name=&quot;scene1&quot;&gt;
  ...
  &lt;/scene&gt;
&lt;/krpano&gt;
</code></pre>
<h2 id="preview">preview</h2>
<p>preview 预览图设置，指定一张全景预览图，以便在读取过程中，过渡显示，即全景完全载入之前的模糊图像，一般自动生成</p>
<pre><code>&lt;preview type=&quot;&quot;                   //全景图的类型（SPHERE，CYLINDER，CUBESTRIP，grid(type,xsteps,ysteps,res,linecol,bgcol,pntcol) ）
         url=&quot;previewpano.jpg&quot;  //全景图路径
         striporder=&quot;LFRBUD&quot;       //定义图像顺序
         details=&quot;16&quot;              //图像细节质量调整，越大越清晰
         /&gt;
</code></pre>
<p>样例：</p>
<pre><code>&lt;preview url=&quot;pano_preview.jpg&quot; /&gt;
&lt;preview type=&quot;grid(CUBE,16,16,512,0xCCCCCC,0xFFFFFF,0x999999);&quot; /&gt;
&lt;preview type=&quot;SPHERE&quot; url=&quot;spherepreview.jpg&quot; details=&quot;16&quot; /&gt;
&lt;preview type=&quot;CUBESTRIP&quot; url=&quot;cspreview.jpg&quot; /&gt;
</code></pre>
<h2 id="image">image</h2>
<p>*image全景图设置，包括全景图类型、渐进分辨率切片显示等</p>
<pre><code>&lt;image type=&quot;CUBE&quot;                //全景图类型（六面体）CUBE、CUBESTRIP、SPHERE、CYLINDER
       tiled=&quot;false&quot;              //是否使用平铺图像
       tiledimagewidth=&quot;...&quot;      //平铺图像宽度
       tiledimageheight=&quot;...&quot;     //平铺图像高度
       tilesize=&quot;...&quot;             //平铺图像大小
       baseindex=&quot;1&quot;             // 图像读取默认索引数字(第一个)
       frames=&quot;1&quot;                 //当前图像帧数
       frame=&quot;1&quot;
       prealign=&quot;&quot;                //prealign,采用X|Y|Z轴对齐方式
       hfov=&quot;&quot;                    //水平视野
       vfov=&quot;&quot;						//垂直视野
       multires=&quot;&quot;                   //多级精度
    	multiresthreshold=“0.025”
       stereo=&quot;&quot;                   // 立体
        stereolabels=&quot;&quot;
        stereoformat=&quot;&quot;
        fisheye.fov=&quot;&quot;				//鱼眼
	fisheye.align=&quot;&quot;
	fisheye.crop=&quot;&quot;
	fisheye.lenscp=&quot;&quot;
    voffset=“0.0” //垂直偏移度
    progressive=“false” //多分辨率加载（仅限flash）
    cubelabels=“u‘b r f l | | | | | d‘”
    sphere.mapping  //定义/投影球面输入图像的映射（仅限html5）
    mjpegstream    //mjpeg流(只支持HTML5和WebGL)
 &gt;
    &lt;cube url=&quot;pano_%s.jpg&quot; /&gt;
&lt;/image&gt;
</code></pre>
<p>以上是数字索引方式读取切片图片，以下是通过定义六个方向的图片路径读取切片，文件后缀要加上<code>_l</code>，<code>_f</code>方式来识别。<br>
相关方法</p>
<pre><code>image.layer   仅限as3 usage
image.level.count   只读
level[..].tiledimagewidth
level[..].tiledimageheight
level[..].tilesize
level[..].aspreview
</code></pre>
<pre><code>&lt;image type=&quot;CUBE&quot;
       tiled=&quot;false&quot;
       tiledimagewidth=&quot;...&quot;
       tiledimageheight=&quot;...&quot;
       tilesize=&quot;...&quot;
       baseindex=&quot;1&quot;
       frames=&quot;1&quot;
       frame=&quot;1&quot;
       prealign=&quot;&quot;
 &gt;
    &lt;left  url=&quot;pano_l.jpg&quot; rotate=&quot;0&quot; flip=&quot;&quot; /&gt;
    &lt;front url=&quot;pano_f.jpg&quot; rotate=&quot;0&quot; flip=&quot;&quot; /&gt;
    &lt;right url=&quot;pano_r.jpg&quot; rotate=&quot;0&quot; flip=&quot;&quot; /&gt;
    &lt;back  url=&quot;pano_b.jpg&quot; rotate=&quot;0&quot; flip=&quot;&quot; /&gt;
    &lt;up    url=&quot;pano_u.jpg&quot; rotate=&quot;0&quot; flip=&quot;&quot; /&gt;
    &lt;down  url=&quot;pano_d.jpg&quot; rotate=&quot;0&quot; flip=&quot;&quot; /&gt;
&lt;/image&gt;
</code></pre>
<p>例子</p>
<pre><code>&lt;image&gt;
    &lt;cube url=&quot;pano_%s.jpg&quot; /&gt;
&lt;/image&gt;
</code></pre>
<!--  -->
<pre><code>&lt;image&gt;
    &lt;cubestrip url=&quot;cubestrip.jpg&quot; /&gt;
&lt;/image&gt;
</code></pre>
<!--  -->
<pre><code>&lt;image type=&quot;SPHERE&quot; multires=&quot;true&quot; tilesize=&quot;...&quot;&gt;
  &lt;level tiledimagewidth=&quot;...&quot; tiledimageheight=&quot;...&quot;&gt;
    &lt;sphere url=&quot;pano_%v_%h.jpg&quot; /&gt;
  &lt;/level&gt;
&lt;/image&gt;
</code></pre>
<!--  -->
<pre><code>&lt;image type=&quot;CYLINDER&quot; multires=&quot;true&quot; tilesize=&quot;...&quot;&gt;
  &lt;level tiledimagewidth=&quot;...&quot; tiledimageheight=&quot;...&quot;&gt;
    &lt;cylinder url=&quot;pano_%v_%h.jpg&quot; /&gt;
  &lt;/level&gt;
&lt;/image&gt;
</code></pre>
<!--  -->
<pre><code>&lt;image&gt;
    &lt;fisheye url=&quot;fisheye.jpg&quot; fov=&quot;180.0&quot; /&gt;
&lt;/image&gt;
</code></pre>
<!--  -->
<pre><code>&lt;image type=&quot;CYLINDER&quot; hfov=&quot;1.0&quot; multires=&quot;true&quot; tilesize=&quot;...&quot;&gt;
  &lt;level tiledimagewidth=&quot;...&quot; tiledimageheight=&quot;...&quot;&gt;
    &lt;cylinder url=&quot;image_%v_%h.jpg&quot; /&gt;
  &lt;/level&gt;
&lt;/image&gt;
</code></pre>
<!--  -->
<pre><code>&lt;plugin name=&quot;video&quot;
        url.flash=&quot;videoplayer.swf&quot;
        url.html5=&quot;videoplayer.js&quot;
        videourl=&quot;video.m4v|video.webm&quot;
        /&gt;
&lt;image&gt;
    &lt;sphere url=&quot;plugin:video&quot; /&gt;
&lt;/image&gt;
</code></pre>
<h2 id="view">view</h2>
<p>view 元素控制全景的视野，例如起始位置、视域范围、可缩放范围、是否限制，限制观看的区域等等。当要设置限制视角或设定特定的初始视角时，需要自行设定或使用插件获取代码。</p>
<p>观看方向由hlookat/vlookat属性定义，当前视场由fov属性定义。要限定部分全景的视场，可以使用limitview属性。</p>
<pre><code class="language-js">&lt;view hlookat=&quot;0.0&quot;    //水平视角  -180 至  180 之间
      vlookat=&quot;0.0&quot;    //垂直视角  -90  至  90  之间
      camroll=&quot;0.0&quot;    //镜头旋转视角
      fovtype=&quot;VFOV&quot;   //定义视场角类型

//•vfov - 垂直视场，基于屏幕的高度
//•HFOV -水平视野，基于屏幕宽度
//•DFOV -看对角线场，基于屏幕的对角线
//•MFOV -最大的视场（动态混合vfov和HFOV）

//注意：在手机和平板设备的默认值将MFOV！


      fov=&quot;90.0&quot;        //默认视角的缩放
      hfov=&quot;&quot; //当前水平视野（只读）
			vfov=&quot;&quot; //当前垂直视野（只读）
      fovmin=&quot;1.0&quot;      //默认视角缩放最大值
      fovmax=&quot;179.0&quot;   // 默认视角缩放最小值
      maxpixelzoom=&quot;&quot;  // 默认视角最大缩放倍数
      mfovratio=&quot;1.333333&quot; //最大的屏幕尺寸的宽高比例
      distortion=&quot;0.0&quot;				//鱼眼视角失真设置 0.0 至  1.0 之间（扭曲程度）
      fisheye=&quot;0.0&quot;     //鱼眼视角设置 0.0 至  1.0 之间（扭曲程度）（旧）
      distortionfovlink=&quot;0.5&quot;//	fov值与鱼眼视角的关联值，默认0.5(0.0-3.0之间)
      fisheyefovlink=&quot;0.5&quot;  //fov值与鱼眼视角的关联值，默认0.5(0.0-3.0之间)（旧）
      stereographic=&quot;true&quot; //是否启动立体鱼眼投影效果（小行星）
      pannini=&quot;0.0&quot;       //设置“Pannini / vedutismo”投影效果
      architectural=&quot;0.0&quot;   //建筑视角设置 0.0 至  1.0 之间
      architecturalonlymiddle=&quot;true&quot;  //是否只对中间区域的图像实行建筑投影
      limitview=&quot;auto&quot;    //视角限制类型

//•off--不限制在所有
//•auto--自动限制（默认）
//•lookat--限制查看变量直接“hlookatmin”，“hlookatmax”，“vlookatmin”，“vlookatmax”
//•range--限制的地区设置由“hlookatmin”，“hlookatmax”，“vlookatmin”，“vlookatmax”，只有在这个范围内，允许观察
//•fullrage--的地区设置由“hlookatmin”，“hlookatmax”，“vlookatmin”，“vlookatmax”，但允许放大看到整个图像
//•offrange---限制的地区设置由“hlookatmin”，“hlookatmax”，“vlookatmin”，“vlookatmax”，但不以任何方式限制缩放。


      hlookatmin=&quot;&quot;   //最小水平视角范围  (-180 .. +180).
      hlookatmax=&quot;&quot;   //最大水平视角范围  (-180 .. +180).
      vlookatmin=&quot;&quot;   //最小垂直视角范围  (-90 .. +90).
      vlookatmax=&quot;&quot;   //最大垂直视角范围  (-90 .. +90).
      hlookatrange=&quot;&quot; //(只读)  当前最大水平范围（等同于 hlookatmax - hlookatmin）
	vlookatrange=&quot;&quot;//（只读）当前最大垂直范围(等同于vlookatmax - vlookatmin)
      /&gt;
</code></pre>
<p>默认视角的参数设置和视角限制设置</p>
<p>样例：</p>
<p>normal:</p>
<pre><code>&lt;view hlookat=&quot;0&quot; vlookat=&quot;0&quot; fov=&quot;80&quot; /&gt;
</code></pre>
<p>little planet view:</p>
<pre><code>&lt;view hlookat=&quot;0&quot;
      vlookat=&quot;90&quot;
      fisheye=&quot;1.0&quot;
      stereographic=&quot;true&quot;
      fov=&quot;150&quot;
      fovmax=&quot;150&quot;
      /&gt;
</code></pre>
<p>flat pano:</p>
<pre><code>&lt;view hlookat=&quot;0&quot;
      vlookat=&quot;0&quot;
      maxpixelzoom=&quot;1.0&quot;
      limitview=&quot;fullrange&quot;
      /&gt;
</code></pre>
<h2 id="area">area</h2>
<p>area 全景图在浏览器中的显示区域大小， 定义全景图像展示的区域/窗口。有两种定义区域位置和尺寸的模式：</p>
<ul>
<li>通过定义尺寸和位置 (mode=align)</li>
<li>定义边界边距 (mode=border)</li>
</ul>
<p>可在onresize事件中动态改变/调整这些设定。如果在onresize事件之外改动了area设置，那么在下一次屏幕刷新时候将会调用一个onresize事件，对于新的区域/窗口尺寸作出回应。</p>
<p><strong>注意</strong> – 所有的<code>&lt;layer&gt; / &lt;plugin&gt;</code>元素都要放在这个区域内。如果要把<code>&lt;layer&gt; / &lt;plugin&gt;</code>元素放在区域外面，需设置layer/plugin的STAGE属性。</p>
<p><strong>对齐方式:</strong></p>
<pre><code class="language-js">&lt;area mode=&quot;align&quot;           //定义区域的模式，排列align和边界border两种　可选的值：align、border
      align=&quot;lefttop&quot;    //排列对齐时[X,Y]的坐标参考系　可选的值：lefttop、left、leftbottom、top、center、bottom、righttop、right、rightbottom
      x=&quot;0&quot;                  //基于排列方式偏移的X坐标
      y=&quot;0&quot;                  //基于排列方式偏移的y坐标
      width=&quot;100%&quot;           //区域宽度，可以是像素值也可以是百分比
      height=&quot;100%&quot;          //区域高度，可以是像素值也可以是百分比
      /&gt;
</code></pre>
<p><strong>边界填充模式:</strong></p>
<pre><code class="language-js">&lt;area mode=&quot;border&quot;         // 定义区域的模式：边界
      left=&quot;0&quot;           //距左边的像素数
      top=&quot;0&quot;                //距顶部的像素数
      right=&quot;0&quot;              //距右边的像素数
      bottom=&quot;0&quot;             //距底部的像素数
      /&gt;
</code></pre>
<p>样例：</p>
<pre><code>&lt;area align=&quot;center&quot; width=&quot;640&quot; height=&quot;480&quot; /&gt;
&lt;area mode=&quot;border&quot; top=&quot;10&quot; bottom=&quot;100&quot; /&gt;
&lt;area x=&quot;25%&quot; width=&quot;75%&quot; /&gt;
&lt;events onresize=&quot;fixaspectresize(16,9);&quot; /&gt;
</code></pre>
<h2 id="display">display</h2>
<p>*display 全景图显示品质，定义渲染的质量和性能</p>
<p><strong>html5状态下显示质量设置</strong></p>
<pre><code class="language-js">&lt;display  stereo=&quot;false&quot;  //立体
         stereooverlap=&quot;0.0&quot;
			hardwarelimit=&quot;&quot;      //限制只对目标硬件输出
             // • Desktop(桌面) with WebGL - 4096
              //• Desktop with CSS3D - 2560
             // • Android / BlackBerry / Kindle / Windows Phone - 1024
             // • iPad - 1024
             // • iPhone (Retina) with iOS 5.1 (or higher) - 1024
             // • iPhone 5/5S and higher - 1024
             // • iPhone (Retina) with iOS below 5.1 - 800
             // • iPod (Retina) - 640
             // • iPhone / iPod Touch (Non-Retina) - 600
         usedesktopimages=&quot;&quot;   // 设置是否在PC桌面使用html5输出
         mipmapping=&quot;auto&quot;      //定义切片输出模式，可选的值：auto、force、off
         loadwhilemoving=&quot;auto&quot; //控制在移动时平滑显示模式（auto\true\false）
         framebufferscale=&quot;1.0&quot;   //调整/规模WebGL帧缓冲区的大小。
/&gt;
</code></pre>
<p><strong>flash状态下显示质量设置</strong></p>
<pre><code class="language-js">&lt;display fps=&quot;60&quot;               //flash播放时的帧速率，默认为60（30-100）
         details=&quot;24&quot;           //细碎程度,数值越高,Flash渲染越细腻(Flash only)
         tessmode=&quot;-1&quot;          //设置Flash材质排列方式,-1表示自动(球体时为0;立方体时为3)(Flash only)　可选的值：-1、1、2、3、4、5
         movequality=&quot;LOW&quot;      //移动时呈现质量(Flash only)　可选的值：LOW、HIGH、BEST、HIGHSHARP
         stillquality=&quot;HIGH&quot;   //静止时呈现质量(Flash only)　可选的值：LOW、HIGH、BEST、HIGHSHARP
         flash10=&quot;on&quot;           //启动flash10渲染，该项启动后上两项（movequality、stillquality）设置无效
         movequality10=&quot;HIGH&quot;  //移动时呈现质量(Flash10使能时有效)(Flash only)　可选的值：LOW、HIGH、BEST、HIGHSHARP
         stillquality10=&quot;HIGH&quot;  //静止时呈现质量(Flash10使能时有效)(Flash only)　可选的值：LOW、HIGH、BEST、HIGHSHARP
         sharpen=&quot;12&quot;           //图像锐化程度,仅当影像品质为HIGHSHARP时有效,值域0-14(Flash only)
         stilltime=&quot;0.25&quot;      // 从 “移动改变到静止”之前的等待时间(Flash only)
         showpolys=&quot;false&quot;      //显示3D几何形状线条(Flash only)
         /&gt;
</code></pre>
<p>样例：</p>
<pre><code>&lt;display flash10=&quot;off&quot; details=&quot;28&quot; /&gt;
&lt;display flash10=&quot;off&quot; stillquality=&quot;HIGHSHARP&quot; /&gt;
&lt;display html5rendermode=&quot;1&quot; devices=&quot;iPad+Retina&quot; /&gt;
&lt;display hardwarelimit=&quot;512&quot; devices=&quot;Android&quot; /&gt;
&lt;display usedesktopimages=&quot;true&quot; hardwarelimit=&quot;1800&quot; devices=&quot;iPad+Retina+iOS6&quot; /&gt;

</code></pre>
<h2 id="control">control</h2>
<p>control 设置鼠标、键盘及触摸设备对全景浏览的控制方式</p>
<pre><code class="language-js">&lt;control usercontrol=&quot;all&quot;   //用户控制方式（all,mouse,keyb,off）
         mouse=&quot;drag&quot;				//控制方式（drag，moveto，drag3d（仅限flash））
         touch=&quot;drag&quot;				//控制方式（drag，moveto，drag3d（仅限flash））
         dragrelative=&quot;true&quot;	//参数设置
         draginertia=&quot;0.1&quot;			//惯性
         dragfriction=&quot;0.9&quot;			//摩擦力
         drag_oldmode=&quot;false&quot;		//旧模式（html5）
         movetorelative=&quot;true&quot;    //参数设置
         movetoaccelerate=&quot;1.0&quot;		//加速度
         movetospeed=&quot;10.0&quot;			//最大速度
         movetofriction=&quot;0.8&quot;			//摩擦力
         movetoyfriction=&quot;1.0&quot;		//垂直摩擦力
         keybaccelerate=&quot;0.5&quot;		//加速度
         keybspeed=&quot;10.0&quot;				//速度
         keybfriction=&quot;0.9&quot;					//摩擦力
         keybinvert=&quot;false&quot;					//反转
         keybfovchange=&quot;0.75&quot;		//按钮改变视角
         mousefovchange=&quot;1.0&quot;		//鼠标滚轮改变视角
         fovspeed=&quot;3.0&quot;		//改变视角速度
         fovfriction=&quot;0.9&quot;	//改变摩擦力
         zoomtocursor=&quot;false&quot; //放大
         zoomoutcursor=&quot;true&quot;	//缩小
         touchzoom=&quot;true&quot;	//手势缩放
         keycodesleft=&quot;37&quot;	// 左键
         keycodesright=&quot;39&quot; //右键
         keycodesup=&quot;38&quot; //上键
         keycodesdown=&quot;40&quot;  //下键
         keycodesin=&quot;&quot; //放大键
         keycodesout=&quot;&quot; //缩小键
         keydownrepeat=&quot;true&quot;  //连续按键
         bouncinglimits=&quot;false&quot; //反弹（仅限html5）
         /&gt;
</code></pre>
<pre><code>&lt;control mouse=&quot;drag&quot;
         touch=&quot;drag&quot;
         dragrelative=&quot;true&quot;
         draginertia=&quot;0.1&quot;
         dragfriction=&quot;0.9&quot;
         movetorelative=&quot;true&quot;
         movetoaccelerate=&quot;1.0&quot;
         movetospeed=&quot;10.0&quot;
         movetofriction=&quot;0.8&quot;
         keybaccelerate=&quot;0.5&quot;
         keybspeed=&quot;10.0&quot;
         keybfriction=&quot;0.9&quot;
         keybfovchange=&quot;0.75&quot;
         mousefovchange=&quot;1.0&quot;
         fovspeed=&quot;3.0&quot;
         fovfriction=&quot;0.9&quot;
         zoomtocursor=&quot;false&quot;
         zoomoutcursor=&quot;true&quot;
         touchzoom=&quot;true&quot;
         bouncinglimits=&quot;false&quot;
         /&gt;
</code></pre>
<ul>
<li>mouse、touch</li>
<li>drag - drag the pano image.</li>
<li>moveto - move the pano image.</li>
<li>drag3d - free-axis 3d dragging (Flash only)</li>
</ul>
<p>鼠标键盘的控制设置</p>
<p>样例：</p>
<pre><code>
&lt;control mousetype=&quot;drag2D&quot; /&gt;
&lt;cursors url=&quot;drag-cursors.png&quot;
         type=&quot;drag&quot;
         move=&quot;2|0|30|32&quot;
         drag=&quot;37|0|30|32&quot;
         /&gt;
&lt;control mousetype=&quot;moveto&quot; /&gt;
&lt;cursors url=&quot;arrow-cursors.png&quot;
         type=&quot;4way&quot;
         move=&quot;112|0|28|28&quot;
         drag=&quot;112|0|28|28&quot;
         arrow_r=&quot;0|0|28|28&quot;
         arrow_d=&quot;28|0|28|28&quot;
         arrow_l=&quot;56|0|28|28&quot;
         arrow_u=&quot;84|0|28|28&quot;
         /&gt;
</code></pre>
<h2 id="cursors">cursors</h2>
<p>cursors 鼠标光标样式<br>
html5可以使用 standard, dragging and moving 调用系统样式，flash模式可以自定义图片</p>
<pre><code class="language-js">&lt;cursors  standard=&quot;default&quot; // 标准
         dragging=&quot;move&quot; // 拖动
         moving=&quot;move&quot;  //移动
		url=&quot;&quot;            //光标图片地址
         type=&quot;8way&quot;       //光标方向模式，是4个方向移动更换图片，还是8个方向移动都更换图片（drag，4way，8way）
         move=&quot;&quot;           //设定光标移动时显示图片
         drag=&quot;&quot;           //设定鼠标按下时显示图片
         arrow_l=&quot;&quot;        //以下是8个方向移动时对应显示的鼠标图片
         arrow_r=&quot;&quot;
         arrow_u=&quot;&quot;
         arrow_d=&quot;&quot;
         arrow_lu=&quot;&quot;
         arrow_ru=&quot;&quot;
         arrow_ld=&quot;&quot;
         arrow_rd=&quot;&quot;
         /&gt;
</code></pre>
<p>自定义光标的样式<br>
样例：</p>
<pre><code>&lt;control mousetype=&quot;drag2D&quot; /&gt;
&lt;cursors url=&quot;drag-cursors.png&quot;
         type=&quot;drag&quot;
         move=&quot;2|0|30|32&quot;
         drag=&quot;37|0|30|32&quot;
         /&gt;
&lt;control mousetype=&quot;moveto&quot; /&gt;
&lt;cursors url=&quot;arrow-cursors.png&quot;
         type=&quot;4way&quot;
         move=&quot;112|0|28|28&quot;
         drag=&quot;112|0|28|28&quot;
         arrow_r=&quot;0|0|28|28&quot;
         arrow_d=&quot;28|0|28|28&quot;
         arrow_l=&quot;56|0|28|28&quot;
         arrow_u=&quot;84|0|28|28&quot;
         /&gt;
</code></pre>
<h2 id="autorotate">autorotate</h2>
<p>autorotate 自动旋转</p>
<pre><code class="language-js">&lt;autorotate enabled=&quot;false&quot;     //是否开启自动旋转
            waittime=&quot;1.5&quot;     // 用户不对屏幕操作后，开始自动旋转的等待时间
            accel=&quot;1.0&quot;         //旋转加速度：角度/秒
            speed=&quot;10.0&quot;        //自动旋转速度：角度/秒
            horizon=&quot;0.0&quot;      //例如-45表示向上45度仰视;45表示向下45度俯视
            tofov=&quot;off&quot;         //缩放到特定的视区
            zoomslowdown=&quot;true&quot;   //相对于当前的缩放/视场速度，减慢自动旋转速度，以获得相同的视觉速度在所有的缩放距离。
            interruptionevents=&quot;userviewchange|layers|keyboard&quot;  //定义哪些事件将中断自动旋转(以及onidle事件)，可以组合
            /&gt;
</code></pre>
<p>相关属性</p>
<pre><code class="language-js">autorotate.isrotating  //是否旋转状态（只读）
autorotate.ispaused	//是否停止状态（只读）
</code></pre>
<p>相关设置方法，事件</p>
<pre><code class="language-js">autorotate.start()  //直接开始自动旋转(无需等待 autorotate.waittime)
autorotate.stop()	//停止当前自动旋转并且禁用它
autorotate.interrupt() //中断自动旋转，但自动旋转功能自身仍然可用，会再过 autoratate.waittime 后自再次开始
autorotate.pause()	//暂停自动旋转。例如当鼠标划过某个热点时就有必要让旋转暂停下来
autorotate.resume() //重启刚才暂停的旋转
</code></pre>
<pre><code>onautorotatestart,
onautorotatestop,
onautorotateoneround
onautorotatechange
</code></pre>
<p>当无用户交互时．自动旋转、扭曲／移动，缩放</p>
<pre><code class="language-js">//开始旋转：
set(autorotate.enabled,true);
//停止旋转：
set(autorotate.enabled,false);
//交替旋转：
switch(autorotate.enabled);
</code></pre>
<p>样例：</p>
<pre><code>&lt;autorotate enabled=&quot;true&quot; /&gt;
&lt;autorotate enabled=&quot;true&quot;
            waittime=&quot;5.0&quot;
            speed=&quot;-3.0&quot;
            horizon=&quot;0.0&quot;
            tofov=&quot;120.0&quot;
            /&gt;
</code></pre>
<h2 id="pluginlayer">plugin/layer</h2>
<p>plugin/layer功能相同， 可以调用插件，也可插入图片或容器，类似div ，习惯系统插件用plugin，插入图片视频或容器用layer</p>
<p>注：parent及keep属性会自动继承父元素的对应属性</p>
<pre><code class="language-js">&lt;plugin name=&quot;...&quot;        //定义引入的元素名称
       type=&quot;image&quot;      // 引入元素的类型，可以为image、container、text（textfield），container为容器，可在容器内继续引入多个媒体元素
       url=&quot;...&quot;          //引入元素的路径（支持格式：SWF, JPG, PNG, GIF.）
       html=&quot;&quot;				//显示文字时的内容
       keep=&quot;false&quot;       //是否在跳入新场景时仍然保留显示该元素
       parent=&quot;&quot;         // 设置父容器名称，可以直接是 plugin的name,也可以是全称：parent=&quot;layer[name]&quot;或parent=&quot;hotspot[name]&quot;
       alturl=&quot;&quot;          //引入元素的路径（支持格式：SWF, JPG, PNG, GIF.），只在html5浏览器使用
       devices=&quot;all&quot;      //设置显示的设备类型（详见设备列表）
       visible=&quot;true&quot;     //设置插入元素是否可见
       enabled=&quot;true&quot;     //设置插入元素是否接受鼠标事件
       handcursor=&quot;true&quot;  //鼠标移动该元素上时，是否变为小手
       maskchildren=&quot;false&quot;  //设置是否将子控件变为蒙板，设置为TRUE后，除子控件范围显示外，子控件边框与父控件边框之间区域将不显示
       scalechildren=&quot;false&quot; //设置是否子空间跟随父控件一同缩放
       zorder=&quot;&quot;              //插入元素的次序索引，可以是字符也可以是数字，html5输出必须是0-100整数
       capture=&quot;true&quot;		//只是该元素接受事件，false时子元素也可接受事件
       children=&quot;true&quot;    //启用当前元素的子元素来接收鼠标事件。
       preload=&quot;false&quot;	//预加载，在加载pano之前先加载图层/插件的url，然后执行任何操作。
       blendmode=&quot;normal&quot;  //混合/混合模式（ normal, layer, screen, add, subtract, difference, multiply, overlay, lighten, darken, hardlight, invert）仅flash
       style=&quot;&quot;               //调用已在文件中定义好的style的名称
       align=&quot;&quot;               //元素在屏幕对齐方式，lefttop, left, leftbottom, top, center, bottom, righttop, right, rightbottom （见示意图）
       edge=&quot;&quot;                //元素的边缘或描点层对齐方式，lefttop, left, leftbottom, top, center, bottom, righttop, right, rightbottom （见示意图）
       x=&quot;&quot;                   //对齐边界到对齐点的X横向距离
       y=&quot;&quot;                   //对齐边界到对齐点的y横向距离
       ox=&quot;&quot;				//偏移
       oy=&quot;&quot;				//偏移
       rotate=&quot;0.0&quot;           //插入元素显示时旋转度数
       width=&quot;&quot;               //插入元素的显示宽度(prop:自适应)
       height=&quot;&quot;              //插入元素的显示高度
       minwidth=&quot;0&quot;
		maxwidth=&quot;0&quot;
		minheight=&quot;0&quot;
		maxheight=&quot;0&quot;
        autowidth=&quot;false&quot;  //根据内容自适应宽度
        autoheight=&quot;false&quot; //根据内容自适应高度
       scale=&quot;1.0&quot;            //插入元素的缩放比例
       pixelhittest=&quot;false&quot;   //仅flash
       smoothing=&quot;true&quot;   //平滑  仅flash
       accuracy=&quot;0&quot;         //精度
       alpha=&quot;1.0&quot;            //插入元素的不透明度
       autoalpha=&quot;false&quot;   //自动透明度
       usecontentsize=&quot;false&quot;  //满画布  仅flash
       scale9grid=&quot;&quot;    //定义9格网格（scale9grid=&quot;x-position|y-position|width|height|prescale*&quot;）
       crop=&quot;&quot;                //定义元素坐标及宽高  crop=&quot;x-position|y-position|width|height&quot;
       onovercrop=&quot;&quot;          //设置元素鼠标移到上方后的坐标及宽高
       ondowncrop=&quot;&quot;          //设置元素鼠标按下状态后的坐标及宽高
       mask=&quot;&quot;   // 遮罩  仅flash
       effect=&quot;&quot;    //位图效果适用于层/插件的形象     仅flash
       background=&quot;&quot;  //可以设置false 去掉背景
       bgcolor=&quot;0x000000&quot;      //type=&quot;container&quot;状态下的背景颜色，非container状态下无效
       bgalpha=&quot;0.0&quot;          // 背景不透明度
       bgborder=&quot;0&quot;       //（bgborder=&quot;widths color alpha&quot;）边框
       bgroundedge=&quot;0&quot;   //圆角
       bgshadow=&quot;&quot;     //（基本：bgshadow=&quot;xoffset yoffset blur color alpha&quot;；高级：gshadow=&quot;xoffset yoffset blur spread color alpha inset, ...&quot;）阴影
       bgcapture=&quot;false&quot;      // 是否捕抓在背景容器上事件（type=&quot;container&quot;状态下生效）
       onover=&quot;&quot;              // 鼠标在经过上方时执行动作
       onhover=&quot;&quot;              //鼠标停在上方时执行动作
       onout=&quot;&quot;                //鼠标停移出范围时时执行动作
       onclick=&quot;&quot;              //鼠标停点击时执行动作
       ondown=&quot;&quot;            //   鼠标按下时执行动作
       onup=&quot;&quot;                 //鼠标按键松开时执行动作
       onloaded=&quot;&quot;            // 加载元素完成后执行动作
	background=&quot;false&quot;
	backgroundcolor=&quot;0xFFFFFF&quot;
	backgroundalpha=&quot;1.0&quot;
    border=&quot;false&quot;
    bordercolor=&quot;0x000000&quot;
    borderalpha=&quot;1.0&quot;
    borderwidth=&quot;1.0&quot;
           roundedge=&quot;0&quot;
           shadow=&quot;0.0&quot;
           shadowrange=&quot;4.0&quot;
           shadowangle=&quot;45&quot;
           shadowcolor=&quot;0x000000&quot;
           shadowalpha=&quot;1.0&quot;
           textshadow=&quot;get:skin_settings.design_text_shadow&quot;
           textshadowrange=&quot;6.0&quot;
           textshadowangle=&quot;90&quot;
           textshadowcolor=&quot;0x000000&quot;
           textshadowalpha=&quot;1.0&quot;/&gt;
</code></pre>
<p><strong>相关方法</strong></p>
<pre><code class="language-js">layer.layer
layer.count    //layer数量（只读）
layer[name].index //索引（只读）
layer[name].imagewidth  //图片宽（只读）
layer[name].imageheight //（只读）
layer[name].pixelwidth // 宽（只读）
layer[name].pixelheight //高（只读）
layer[name].pixelx //x坐标（只读）
layer[name].pixely //y坐标（只读）
layer[name].loading=&quot;false&quot;//（只读）  是否正在加载
layer[name].loaded=&quot;false&quot;//（只读） 是否加载完成
layer[name].loadedurl//（只读） 加载的url
layer[name].hovering=&quot;false&quot;//（只读） 是否hover
layer[name].pressed=&quot;false&quot;//（只读）  是否按下
layer[name].loader  //加载器
layer[name].sprite
layer[name].loadstyle(stylename) // 加载属性集
layer[name].registercontentsize(width、height)  //设置宽高
layer[name].resetsize() // 尺寸改变回调
layer[name].updatepos() //更新回调
layer[name].changeorigin(align,edge) //更新对齐、边缘
layer[name].getfullpath() //返回完整路径 (仅plugininterface)
</code></pre>
<p><strong>载入其他flash程序，图片或者按钮，图标</strong><br>
样例：</p>
<pre><code>&lt;layer name=&quot;logo&quot;
       url=&quot;logoimage.png&quot;
       align=&quot;rightbottom&quot; x=&quot;20&quot; y=&quot;20&quot;
       onclick=&quot;openurl('http://...');&quot;
       /&gt;
       &lt;layer name=&quot;imagebar&quot; type=&quot;container&quot; width=&quot;100%&quot; height=&quot;200&quot; align=&quot;leftbottom&quot; bgcolor=&quot;0x000000&quot; bgalpha=&quot;0.5&quot;&gt;
  &lt;layer name=&quot;item1&quot; url=&quot;image1.jpg&quot; align=&quot;left&quot; x=&quot;10&quot; /&gt;
  &lt;layer name=&quot;item2&quot; url=&quot;image2.jpg&quot; align=&quot;left&quot; x=&quot;110&quot; /&gt;
  &lt;layer name=&quot;item3&quot; url=&quot;image3.jpg&quot; align=&quot;left&quot; x=&quot;210&quot; /&gt;
&lt;/layer&gt;
</code></pre>
<p><strong>插入html标签</strong></p>
<pre><code>&lt;layer name=&quot;fullscreen_btn_text&quot; style=&quot;btn_text&quot; html=&quot;[h1 class='demo'] 全屏 [/h1]&quot; onclick=&quot;togglefullscreen()&quot;/&gt;
</code></pre>
<figure data-type="image" tabindex="7"><img src="https://www.bwrong.cn/post-images/1566708119345.png" alt="" loading="lazy"></figure>
<h2 id="hotspot">hotspot</h2>
<p>热点，可在 3D 空间中插入图片，使之随着 3D 空间一同运动，可制作很多特效。</p>
<ul>
<li>一般热点：</li>
</ul>
<pre><code class="language-js">&lt;hotspot name=&quot;...&quot;            //  定义热点名称
         type=&quot;image&quot;             //定义热点类型，image，text（textfield.）
         url=&quot;...&quot;                //热点图像路径，支持SWF, JPG, PNG, GIF
         alturl=&quot;...&quot;             //html5状态下显示的图像路径
         keep=&quot;false&quot;             //是否在下一场景跳转后保持显示
         renderer=&quot;webgl&quot;    //渲染方式  webgl、css3d
         devices=&quot;all&quot;           // 支持设备类型
         visible=&quot;true&quot;         //  是否可见
         enabled=&quot;true&quot;          // 设置热点是否接收鼠标事件
         handcursor=&quot;true&quot;       // 设置是否鼠标移到上面显示小手
         maskchildren=&quot;false&quot;     //设置是否将子控件变成蒙板
         zorder=&quot;&quot;               // 插入元素的次序索引，可以是字符也可以是数字，html5输出必须是0-100整数
         zorder2=&quot;0.0&quot;            //（仅html5）设置为0.0和1.0，分别对应当前热点在扭曲控件之下和之上
         capture=&quot;true&quot;         //  与enabled配合使用，都为true只对热点传递动作，capture=&quot;false&quot;可对子控件传递动作
         children=&quot;true&quot;         // 设置子控件是否接收热点鼠标事件
         blendmode=&quot;normal&quot;    //   设置混合模式，可选：normal, layer, screen, add, subtract, difference, multiply, overlay, lighten, darken, hardlight, invert.
         mipmapping=&quot;false&quot;   // 热点图像应该mip-mapped期间呈现缩小时(例如避免混淆) 仅html5
         premultiplyalpha=&quot;false&quot;  //  透明通道   仅html5
         style=&quot;&quot;              //   读入已设置好的style名称
         ath=&quot;0.0&quot; atv=&quot;0.0&quot;    //  球坐标
         edge=&quot;center&quot;           // 热点的边界对齐点
         ox=&quot;0&quot;                   //边界到对齐点的偏移量
         oy=&quot;0&quot;
         zoom=&quot;false&quot;           //  设置是否场景缩放时，热点跟随缩放
         distorted=&quot;false&quot;   //  设置热点是否跟随场景进行3D扭曲
         rx=&quot;0.0&quot; ry=&quot;0.0&quot; rz=&quot;0.0&quot;  三维旋转度，distorted=&quot;true&quot;可用
         depth=&quot;1000&quot;        //  深度  仅html5
         tx=&quot;0.0&quot; ty=&quot;0.0&quot; tz=&quot;0.0&quot;  // 三维偏移量
         details=&quot;8&quot;               //热点显示的细节数量，默认为8 仅flash
         inverserotation=&quot;false&quot; //  设置是否逆向旋转3D扭曲
         flying=&quot;0.0&quot;            //  自动设置ath/atv/scale的值，0.0-1.0，1.0热点将被锁定在屏幕中间，高度1000
         scaleflying=&quot;true&quot;   // 当热点从pano-space-size到screen-space-size是否缩放
         width=&quot;&quot; height=&quot;&quot;     //   设置热点宽高
         scale=&quot;1.0&quot;              // 设置热点缩放
         rotate=&quot;0.0&quot;             // 设置热点旋转角度
         pixelhittest=&quot;false&quot;    //  是否启动精确像素测试   仅flash
         smoothing=&quot;true&quot;     //     设置缩放时，是否平滑化处理
         accuracy=&quot;1&quot;            //  设置像素渲染值（flash下）
         accuracy2=&quot;1&quot;            // 设置精度控制（html5下）
         alpha=&quot;1.0&quot;               //设置透明度
         autoalpha=&quot;false&quot;        // 设置是否自动变更透明度
         usecontentsize=&quot;false&quot;   // 是否使用用户指定flash大小，默认false原始大小
         scale9grid=&quot;&quot;            // 定义是否支持矢量缩放，scale9grid=&quot;x-position|y-position|width|height|prescale*&quot;
         stereo=&quot;&quot;       			 //	SBS，TB  仅html5和WebGL
         crop=&quot;&quot;                 //  定义元素坐标及宽高  crop=&quot;x-position|y-position|width|height&quot;
         onovercrop=&quot;&quot;          // 设置元素鼠标移到上方后的坐标及宽高
         ondowncrop=&quot;&quot;         //  设置元素鼠标按下状态后的坐标及宽高
         scalechildren=&quot;false&quot;   // 子元素是否跟随缩放
         mask=&quot;&quot;                  //mask=&quot;name&quot;  mask=&quot;layer[name]&quot;  mask=&quot;hotspot[name]&quot;
         effect=&quot;&quot;                //热点位图效果3种：glow(color,alpha,range,strength);
                                  dropshadow(depth,angle,color,range,strength);
                                  blur(radius);

         onover=&quot;&quot;              //  鼠标在经过上方时执行动作
         onhover=&quot;&quot;             //  鼠标停在上方时执行动作
         onout=&quot;&quot;                // 鼠标停移出范围时时执行动作
         onclick=&quot;&quot;              // 鼠标停点击时执行动作
         ondown=&quot;&quot;             //   鼠标按下时执行动作
         onup=&quot;&quot;                 // 鼠标按键松开时执行动作
         onloaded=&quot;&quot;            //  加载元素完成后执行动作
         /&gt;
</code></pre>
<ul>
<li>多边形热点</li>
</ul>
<pre><code class="language-js">&lt;hotspot name=&quot;...&quot;
         keep=&quot;false&quot;
         visible=&quot;true&quot;
         enabled=&quot;true&quot;
         handcursor=&quot;true&quot;
         zorder=&quot;&quot;
         capture=&quot;true&quot;
         blendmode=&quot;normal&quot;
         style=&quot;&quot;
         alpha=&quot;1.0&quot;
         autoalpha=&quot;false&quot;
         fillcolor=&quot;0xFFFFFF&quot; fillcolorhover=&quot;0xFFFFFF&quot;    //填充颜色及鼠标移上后颜色
         fillalpha=&quot;0.0&quot; fillalphahover=&quot;0.1&quot;             //填充颜色透明度及鼠标移上后颜色透明度
         borderwidth=&quot;0.0&quot; borderwidthhover=&quot;4.0&quot;      //    边界宽度及鼠标移上后边界宽度
         bordercolor=&quot;0xFFFFFF&quot; bordercolorhover=&quot;0xFFFFFF&quot;   //边界颜色及边界鼠标移上后颜色
         borderalpha=&quot;0.0&quot; borderalphahover=&quot;0.8&quot;           // 边界透明度及鼠标移上后边界透明度
         fadeintime=&quot;0.15&quot; fadeincurve=&quot;1.1&quot;            //    悬停状态变化时间及形式
         fadeouttime=&quot;0.3&quot; fadeoutcurve=&quot;0.7&quot;
         polyline=&quot;false&quot;
         onover=&quot;&quot;
         onhover=&quot;&quot;
         onloaded=&quot;&quot;
         onout=&quot;&quot;
         onclick=&quot;&quot;
         ondown=&quot;&quot;
         onup=&quot;&quot;&gt;
    &lt;point ath=&quot;...&quot; atv=&quot;...&quot; /&gt;             //多边形热点坐标
    &lt;point ath=&quot;...&quot; atv=&quot;...&quot; /&gt;
    &lt;point ath=&quot;...&quot; atv=&quot;...&quot; /&gt;
    ...
&lt;/hotspot&gt;
</code></pre>
<ul>
<li>可用方法</li>
</ul>
<pre><code class="language-js">hotspot.count    // 热点个数（只读）
hotspot.layer      //(as3 usage only)
hotspot[name].index   //索引（只读）
hotspot[name].point.count    //多边形点数   （只读）
hotspot[name].point[..].ath
hotspot[name].point[..].atv
hotspot[name].loading //（只读）  是否正在加载
hotspot[name].loaded //（只读） 是否加载完成
hotspot[name].loadedurl //（只读） 加载的url
hotspot[name].hovering //（只读） 是否hover
hotspot[name].imagewidth    //（只读） 图片宽
hotspot[name]..imageheight   // （只读）图片高
hotspot[name].pressed //（只读）  是否按下
hotspot[name].loader  // 加载器
hotspot[name].sprite   //雪碧图
hotspot[name].loadstyle(stylename)   //加载属性集
hotspot[name].resetsize()  // 尺寸改变回调
hotspot[name].getfullpath()  //返回完整路径 (仅plugininterface)
hotspot[name].getcenter(ath,atv) // 获取中心位置
</code></pre>
<h2 id="events">events</h2>
<p>events 可调用各类型的事件，如载入过程中不同阶段触发的不同行为,设置事件的响应。</p>
<p><strong>全局krpano事件:</strong></p>
<p>一个不具有name属性的<code>&lt;events&gt;</code>元素定义的事件都是全局事件。通常只有一个全局事件。当有另一个<code>&lt;events&gt;</code>标签定义相同的事件时，之前定义的同一事件就会被覆写。</p>
<p><strong>注意</strong>–当载入另一个xml文件或其他场景时，所有全局事件将保留，它们不会发生改变，除非在新的xml文件或场景中被再次定义。</p>
<pre><code class="language-js">&lt;events 	name=&quot;&quot;
			keep=&quot;false&quot;
		onenterfullscreen=&quot;&quot;        // 进入全屏时执行
        onexitfullscreen=&quot;&quot;         //退出全屏时执行
        onxmlcomplete=&quot;&quot;           //XML文件加载完成时执行
        onpreviewcomplete=&quot;&quot;     //预览图加载完成时执行
        onloadcomplete=&quot;&quot;          //全景切片加载完毕时执行
        onnewpano=&quot;&quot;                //启动新的全景场景时执行
        onremovepano=&quot;&quot;          //场景被移除时执行（加载新场景前）
        onnewscene=&quot;&quot;             //新场景加载完成时执行
        onloaderror=&quot;&quot;             //加载错误时执行，执行被设置后，屏幕将不显示默认的错误信息
        onkeydown=&quot;&quot;             //键盘按下时执行
        onkeyup=&quot;&quot;                 //键盘抬起时执行
        onclick=&quot;&quot;             //鼠标点击时执行
        onsingleclick=&quot;&quot;		 //单击
        ondoubleclick=&quot;&quot;       //双击
        onmousedown=&quot;&quot;       //当鼠标按下时执行
        onmouseup=&quot;&quot;           //当鼠标松开时执行
        onmousewheel=&quot;&quot;         //当鼠标滚轮滚动时执行
        oncontextmenu=&quot;&quot;  		 //右键菜单
        onidle=&quot;&quot;                   //无交互空闲时执行
        onviewchange=&quot;&quot;         //场景视图改变时执行（渲染开始时）
        onviewchanged=&quot;&quot;        //场景视图改变后执行（渲染完成时）
        onresize=&quot;&quot;                  //全景尺寸改变时执行
        onautorotatestart=&quot;&quot;	 //自动旋转开始时执行
        onautorotatestop=&quot;&quot;	 //自动旋转停止时执行
        onautorotateoneround=&quot;&quot;  //自动旋转一圈时执行
        onautorotatechange=&quot;&quot;   //自动旋转状态改变时执行
        /&gt;
</code></pre>
<p><strong>独立局部krpano事件:</strong></p>
<p>一个具有name属性的<code>&lt;events&gt;</code>元素定义的事件都是独立事件。它可以包含所有类型的事件，但它们不会覆写全局事件，它们是另外进行调用的。这些被“命名”的<code>&lt;events&gt;</code>元素同样具有keep属性（默认值为false）。这意味着没有keep=”true”的<code>&lt;events&gt;</code>元素在新全景载入时将会被自动移除。</p>
<p><strong>提示</strong>–命名的事件能够在不影响其他插件或xml代码的基础下在独立的插件和代码中发生作用。</p>
<pre><code>&lt;events name=&quot;...&quot; keep=&quot;false&quot;
        ... any events ...
        /&gt;
</code></pre>
<h2 id="action">action</h2>
<p>action自定义动态代码，类似js中的function 需要时才载入</p>
<pre><code class="language-js">&lt;action name=&quot;...&quot;
autorun=&quot;&quot;     //在开始自动运行
scope=&quot;global&quot;  //( global,local,parent ) 作用域类型
args=&quot;&quot;		 //参数列表
secure=&quot;false&quot;    //安全将被设置为true时,行动将由Javascript调用接口, 即使是禁用Javascript接口。
protect=&quot;false&quot;    //保护   为true变量将无法访问
type=&quot;&quot;   // secure为是否支持JS接口调用
    action1();          //动作函数名称();
    action2();
    ...
&lt;/action&gt;
</code></pre>
<p><strong>参数传递的两种方式：</strong></p>
<ol>
<li>%占位符（所有版本可用）<br>
参数可以使用“%数字” 占位符来表示，范围为  %0-%99，    %0表示action本身的名字，%1为第一个参数，%2为第二个，以此类推，在代码被解析和执行的时候占位符会被传入的值替代，如果没有传入参数，将会使用“0”替代（%0除外，它始终是表示action本身的名字），使用%符号用%%替代。</li>
<li>args变量映射（1.19-pr13+可用）。</li>
<li>可以用caller占位符来代替调用者，如<code>caller.linkedscene</code>等价<code>linkedscene</code></li>
</ol>
<pre><code>&lt;action name=&quot;test&quot; scope=&quot;local&quot; args=&quot;var1, var2, var3&quot;&gt;
  showlog();
  trace('var1=',get(var1));
  trace('var2=',get(var2));
  trace('var3=',get(var3));
&lt;/action&gt;
</code></pre>
<p>使用未传递的参数，将使用‘0’代替，每个参数将映射到action内部的一个新变量，在使用包含引号或逗号字符的值时，使用变量映射方式非常有用。在这种情况下，%占位符方式可能有问题。</p>
<p><strong>使用javascript</strong></p>
<p>通过JavaScript操作，可以直接为动作代码使用JavaScript代码。对于更复杂的事物，这可能更快，但仅可在html5中使用</p>
<pre><code>&lt;!-- 使用js，仅限html5 --&gt;
&lt;action name=&quot;...&quot; type=&quot;Javascript&quot;&gt;&lt;![CDATA[
    ...
    Javascript code
    ...
]]&gt;&lt;/action&gt;
</code></pre>
<p>定义行为．需要用脚本语言解释器解释</p>
<p>可用方法</p>
<pre><code class="language-js">ction[name].content   //获取内容
action.count    //获取数量 只读
</code></pre>
<p>样例：</p>
<pre><code>&lt;krpano onstart=&quot;intro();&quot;&gt;
  ...
  &lt;action name=&quot;intro&quot;&gt;
    lookat(0,0,90);
    wait(LOAD);
    lookto(120,10,110);
    lookto(-50,40,110);
    lookto(0,0,90);
  &lt;/action&gt;
  ...
&lt;/krpano&gt;
</code></pre>
<pre><code>&lt;action name=&quot;overaction&quot;&gt;
  tween(scale, 2.0);
  tween(alpha, 1.0);
&lt;/action&gt;
&lt;plugin name=&quot;pic1&quot; ...
        onover=&quot;overaction();&quot;
        onout=&quot;outaction();&quot;
        /&gt;
</code></pre>
<h2 id="contextmenu">contextmenu</h2>
<p>contextmenu 自定义右键菜单</p>
<pre><code class="language-js">&lt;contextmenu fullscreen=&quot;false&quot;            //是否显示[全屏]菜单项
             native=&quot;false&quot;               // 是否使用本地菜单方式，为False时将启用HTML5兼容菜单模式。(Flash only)
             versioninfo=&quot;true&quot;           // 是否显示krPano Viewer及Flash Player版本信息
             touch=&quot;true&quot;             //在触摸设备上是否可用
             customstyle=&quot;&quot;          //自定义菜单风格（仅html5）
             enterfs=&quot;Fullscreen&quot;          //进入全屏菜单文字
             exitfs=&quot;Exit Fullscreen&quot;      //退出全屏菜单文字
             &gt;
    &lt;item name=&quot;...&quot;                 //自定义项目名称
          caption=&quot;...&quot;             // 显示的标题
          enabled=&quot;true&quot;         //是否点击生效
          visible=&quot;true&quot;             //是否可见
          separator=&quot;false&quot;         // 是否显示分隔条
          showif=&quot;&quot;         // showif=&quot;view.vlookatrange GE 180&quot; 本item只在该条件为真显示
          onclick=&quot;...&quot;              //点击后执行
          /&gt;
    &lt;item name=&quot;...&quot;
          caption=&quot;...&quot;
          onclick=&quot;...&quot;
          /&gt;
    ...
&lt;/contextmenu&gt;
</code></pre>
<p>customstyle:</p>
<pre><code>customstyle=&quot;font|fontsize|lineheight|backgroundcolor|textcolor|disabled-textcolor|borderwidth|bordercolor|borderradius|shadow-x-offset|shadow-y-offset|shadow-blur-range|shadow-color|innerborder|innerbordercolor|padding-top|padding-bottom|seperator-margin|seperator-color|seperator-second-line-color|item-padding|item-borderwidth|item-bordercolor|item-borderradius|item-margin|item-hover-backgroundcolor|item-hover-bordercolor|item-hover-textcolor|item-text-left-margin|item-text-right-margin&quot;
</code></pre>
<p>相关方法：</p>
<pre><code>contextmenu.item.count
</code></pre>
<h2 id="network">network</h2>
<p>network 图像下载、缓存与解码</p>
<pre><code class="language-js">&lt;network  retrycount=&quot;2&quot;               //当服务器或网络故障时，在提示出错信息前的重试次数
         /&gt;
</code></pre>
<h2 id="memory">memory</h2>
<p>memory 内存分配，单位兆</p>
<pre><code class="language-js">&lt;memory maxmem=&quot;...&quot;    //最大内存分配
		devices=&quot;...&quot; 		//设备
/&gt;
</code></pre>
<p>maxmem默认设置：</p>
<pre><code>Flash: 350 MB
HTML5
Desktop: 150-400 MB (depending on the full screen size)
Tablet / Mobile: 50 MB (Android, Windows, Silk, Blackberry, ...)
iOS (before 7.1): 40 MB
iOS (7.1 and above): 50 MB
iPhone 4/4S: 40 MB
</code></pre>
<p>设置内存使用情况</p>
<p>样例：</p>
<pre><code>&lt;memory maxmem=&quot;350&quot; devices=&quot;Desktop+Flash&quot; /&gt;
&lt;memory maxmem=&quot;150&quot; devices=&quot;Desktop+HTML5&quot; /&gt;
&lt;memory maxmem=&quot;50&quot;  devices=&quot;Mobile|Tablet&quot; /&gt;
&lt;memory maxmem=&quot;40&quot;  devices=&quot;iOS&quot; /&gt;
&lt;memory maxmem=&quot;50&quot;  devices=&quot;iOS7.1&quot; /&gt;
</code></pre>
<h2 id="security">security</h2>
<p>security flashplayer和html5相关的安全/跨域设置</p>
<pre><code class="language-js">&lt;security cors=&quot;&quot;&gt;                                             //设置是否开启跨网络认证，off\anonymous\use-credentials
    &lt;crossdomainxml url=&quot;&quot; /&gt;       //设置加载文件的url    （仅flash）
    &lt;allowdomain domain=&quot;&quot; /&gt;              //允许被访问的域名设置    只读
&lt;/security&gt;
</code></pre>
<h2 id="lensflareset">lensflareset</h2>
<p>定义一个镜头光晕样式，用于lensflare 元素调用（仅限flash）</p>
<pre><code class="language-js">&lt;lensflareset name=&quot;.&quot; url=&quot;%SWFPATH%/krpano_default_flares.jpg&quot;&gt;    //定义样式名称，指定灯光照片
    &lt;flare pixsize=&quot;128&quot;         // 耀斑大小设置
           pixupos=&quot;0&quot;            //耀斑水平像素位置
           pixvpos=&quot;0&quot;            //耀斑垂直像素位置
           color=&quot;0xFFFFFF&quot;       //耀斑颜色
           pos=&quot;0.0&quot;              //耀斑起始位置
           scale=&quot;0.1&quot;           // 耀斑相对于屏幕的大小比值（0.01-0.10）
           /&gt;
    &lt;flare ... /&gt;
    &lt;flare ... /&gt;
    ...
&lt;/lensflareset&gt;
</code></pre>
<p>相关方法：</p>
<pre><code>lensflareset[name].index
lensflareset[name].flare.count
lensflareset[name].flare[…].index
</code></pre>
<h2 id="lensflare">lensflare</h2>
<p>定义一个镜头光晕（仅限flash）</p>
<pre><code class="language-js">&lt;lensflare name=&quot;...&quot;               //定义名称
           set=&quot;DEFAULT&quot;           // 设置默认样式，还是已定义的lensflareset样式
           visible=&quot;true&quot;          //是否可见
           keep=&quot;false&quot;             //是否在场景切换时持续显示
           ath=&quot;0.0&quot;                //全景中球体坐标的水平位置
           atv=&quot;0.0&quot;                //全景中球体坐标的垂直位置
           size=&quot;0.8&quot;               //耀斑大小设置
           blind=&quot;0.6&quot;             // 耀斑盲点大小
           blindcurve=&quot;4.0&quot;         //耀斑曲线强度设置
           /&gt;
</code></pre>
<p>相关方法：</p>
<pre><code>lensflare.count
lensflare[name].index
</code></pre>
<h2 id="data">data</h2>
<p>data  可以放置任何数据，krpano不会解析其内容，整个data元素的内容将被存储在<code>data[neme]</code>对象中。需要时才载入</p>
<pre><code>&lt;data name=&quot;...&quot;&gt;
    ...
&lt;/data&gt;
</code></pre>
<p>避免xml解析CDATA:</p>
<pre><code> &lt;data name=&quot;...&quot;&gt;&lt;![CDATA[
    ...
]]&gt;&lt;/data&gt;
</code></pre>
<ul>
<li>所有data元素的个数 <code>data.count</code></li>
<li>索引 <code>data[name].index</code></li>
<li>内容<code>data[name].content</code></li>
</ul>
<p>CDATA避免xml解析,包裹的内容不会被解析:</p>
<pre><code>&lt;![CDATA[
    ...
]]&gt;
</code></pre>
<h2 id="scene">scene</h2>
<p>scene 场景，可以放置任何元素，在任何情况都不会被解析或使用，除非在被loadscene调用时才会载入浏览器解析，在浏览器载入xml文件时，不会加载其内容和属性，相当于一个封闭的集装箱，对浏览器而言，它只知道其属性。</p>
<p>使用loadpano()载入外部xml文件时，当前定义过的scene元素将被移除。</p>
<p>可以在scene元素中存储任何自定义属性——viewer本身会忽略这些属性，但可以用自定义action使用这些元素。</p>
<pre><code class="language-js">&lt;scene name=&quot;...&quot; onstart=&quot;&quot;&gt;    //onstart 场景开始渲染时加载action
    ...
&lt;/scene&gt;
</code></pre>
<p>内容</p>
<pre><code>scene[name].content
scene.count
scene[name].index
scene.onstart
</code></pre>
<p>样例：</p>
<pre><code>&lt;scene name=&quot;scene_1&quot; onstart=&quot;&quot; heading=&quot;0.0&quot; lng=&quot;103.76300000&quot; title=&quot;t1&quot; thumbx=&quot;75&quot; lat=&quot;31.51229500&quot; thumburl=&quot;panos/1.tiles/thumb.jpg&quot; thumby=&quot;10&quot;&gt;
    &lt;view fovtype=&quot;DFOV&quot; maxpixelzoom=&quot;2.0&quot; fov=&quot;90&quot; vlookat=&quot;-80&quot; fisheye=&quot;0.35&quot; hlookat=&quot;0&quot; fovmin=&quot;70&quot; fovmax=&quot;140&quot; limitview=&quot;range&quot; hlookatmin=&quot;-90&quot; hlookatmax=&quot;90&quot;/&gt;
    &lt;preview url=&quot;panos/1.tiles/preview.jpg&quot; /&gt;
    &lt;image multires=&quot;true&quot; tilesize=&quot;512&quot; type=&quot;CUBE&quot; progressive=&quot;false&quot;&gt;
        &lt;level tiledimageheight=&quot;1592&quot; tiledimagewidth=&quot;1592&quot;&gt;
            &lt;cube url=&quot;panos/1.tiles/%s/l2/%v/l2_%s_%v_%h.jpg&quot; /&gt;
        &lt;/level&gt;
        &lt;level tiledimageheight=&quot;796&quot; tiledimagewidth=&quot;796&quot;&gt;
            &lt;cube url=&quot;panos/1.tiles/%s/l1/%v/l1_%s_%v_%h.jpg&quot; /&gt;
        &lt;/level&gt;
        &lt;mobile&gt;
            &lt;cube url=&quot;panos/1.tiles/mobile_%s.jpg&quot; /&gt;
        &lt;/mobile&gt;
    &lt;/image&gt;
    &lt;hotspot atv=&quot;-7.482&quot; name=&quot;spot1&quot; style=&quot;skin_hotspotstyle&quot; ath=&quot;32.158&quot; linkedscene=&quot;scene_22&quot; /&gt;
&lt;/scene&gt;
</code></pre>
<h2 id="style-2">style</h2>
<p>style 属性集合，类似css中的class样式</p>
<pre><code>&lt;style name=&quot;...&quot;
   ... any plugin or hotspot or self defined attributes ...
   // 插入 plugin 或 hotspot 或 自定义属性
/&gt;
&lt;style name=&quot;skin_glow&quot;
   ondown=&quot;copy(skin_lockglow,name); skin_buttonglow(get(name)); if(ondown2, ondown2() );&quot;
   onover=&quot;if(skin_lockglow === null, copy(skin_lockglow,name); skin_buttonglow(get(name),0.3) ); &quot;
   onout=&quot;if(skin_lockglow === name, ifnot(pressed, skin_buttonglow(null);delete(skin_lockglow); ));&quot;
   onup=&quot;if(hovering, skin_buttonglow(get(name),0.3), skin_buttonglow(null);delete(skin_lockglow); ); if(onup2, onup2() );&quot;
/&gt;
</code></pre>
<p>获取style中的某个属性加global：</p>
<pre><code>trace(global.style[mystyle].bgborder);
</code></pre>
<h2 id="include">include</h2>
<p>include元素可以用来加载和导入其他xml文件，krpano在解析xml文件前，它会搜索所有include的xml元素，然后加载对应的xml内容，将其插入到当前xml文件并替换include元素。当所有<code>&lt;include&gt;</code>加载解析完成,那么主要的xml才开始解析。</p>
<pre><code>&lt;include url=&quot;path/name-of-the-other-xml-file.xml&quot; /&gt;
&lt;include url=&quot;skin/vtourskin.xml&quot; /&gt;
&lt;include url=&quot;%SWFPATH%/global.xml&quot; /&gt;
</code></pre>
<p><code>&lt;action&gt; / &lt;data&gt; / &lt;scene&gt;</code> 都是特殊的元素，在xml解析时将被忽略。这些元素的内容将作为字符串存储在变量中。</p>
<h2 id="progress废弃">progress（废弃）</h2>
<p>progress 载入进度（废弃）,官方不再将其作为内置元素写进文档</p>
<pre><code class="language-js">&lt;progress showload=&quot;auto&quot;

//设置进度条样式  none or auto or bar(...)，

bar(origin,width,height,offsetx,offsety,style,backcolor,loadcolor,decodecolor,bordercolor,borderwidth,glowcolor,glowwidth)

          showwait=&quot;loopings()&quot;       //显示等待中程序模式 none or auto or loopings(...)
          showreloads=&quot;false&quot;         //是否在新场景重新显示滚动条
          parent=&quot;&quot;                   //设置父元素名称和路径
          /&gt;
</code></pre>
<h2 id="textstyle废弃">textstyle（废弃）</h2>
<p>textstyle 针对showtext的第三个参数的文本样式（废弃），新版showtext.xml</p>
<pre><code class="language-js">&lt;textstyle name=&quot;...&quot;                       //定义样式名称
           font=&quot;Times&quot;                     //定义文字字体
           fontsize=&quot;12.0&quot;                  //定义文字大小
           bold=&quot;true&quot;                      //是否粗体
           italic=&quot;false&quot;                   //是否斜体
           background=&quot;true&quot;                //是否加载文字背景
           backgroundcolor=&quot;0xFFFFFF&quot;       //背景颜色
           border=&quot;true&quot;                    //是否加载边框
           bordercolor=&quot;0x000000&quot;          // 边框颜色
           textcolor=&quot;0x000000&quot;             //文字颜色
           alpha=&quot;1.0&quot;                      //文字不透明度
           blendmode=&quot;normal&quot;              // 选择混合模式： &quot;normal&quot;, &quot;add&quot;, &quot;difference&quot;, &quot;multiply&quot;, &quot;screen&quot;
           effect=&quot;&quot;                        //选择加载特效
          // •glow(color,alpha,range,strength);
          // •dropshadow(depth,angle,color,range,strength);
          // •blur(radius);

           origin=&quot;cursor&quot;                // 文本原点位置 cursor(鼠标光标)，lefttop, left, leftbottom,top, center, bottom, righttop, right, rightbottom
           edge=&quot;bottom&quot;                   //底部阴影效果
           textalign=&quot;none&quot;              //  文本对齐方式 none, left, center, right
           xoffset=&quot;0&quot;                     //文本原点位置X轴偏移量
           yoffset=&quot;-3&quot;                    //文本原点位置Y轴偏移量
           showtime=&quot;0.1&quot;                 // 显示文本的时间
           fadetime=&quot;0.0&quot;                  //文本淡出显示时间
           fadeintime=&quot;0.0&quot;                //文本淡入显示时间
           noclip=&quot;true&quot;                  // 是否避免文字超出屏幕边缘
           /&gt;
</code></pre>
<p>定义文本样式，只在flash播放情况下有效</p>
<p>样例：</p>
<pre><code>&lt;textstyle name=&quot;DEFAULT&quot;
           font=&quot;Arial&quot; fontsize=&quot;12&quot;
           bold=&quot;true&quot; italic=&quot;true&quot;
           textcolor=&quot;0x000000&quot;
           background=&quot;false&quot; border=&quot;false&quot;
           blendmode=&quot;layer&quot;
           effect=&quot;glow(0xFFFFFF,0.85,4,4);dropshadow(2,45,0x000000,4,1);&quot;
           origin=&quot;cursor&quot; edge=&quot;bottom&quot;
           xoffset=&quot;15&quot; yoffset=&quot;-5&quot;
           showtime=&quot;0.1&quot; fadeintime=&quot;0.1&quot; fadetime=&quot;0.1&quot;
           /&gt;
</code></pre>
<h1 id="action脚本语法">action脚本语法</h1>
<h2 id="语法及使用">语法及使用</h2>
<p><code>actionname(parameters); ...</code></p>
<ul>
<li>语法格式：动作名(参数);</li>
<li>动作名可以为以下几种:</li>
</ul>
<ol>
<li>内置的krpano动作名…</li>
<li>在xml任何地方定义的action元素名…</li>
<li>包含动作代码的变量/属性名。</li>
</ol>
<ul>
<li>不在引号内（单或双引号字符）的空白字符（如空格，制表，新行）将被忽略。</li>
<li>可以同时编写若干条动作，只需在每条动作尾部加上';'字符。</li>
<li>动作将被逐条执行。</li>
<li>在动作调用之间及参数之间的空白(如空格、tabs以及换行)将被忽略。</li>
<li>参数数量取决于被调用的动作实体。</li>
<li>参数之间需要使用逗号','来分开。</li>
<li>要想在参数中使用空白或逗号，那么参数就需要用单引号或双引号进行封闭。</li>
<li>所有给定参数都视为字符。当使用变量名作为参数时，不会被自动解析为对应值。一些动作可以自动处理变量名参数，但是那要依赖与动作体本身。要想使用变量作为参量来传递，必须使用get动作。注 - 一些动作可以自动解析变量参数的值，但这仅限少数动作的自身特性。</li>
</ul>
<h2 id="表达式">表达式</h2>
<p>表达式将被使用在：if语句；条件循环(for,loop)语句；和 calc 动作中。用于判断逻辑条件是否成立，计算数学表达式或拼接字符串。</p>
<ul>
<li>基本语法：a 操作符 b</li>
<li>其中a或b项可以是变量，值或字符串。</li>
<li>操作符可以是下表罗列之一。</li>
<li>运算顺序取决于具体的操作符，但在等价操作符内运算顺序是从左向右。</li>
<li>可以使用括号实现一个自定义运算顺序 - 例如：（a 操作符 b）操作符（c 操作符 d）</li>
</ul>
<figure data-type="image" tabindex="8"><img src="https://www.bwrong.cn/post-images/1566708315399.png" alt="" loading="lazy"></figure>
<pre><code>.GT. 大于
.GE. 大于或等于
.LT. 小于
.LE. 小于或等于
.EQ. 等于
.NE. 不等于 .AND. 逻辑与
.OR. 逻辑或
.NOT. 逻辑非
.EQV. 逻辑等
.NEQV. 逻辑不等
运算符优先级由高到低顺序为:()→**→*或/→+或-→.GT.或.GE.或.LT.或.LE.或.EQ.或.NE.→.NOT.→.AND.→.OR.→.EQV.或.NEQV
</code></pre>
<h2 id="数组">数组</h2>
<ul>
<li>每个xml带name的元素是一个数组的 element / item。</li>
<li>xml元素的名称是数组的名称和名称属性定义数组元素的名称/项目。</li>
<li>一个数组在krpano总是一个对象数组。</li>
<li>这样的数组项对象可以包含任何类型的自定义属性/属性。</li>
<li>数组可以预先定义或定义在运行时动态地设置一个数组项值,当第一次设置项值,然后自动将创建一个数组。</li>
</ul>
<p><em><strong>静态XML语法: (在定义在xml结构)</strong></em><br>
<code>&lt;array_name name=&quot;item_name&quot; value=&quot;...&quot; /&gt;</code></p>
<p><em><strong>动态行为的语法: (当访问或设置在运行时)</strong></em><br>
<code>array_name[item_name].value</code><br>
<strong>数组可用方法：</strong></p>
<pre><code>count    统计
sortby(attribute, parameters*)    排序
removearrayitem(name or index)   移除
</code></pre>
<h2 id="事件">事件</h2>
<pre><code>onclick:鼠标点击

onover:鼠标经过

onhover:鼠标停留

onout:鼠标移开

ondown:鼠标按下

onup:鼠标抬起
</code></pre>
<h2 id="count">count</h2>
<p><code>lensflareset[name].flare.count</code></p>
<h2 id="index">index</h2>
<p><code>lensflareset[name].flare[...].index</code></p>
<hr>
<p>官方文档：<a href="https://krpano.com/docu/actions/#top">地址</a></p>
<h2 id="全局变量">全局变量</h2>
<h3 id="版本">版本</h3>
<p><strong>version：</strong>（只读）版本信息</p>
<p><strong>xmlversion：</strong>（只读）xml版本</p>
<p><strong>build：</strong>（只读）构建时间</p>
<h3 id="鼠标-键盘">鼠标、键盘</h3>
<p><strong>mouse.x</strong>   （只读）相对于区域，坐标原点为area的左上角</p>
<p><strong>mouse.y</strong> （只读）</p>
<p><strong>mouse.stagex</strong>  （只读）相对于屏幕，坐标原点为screen的左上角</p>
<p><strong>mouse.stagey</strong>  （只读）</p>
<p><strong>mouse.downx</strong>  （只读）相对于区域，存贮最后一次鼠标按下时的位置(右键或右键)，该值以area的左上角为原点。</p>
<p><strong>mouse.downy</strong>  （只读）</p>
<p><strong>mouse.clickx</strong>  （只读）相对于区域</p>
<p><strong>mouse.clicky</strong>（只读）</p>
<p><strong>keycode：</strong> 0 （只读）  键码</p>
<p><strong>wheeldelta：</strong> 0（只读）滚轮的标准滚动值，在大多数系统上通常为 +3(前滚) 或 -3(后滚)</p>
<p><strong>wheeldelta_raw：</strong> Number.NaN<br>
（只读）未缩放未取整前的原始滚动值，注意：在flash模式下，仅当在窗口模式(非全屏)且使用默认embedding脚本时才有效；而在html5下，始终有效。</p>
<p><strong>wheeldelta_touchscale：</strong> 0.0 （只读）虽然触摸设备没有鼠标滚轮，但是当双指缩放时，仍然可能触发onmousewheel事件，该变量将提供相对的比例缩放详细信息。</p>
<p>注意： 仅适用于触摸设备！在其他装置上的值将永远是0。</p>
<h3 id="屏幕信息设置">屏幕信息/设置</h3>
<p><strong>fullscreen:</strong> false 该变量可以用来检查或更改全屏模式的当前状态。若变量被改变，说明全屏模式被改变。</p>
<p>例子</p>
<pre><code>切换全屏状态
onclick=&quot;set(fullscreen,true);&quot;
onclick=&quot;toggle(fullscreen);&quot;
</code></pre>
<p>注意：</p>
<ul>
<li>在使用该设置前，应该检查当前设备/浏览器是否支持全屏模式，这可以在静态xml中使用devices=&quot;fullscreensupport&quot;或动态语句中使用device.fullscreensupport变量来完成。</li>
<li>由于Flash Player和HTML5安全限制，切换到全屏模式需要用户操作动作(如点击鼠标或按下键盘)，这意味着切换全屏模式需要在onclick或onKeyDown事件中进行。</li>
<li>当HTML5浏览器不支持全屏模式时(如iOS)，全屏设置将仅改变viewer的大小以匹配整个浏览器窗口的大小。由于技术限制，无法在IFRAME中及嵌套HTML中工作。</li>
<li>若尝试从IFRAME内部使用全屏模式，那么有必要在IFRAME的声明中加入allowFullScreen，以告诉浏览器该IFRAME是充许切换到全屏的。</li>
</ul>
<p>例子<br>
<code>&lt;iframe ... allowfullscreen=&quot;true&quot; mozallowfullscreen=&quot;true&quot; webkitallowfullscreen=&quot;true&quot;&gt;&lt;/iframe&gt;</code></p>
<p><strong>stagewidth/stageheight：</strong>（只读）当前视图窗口的宽/高  单位像素</p>
<p><strong>stagescale：</strong> 1.0    整体缩放比例设置  （html5）<br>
该设置将缩放所有krpano的元素大小。</p>
<p>通过缩放所有元素，舞台尺寸(屏幕尺寸/分辨率)本身将反比例增加，比如stagescale=0.5时，舞台尺寸将为200%。<br>
该默认值取决于具体的设备、浏览器、js的window.devicePixelRatio值，在桌面和平板上该默认值通常为1.0；在移动设备上通常为0.5。</p>
<p>这意味着，在移动设备上的元素大小通常为桌面和平板的一半。<br>
要禁用该行为(例如要实现一些自定义的响应式布局)可以将下面代码放到第一个xml中。</p>
<pre><code>&lt;action name=&quot;mobilescale&quot; autorun=&quot;preinit&quot; devices=&quot;mobile&quot;&gt;
mul(stagescale,2);
&lt;/action&gt;
</code></pre>
<p>例子</p>
<pre><code>&lt;action name=&quot;mobilescale&quot; autorun=&quot;preinit&quot; devices=&quot;mobile&quot;&gt;
   mul(stagescale,2);
&lt;/action&gt;
</code></pre>
<p><strong>bgcolor：</strong>     视图的背景颜色。在全景图像装载前的显示颜色；以及局部全景未覆盖区域的显示颜色。<br>
当设置为有效的十六进制色值时（例如：&quot;0xFFFFFF&quot;表达白色），那么一个使用该颜色的形状将作为背景在全景图后面呈现。<br>
未设置或设置无效时，则表现为透明，并且将显示FlashPlayer的默认背景色(在html文件中修改)，当embedding设置中wmode=&quot;transparent&quot;时将显示Html页面</p>
<p>仅限Flash：当设置时，它允许在全景图像“外部”使用鼠标进行导航（例如使用局部全景图时），并且它允许不同尺寸局部全景之间的正确混合。</p>
<h3 id="设备信息">设备信息</h3>
<p><strong>browser.useragent</strong>   用户代理字符串，user-agent 字符串。等同于js的 navigator.userAgent（只读）</p>
<p><strong>browser.platform</strong>   浏览平台，在HTML5中为platform字符串，等同于js的navigator.platform；在Flash中一直为“Flash”（只读）</p>
<p><strong>browser.location</strong>    当前页面的完整url（只读）</p>
<p><strong>browser.domain</strong>		域名（只读）</p>
<p><strong>browser.protocol</strong>	协议（只读）</p>
<ul>
<li>注：仅当使用默认的 embedding.js 时，以上变量才有效。</li>
</ul>
<p><img src="https://www.bwrong.cn/post-images/1566708369658.png" alt="" loading="lazy"><br>
例子</p>
<pre><code>if(device.html5, ...);
if(device.flash, ...);
if(device.android, if(device.flash, ...); );
if(device.iOSversion GT 5.1, ...);
</code></pre>
<h3 id="时间-随机值">时间、随机值</h3>
<p><strong>timertick</strong>  （只读）查看器启动到当前时刻经历的毫秒数</p>
<p><strong>random</strong>  0.0-1.0 （只读）返回一个0到1范围内的随机值</p>
<p><strong>idletime</strong>  0.5  设置当无人操作时，经过多少秒会触发 Onidle 事件</p>
<pre><code>//示例-生成一个1到10之间的随机数
mul(val, random, 9);
add(val, 1);
roundval(val);
trace('random value=',val);
</code></pre>
<h3 id="math常量">math常量</h3>
<p><strong>Math.PI</strong>   数学常数π（圆周率）的值(3.141592)</p>
<h3 id="键盘按钮移动">键盘/按钮移动</h3>
<p>这些变量可以用来设置移动视图。</p>
<p>它们的主要用途是键盘或按钮动作控制。</p>
<p><strong>hlookat_moveforce</strong>   0.0  小于0时向左旋转；大于0时向右旋转</p>
<p><strong>vlookat_moveforce</strong>   0.0 小于0时向上旋转；大于0时向下旋转</p>
<p><strong>fov_moveforce</strong>  0.0 小于0时放大；大于0时缩小</p>
<p>当用键盘控制全景时，这些变量会返回不同的数值(0、1或-1)。可以在自已的程序代码中读取或设置它们，用来判断键盘操作状态或实现自动旋转的效果。</p>
<p>旋转加速度、速度及刹车速度分别取决于control.keybaccelerate、control.keybspeed、control.keybfriction</p>
<pre><code>//示例-自动向左旋转3秒后停止
set(hlookat_moveforce,-1);
delayedcall(3,set(hlookat_moveforce,0));
</code></pre>
<h3 id="多重分辨率信息">多重分辨率信息</h3>
<p><strong>multireslevel</strong>    当前的层级数(范围:0到image.level.count-1) （只读）</p>
<p><strong>lockmultireslevel：</strong>  1   限定在某个层级，当为-1时取消限定。</p>
<p><strong>downloadlockedlevel：</strong>  false   为true时表示当前限定的层将被全部下载</p>
<h3 id="加载信息">加载信息</h3>
<p><strong>progress.progress：</strong> 0.0   当前加载进度值(0.0~1.0)，它可以用来制作自定义加载动画，使用 onxmlcomplete 事件来启动加载动画，在 onloadcomplete 事件中停止它，加载过程中通过该变量的值来影响进度显示内容。</p>
<h3 id="xml-场景只读">XML / 场景（只读）</h3>
<p><strong>xml.url</strong>      (只读)当前加载的xml文件路径</p>
<p><strong>xml.content</strong>  (只读)当前xml文件的全部文本内容。当使用loadscene()方法加载一个场景后，该变量中的内容将仅为<code>&lt;scene&gt;</code>元素</p>
<p><strong>xml.scene</strong>  (只读)当使用loadscene()方法加载一个场景后，该变量存贮着当前场景的名称</p>
<p><strong>xml.view</strong>   (只读)保存当前xml或scene中<code>&lt;view&gt;</code>元素的一个备份。例如可以通过 xml.view.hlookat 来获取原始的 view.hlookat</p>
<ul>
<li>注意-这里仅存贮明确定义的值，不含默认值，这意味着，在使用它取值之前要选检查一下该是否存在。</li>
</ul>
<p><strong>network.viewerpath</strong>   krpano渲染器路径</p>
<p><strong>network.htmlpath</strong>   html路径</p>
<p><strong>network.firstxmlpath</strong> 首次加载xml路径</p>
<p><strong>network.currentxmlpath</strong>   当前xml路径</p>
<pre><code>//例如
if(xml.view.fov !== null, ...);
</code></pre>
<h3 id="调试错误处理">调试/错误处理</h3>
<p><strong>debugmode</strong> false	为true时显示调试跟踪 trace() 信息</p>
<p><strong>showerrors</strong> true	当有错误发生时自动显示错误信息窗口</p>
<p><strong>lasterror</strong>  （只读） 用于在 onloaderror 事件中获取最近一次的出错信息。</p>
<p><strong>haveexternalinterface</strong>  true（只读）用来检测扩展接口功能是否有效。尤其是在使用 openurl()这个功能时，有必要使用该变量判断一下环境是否支持扩展接口。<br>
浏览在网络服务器上的全景时该变量始终为true(扩展接口始终有效)，但是在本地的Flash模式下，只有在浏览器打开本地受信任文件夹中的Flash SWF文件，扩展接口才会有效。关于受信任文件夹管理，可以在Flasyplayer安全选项中进行。</p>
<p><strong>havenetworkaccess</strong>  true  （只读）该变量用来检查网络访问是否有效。这可以用来避免错误的发生，如在使用谷歌地图或必应地图时，如若没有网络，就会发生未知错误。<br>
浏览在网络服务器上的全景时该变量始终为true(网络访问始终有效)，但是在本地的Flash模式下，只有在浏览器打开本地受信任文件夹中的Flash SWF文件，网络访问才会有效。<br>
关于受信任文件夹管理，可以在Flasyplayer安全选项中进行。</p>
<h3 id="layers-仅flash">Layers (仅flash)</h3>
<p><strong>image.layer</strong> 仅as3用法)pano image layer 的 Actionscript 3 Sprite 对象</p>
<p><strong>layer.enabled / plugin.enabled</strong>   true 启用所有图层或插件</p>
<p><strong>layer.visible / plugin.visible</strong> true	让所有图层或插件可见或不可见(也支持HTML5)</p>
<p><strong>layer.alpha / plugin.alpha</strong> 1.0	设置所有图层或插件的透明度</p>
<p><strong>layer.layer / plugin.layer</strong> (仅as3用法)layer / plugin 的 Actionscript 3 Sprite 对象</p>
<p><strong>hotspot.enabled</strong> true	启用所有热点</p>
<p><strong>hotspot.visible</strong> true	让所有热点可见或不可见</p>
<p><strong>hotspot.alpha</strong> 1.0	设置所有热点的透明度</p>
<p><strong>hotspot.layer</strong> (仅as3用法)hotspot 的 Actionscript 3 Sprite 对象</p>
<h2 id="变量-语句">变量、语句</h2>
<p><strong>定义一个变量或对象：</strong></p>
<pre><code>def(variable, type, value*)
</code></pre>
<ul>
<li>type<br>
指定变量的类型<br>
变量类型包括：<br>
boolean - true 或者 false<br>
number - 数字类型(含整数和小数)<br>
integer - 整数类型<br>
string - 字符类型<br>
object -包含属性的对象类型</li>
<li>value(可选参数)<br>
该变量的初始值<br>
当未附初始值并且变量已存在时，那么该变量的当前值将被转换成给定的类型<br>
当未附初始值并且变量不存在时，那么默认的初始值自动为以下内容：<br>
boolean=false<br>
number=NaN(表示 Not a Number)<br>
integer=0<br>
string=null<br>
对象类型不能指定初始值</li>
</ul>
<pre><code>def(b, boolean, true);
def(n, number, 123.456);
def(s, string, 'text');
def(obj, object);
def(obj.x, number, 0.0);
def(obj.y, number, 0.0);
</code></pre>
<p><strong>赋值语句：</strong></p>
<pre><code>set({variable},{value})
</code></pre>
<p><em>注意- 当这里为某个变量名称时，不会从该名称所表示变量自动取值，应该使用get(variable)来取变量值</em></p>
<pre><code>set(plugin[{name}].{attribute},{value});
set (layer[skin_map].visible, true);
</code></pre>
<p><strong>获取变量：</strong></p>
<pre><code>get({variable})
array[ get(variable) ]
&lt;xmlelement attribute=&quot;get:variable&quot; ... /&gt;
</code></pre>
<p>获取给定变量的实际值<br>
<em>注意- 个别内置action会自动获取参数中变量名对应的实际值，这时就无需使用 get() 语句。比如 <code>add() sub() mul()</code>等</em></p>
<pre><code>set(dstvar, get(srcvar));
looktohotspot(get(name));
lookto(get(h), get(v), get(f));
showtext(get(msg));
tween(var,get(dstval));
set(pic, spot1);
set(hotspot[get(pic)].visible, false);
trace('xyz=', xyz, ' get(xyz)=', get(xyz));
txtadd(msg, 'fov=', get(view.fov));
</code></pre>
<p><strong>计算语句：</strong></p>
<pre><code>calc(variable, expression)
action( calc(expression), ... )
array[ calc(expression) ]
&lt;xmlelement attribute=&quot;calc:expression&quot; ... /&gt;
</code></pre>
<p>expression：数学或逻辑表达式</p>
<pre><code>set(y_new, calc(y_old - offset1 + offset2));
set(animationtime, calc('%1' == 'instant' ? 0.0 : 0.5));
&lt;layer url=&quot;calc:'%CURRENTXML%/skin/' + settings.image1&quot; /&gt;
</code></pre>
<p><strong>变量复制:</strong></p>
<pre><code>copy(destination, source)==set(destination, get(source) )
</code></pre>
<p>将原变量(source)中的值复制到目标变量(destination)中<br>
当两个变量类类型不同时，原变量的值将被转换成目标变量的类型<br>
copy()动作的同效语句为 <code>set(destination, get(source))</code>;</p>
<pre><code>copy(dstvar, srcvar);
copy(cur_hlookat, view.hlookat);
copy(layer[text].x, mouse.x);
copy(layer[text].y, mouse.y);
</code></pre>
<p><strong>变量移除:</strong></p>
<pre><code>delete(variable,...)
</code></pre>
<p>充许同时移除多个变量，变量之间使用逗号(,)分开即可</p>
<pre><code>set(tmp1, ...);
set(tmp2, ...);
... do something ...
delete(tmp1, tmp2);
</code></pre>
<p><strong>判断语句：</strong></p>
<pre><code>if(condition, then-actions, else-actions*)
</code></pre>
<p>条件成立时执行相应 then语句，否则执行 else语句</p>
<pre><code>if(fullscreen, fullscreensetup(), windowsetup() );
if(fullscreen, set(layer[controls].visible, false) );
if(i LT 10, loop(next) );
if(var === null, set(var,0));
if(hotspot[spot1] === null, trace(there is no spot1 hotspot));
if((varA GT 5) AND (varA LT 10),
    trace('varA is between 5 and 10')
  );
if(varA AND varB AND varC, trace('all vars are true') );
if(var1 GT var2,
    trace('condition is true');
    lookto(100,20,50);
  ,
    trace('condition is false');
    lookto(0,0,100);
  );
if(a*2+b GT (c+3)*1.5 OR teststring == '123', ...);
</code></pre>
<p><strong>否定判断：</strong></p>
<pre><code>ifnot(condition, then-actions, else-actions*)
</code></pre>
<p>逻辑上与 if 相反，用法相同。</p>
<p><strong>延时调用：</strong></p>
<pre><code>delayedcall(delay , actions)   /   delayedcall(id, delay, actions)
</code></pre>
<p>给定的时间后调用或执行指定的动作，为该动作指定一个唯一的标识 ID ，这样一来，就可以通过 stopdelayedcall(id) 来取消该延时动作的执行</p>
<pre><code>delayedcall(5.0, hidelogo() );
delayedcall(id1,5.0, hidelogo() ); //id用于其他动作控制该delayedcall
delayedcall(10, looktohotspot(spot1);loadpano(pano2.xml); );
</code></pre>
<p><strong>移除延时回调：</strong></p>
<pre><code>stopdelayedcall(id)
</code></pre>
<p>取消并停止指定id的延时动作</p>
<pre><code>&lt;events name=&quot;introimage_events&quot;
        onnewpano=&quot;delayedcall(introimage, 5.0, hide_introimage() );&quot;
        onremovepano=&quot;stopdelayedcall(introimage);&quot;
        /&gt;
</code></pre>
<p><strong>在某个actions后执行：</strong></p>
<pre><code>nexttick(actions)
</code></pre>
<p>在当前动作体(一个action元素结点内的动作集)执行完成后立即执行指定的动作</p>
<pre><code>//执行以下动作会先显示&quot;测试nexttick&quot;
&lt;action name=&quot;nexttick_test&quot;&gt;
showlog();
nexttick(trace(&quot;这是nexttic中k的动作!&quot;);
trace(&quot;测试nexttick&quot;);
&lt;/action&gt;
</code></pre>
<p><strong>在condition为真时执行指定actions：</strong></p>
<pre><code>callwhen(condition, actions)
</code></pre>
<p>当表达式(condition)值为 true 会执行指定的动作(actions)<br>
若表达式的值此时不为 true ，那么该语句动作会一直等待，直到值为 true 并执行指定的动作<br>
<em>注意- 与 if() 语句主要不同是，callwhen() 具有充许滞后特性，这里强调的是当表达式的值变为true时才执行且仅执行一次</em></p>
<pre><code>callwhen(plugin[video].loaded, plugin[video].playvideo(...); );
callwhen(plugin[maps].loaded, plugin[maps].setcenter(...); );
</code></pre>
<p><strong>循环语句：</strong></p>
<pre><code>for(startactions, condition, nextactions, loopactions) //startactions循环前执行
</code></pre>
<p>首先执行起始动作(startactions)，然后检查表达式(condition)，若值为 true 则执行要循环的动作(loopactions)，每执行一次循环动作就执行一次步进动作(nextactions)，然后再检查表达式的值，若为 true 则继续执行循环动作…直到表达式为 false 时终止循环</p>
<pre><code>for(set(i,0), i LT 10, inc(i), trace('i=',i) );.
for(set(i,0), i LT layer.count, inc(i),
  trace('layer[',i,'].name=',layer[get(i)].name);
);
</code></pre>
<p><strong>持续循环：</strong></p>
<pre><code>loop(condition, loopactions)
asyncloop(condition, loopactions, doneactions*)
</code></pre>
<p>只要表达式(condition)值为 true 则一直执行循环动作(loopactions)<br>
对于 loop() 语句，只有当循环体执行结束后才会执行后续的其它动作；而 asyncloop() 则是在循环期间继续其它事件和动作，只是在当表达式为 true 时就每帧执行一次循环动作(loopactions)，asyncloop() 循环结束后还可以执行可选的完成动作(doneactions)</p>
<pre><code>ondown=&quot;asyncloop(pressed, layer[scrollarea].scrollby(+2,0) );&quot;
onover=&quot;asyncloop(hovering, updatemousepos(), hideinfo() );&quot;
asyncloop(true, framehandler() );
</code></pre>
<p><strong>定时器</strong>：</p>
<pre><code>setinterval(id, delay, actions)
clearinterval(id)
</code></pre>
<p>按给定的时间定时重复执行指定的动作</p>
<pre><code>setinterval(time, 1.0,
    jsget(time, (new Date()).toLocaleTimeString(); );
    trace('time=',time);
  );
&lt;events onkeydown=&quot;setinterval(get(keycode), 0.1, trace(keycode); );&quot;
        onkeyup=&quot;clearinterval(get(keycode));&quot;
        /&gt;
</code></pre>
<p><strong>切换：</strong></p>
<pre><code>toggle(variable)
</code></pre>
<p>针对指定逻辑变量的值，在 true 和 false 之间切换</p>
<pre><code>toggle(fullscreen);
toggle(layer[button1].visible);
</code></pre>
<p><strong>交替真假：</strong></p>
<pre><code>switch({variable})、switch({variable},{valueA},{valueB})
</code></pre>
<p>转变变量的值</p>
<ul>
<li>如果仅给一个变量，没有 value 参数，此时等效于 toggle() ，变量将在 true 与 false 之间变换 ；</li>
<li>如果给定两个或更多的 value 参数，那么将依次从左到右转变 variable 的值。</li>
</ul>
<pre><code>switch(fullscreen);
switch(layer[button1].visible);
switch(layer[button1].alpha, 1.0, 0.5);
switch(layer[child].parent, button1, button2, button3);
switch(destpos, -100, 0, +100); tween(y,get(destpos));
</code></pre>
<p><strong>跳出、中止：</strong></p>
<pre><code>break()
</code></pre>
<p>中断或停止当前的动作 ，当在 for()循环或 loop()循环中使用时，将仅停止循环自身<br>
<strong>调用绑定：</strong></p>
<pre><code>callwith(caller, actions)
</code></pre>
<p>可以使用指定的 plugin/layer 或 hotspot 作为调用者，用于直接访问这些元素的属性或事件</p>
<ul>
<li>caller<br>
该元素将作为调用者，只能使用 plugin/layer 或 hotspot 元素</li>
<li>action<br>
任意动作语句，这些语句将在调用者的语境中执行，这意味着可以直接访问元素的属性和事件</li>
</ul>
<pre><code>//这里的onclick实际是指 layer[test].onclick();
callwith(layer[test], onclick);
callwith(layer[test], trace('test pos=',x,'/',y); );
//其中的alpha是指layer[test].alpha
callwith(layer[test], tween(alpha, 0.0); );
</code></pre>
<p><strong>style属性复制：</strong></p>
<pre><code>assignstyle(elementname, styles)
</code></pre>
<pre><code>assignstyle(layer[test], 'teststyle');
assignstyle(layer[test], 'style1|style2');
</code></pre>
<p>将属性从一个或多个style元素的属性复制到目标元素。</p>
<p><strong>属性克隆：</strong></p>
<pre><code>copyattributes(destobject, srcobject)
</code></pre>
<p>将一个对象的所有属性从复制到另一个。</p>
<pre><code>copyattributes(get(layer[test]), get(style[style1]));
</code></pre>
<p><strong>从所有<code>&lt;events&gt;</code>元素中执行指定的事件：</strong></p>
<pre><code>events.dispatch(eventname, instantly*)
</code></pre>
<p>instantly一个布尔值设置(true或false，默认为false)。当设置为true时，事件将被调用并立即执行，当没有设置或设置为false时，事件将在当前的操作调用后被调用。</p>
<pre><code>&lt;events name=&quot;events1&quot; myevent=&quot;trace(events1...);&quot; /&gt;
&lt;events name=&quot;events2&quot; myevent=&quot;trace(events2...);&quot; /&gt;
...
events.dispatch(myevent);
</code></pre>
<h2 id="计算相关方法">计算相关方法</h2>
<p><strong>数学运算符</strong><br>
充许使用两到三个参数。</p>
<pre><code>add(variable, valueA, valueB*)
 sub(variable, valueA, valueB*)
 mul(variable, valueA, valueB*)
 div(variable, valueA, valueB*)
 mod(variable, valueA, valueB*)
 pow(variable, valueA, valueB*)
</code></pre>
<ul>
<li>两个参数的情况</li>
</ul>
<pre><code>add(dst,val1) 等效于 dst = dst + val1
sub(dst,val1) 等效于 dst = dst - val1
mul(dst,val1) 等效于 dst = dst * val1
div(dst,val1) 等效于 dst = dst / val1
mod(dst,val1) 等效于 dst = dst % val1
pow(dst,val1) 等效于 dst = dst ^ val1
</code></pre>
<ul>
<li>三个参数的情况</li>
</ul>
<pre><code>add(dst,val1,val2) 等效于 dst = val1 + val2
sub(dst,val1,val2) 等效于 dst = val1 - val2
mul(dst,val1,val2) 等效于 dst = val1 * val2
div(dst,val1,val2) 等效于 dst = val1 / val2
mod(dst,val1,val2) 等效于 dst = val1 % val2
pow(dst,val1,val2) 等效于 dst = val1 ^ val2
</code></pre>
<p><em>提示-var1与var2可以是具体的值也可是变量，当为变量时，会自动使用它们的真实值</em></p>
<pre><code>set(val, 1);
add(val, 1);
trace('val should be 2: val=',val);
mul(doublewidth, width, 2.0);
mul(scale, 0.5);
div(result, vala, valb);
add(dst,rotate,360); tween(rotate,get(dst),5);
add(xpos, mouse.x, mouse_x_offset);
sub(destx, stagewidth,  destwidth);
div(aspect,16,9);
mod(cur_hlookat,cur_hlookat,360);
pow(sqrt,val,0.5);
</code></pre>
<p><strong>自增加：</strong></p>
<pre><code>inc(variable, byvalue*, max*, min*)
</code></pre>
<p><strong>自减少：</strong></p>
<pre><code>dec(variable, byvalue*, min*, max*)
</code></pre>
<ul>
<li>variable<br>
指定的变量</li>
<li>byvalue<br>
每次增加或减少的量，如果无该参数，指定的量将被增加或减小 1</li>
<li>max / min<br>
限定指定变量的最大值和最小值<br>
当指定的变量达到其中一个限制时，该变量将被设置为另一个限制的值。这可以用来让指定的变量落在一定的范围或夹限在特定区域(使用 min=max)</li>
</ul>
<pre><code>inc(i);
inc(frame,1,get(lastframe),0);
inc(ypos,30);
inc(view.hlookat, 2, 90, -90);
</code></pre>
<p><strong>限定：</strong></p>
<pre><code>clamp(variable, min, max)
</code></pre>
<p>限制变量的值在给定的最小和最大之间的值。</p>
<ul>
<li>variable<br>
欲被裁剪的变量</li>
<li>min<br>
最小值 - 当指定的变量小于该值时，将被设置与该值相同</li>
<li>max<br>
最大值 - 当指定的变量大于该值时，将被设置与该值相同</li>
</ul>
<pre><code>clamp(percent, 0, 100);
screentolayer(bar, mouse.stagex,mouse.stagey, lx,ly);
div(fill, lx, layer[bar].pixelwidth);
mul(fill, 100);
clamp(fill, 0, 100);
txtadd(layer[barfill].width, get(fill), '%');
</code></pre>
<p><strong>数学函数：</strong></p>
<pre><code>Math.*
</code></pre>
<p>Math对象提供一些用于数学运算的常量和动作；<br>
大部份 Math 动作都有两种使用方式：一是只提供一个变量作为参数，此时该参数即是运算对象，同时又是运算后结果的存贮变量；二是提供两个参数，前一个用于存贮结果，后一个为运算对象。<br>
<img src="https://www.bwrong.cn/post-images/1566708539791.png" alt="" loading="lazy"><br>
<strong>数字取值（四舍五入）：</strong></p>
<pre><code>roundval(variable, decimalplaces*)  //decimalplaces保留小位点位数，无此参数时表示不保留小数位(取整)
</code></pre>
<pre><code>roundval(val);
roundval(val,2);
copy(cur_hlookat,view.hlookat);
mod(cur_hlookat,360);
roundval(cur_hlookat,2);
copy(cur_vlookat,view.vlookat);
roundval(cur_vlookat,2);
txtadd(msg,'looking at ',get(cur_hlookat),'/',get(cur_vlookat));
</code></pre>
<h2 id="字符处理相关">字符处理相关</h2>
<p><strong>转16进制：</strong></p>
<pre><code>tohex(variable, prefix*, length*)
</code></pre>
<p>将给定的变量转换为十六进制字符串 ，可以用来生成 html/css 的色值字串</p>
<ul>
<li>variable<br>
给定的变量</li>
<li>prefix(可选)<br>
前导字符(如 '0x' 或 '#')</li>
<li>length(可选)<br>
返回值的长度</li>
</ul>
<pre><code>tohex(color,'#',6);
set(color, ...an_external_integer_input...);
tohex(color,'#',6);
txtadd(layer[text1].css,'color:',get(color),';');
</code></pre>
<p><strong>大小写转换：</strong></p>
<pre><code>tolower(variable)
toupper(variable)
</code></pre>
<p><strong>字符拼接：</strong></p>
<pre><code>txtadd(destination, txt1, txt2*, txt3*, ...)
</code></pre>
<p>若只有两个参数，则将第二个参数中的字符连接到目标变量(destination)的后面。多于两个参数时，则是将从每二个参数开始的所有参数依次连接在一起，并存贮到目标变量中</p>
<ul>
<li>destination<br>
用于存贮连接结果的目标变量<br>
该变量不存在时将被自动创建</li>
<li>txt1,txt2,txt3,…(可选)<br>
将被连接到一起的字符串<br>
当只有一个txt参数时，该txt将被直接连接到当前目标变量(destination)的尾部<br>
如果使用变量作为txt参数，一定要用get()来获取该变量的实际值</li>
</ul>
<pre><code>txtadd(picfilename,'%CURRENTXML%/pic_',get(pic),'.jpg');
txtadd(crop,'0|',get(ypos),'|333|285');
txtadd(pname, 'thumbbar_image_', get(i));
txtadd(layer[text].html,'[p]',get(data[txt1].content),'[/p]');
txtadd(msg,get(view.fovtype),'=',get(fov),'°');
</code></pre>
<p><strong>字符截取：</strong></p>
<pre><code>subtxt(dstvar, srcvar, startpos, len)
</code></pre>
<ul>
<li>dstvar<br>
用于存贮所提取子串的目标变量，如果该变量不存在则会被自动创建</li>
<li>srcvar<br>
来源字符串的变量</li>
<li>startpos<br>
子串在源字符串中的起始位置</li>
<li>len<br>
欲提取子串的长度</li>
</ul>
<pre><code>subtxt(newvar, abcdefg, 2, 3)  ----&gt;  newvar==bcd,  第二个开始截取，截取3字符
</code></pre>
<p><strong>字符串查找：</strong></p>
<pre><code>indexoftxt(index, txt, searchtxt, startindex*)
</code></pre>
<p>返回搜索字符(searchtxt)在字符串(txt)中的起始位置(index)</p>
<ul>
<li>index<br>
用于存贮返回值的变量，若返回 -1 则表示搜索字符串(searchtxt)不存在字符串(txt)中；如果该变量不存在则自动创建</li>
<li>txt<br>
源字符串</li>
<li>searchtxt<br>
欲搜索的子字符串</li>
<li>startindex(可选)<br>
指定从源字符串的搜索子串时的起始位置(默认为0)</li>
</ul>
<p><strong>字符串替换：</strong></p>
<pre><code>txtreplace(var, searchtext, replacetext)、 txtreplace(dstvar, srcvar, searchtext, replacetext)
</code></pre>
<p>用字符串replacetext替换源字符串var/srcvar中的searchtext字符串</p>
<ul>
<li>var / srcvar / dstvar<br>
用于搜索的源字符串变量(var, srcvar)以及用于存贮返回结果的变量(var, dstvar)。如果该变量不存在则自动创建</li>
<li>searchtxt<br>
将要被替换掉的旧字符串</li>
<li>replacetxt<br>
欲替换旧字符串的新字符串</li>
</ul>
<p><strong>字符串分割：</strong></p>
<pre><code>txtsplit(string, separator, resultingarray)、txtsplit(string, separator, var1, var2, ...)
</code></pre>
<ul>
<li>string<br>
欲分割的字符串，可以为实际的字符或字符串变量</li>
<li>separator<br>
分割标记字符</li>
<li>resultingarray当用三个参数使用txtsplit()时<br>
用于存贮分割结果的数组变量名，分割的字符逐个放个该数组成员的'value'属性中</li>
<li>var1,var2,…当用四个或更多参数使用txtsplit()时，分割出来的字符串将依次存入这些给定的变量中</li>
</ul>
<pre><code>Split into separate variables:
txtsplit('1|2|3', '|', a, b, c);
trace('a=',get(a), ' b=',get(b), ' c=',get(c));
Result:
a=1 b=2 c=3
Split into an array:
txtsplit('x|y|z', '|', arr);
for(set(i,0), i LT arr.count, inc(i),
  trace('arr[',get(i),'].value=',arr[get(i)].value);
);
Result:
arr[0].value=x
arr[1].value=y
arr[2].value=z
</code></pre>
<p><strong>转码：</strong></p>
<pre><code>fromcharcode(var, charcode)
</code></pre>
<p>将一个Unicode字符编码值转换为字符并存入变量(var)中</p>
<ul>
<li>var<br>
用于存贮转换结果的变量</li>
<li>carcode<br>
Unicode字符编码值<br>
<strong>转义和反转义：</strong></li>
</ul>
<pre><code>escape(var)
escape(var, text)
unescape(var)
unescape(var, text)
</code></pre>
<p>对字符串进行编码、解码</p>
<ul>
<li>var<br>
无 text 参数时 - 该变量自身将被编码或解码；<br>
有 text 参数时 - 该变量将用来存贮 text 编码或解码后的字符</li>
<li>text(可选)<br>
将被编码或解码的字符串</li>
</ul>
<h2 id="动画">动画</h2>
<p><strong>动画语句：</strong></p>
<pre><code>tween(variable, value, time*, tweentype*, donecall*, updatecall*)
</code></pre>
<p>补间动作，通过动态改变指定变量值实现动画效果<br>
颜色支持 当指定的变量名中含有'color'这个关键字时，那么它的值将自动解析为32位的ARGB色值并且单独处理每个颜色通道<br>
多变量支持 可以同时处理多个变量，这时要使用'|'来分隔这些变量(variable)、值(value)和被间动作类型(tweentype)，当变量有多个，而只有一个值或补间类型时，那么所有变量将使用相同补间动作类型或被转变到相同的值，并且对于所有变量来说，time、donecall以及updatecall也都是相同的</p>
<ul>
<li>variable<br>
将被改变的变量<br>
使用|字符来分隔多个变量<br>
当变量名中含有关键字'color'时，变量值将被处理为32位的ARGB色值</li>
<li>value<br>
变量的目标值<br>
若值前面有'%'字符，将按百分比方式处理<br>
使用|字符来分隔多个变量对应的不同值<br>
当使用变量来作为value参数时，需使用 get() 动作来获取变量的实际值</li>
<li>time(可选)<br>
从当前值改变到目标值所需秒数(默认 0.5 秒)<br>
还可以通过 distance() 语句来动态指定时间(不支持多变量补间)，distance()的原理是通过设置指定值域变化的最大时间来动态设置本次补间所需的实际时间，这样一来，对于变化量小的补量则用时短；相反对于变化量大的补间则用时就长，主要是改善用户体验。<br>
下面是 distance() 语句用法<br>
#distance(dvalue,dtime)<br>
#dvalue - 值变化的区间<br>
#dtime - 值在区间内变化完成需要时间</li>
<li>tweentype(可选)<br>
补间动作的插值计算类型(默认 easeOutQuad )<br>
更多补间动作类型：tweentypes</li>
<li>donecall(可选)<br>
当补间动作完成且指定变量已达到目标值时，执行本参数中的动作<br>
除了常规动作，还可以在这里使用特殊关键字 WAIT ，在这种情况下，用户界面以及后续的动作将被阻止，直到指定变量达到目标的值</li>
<li>updatecall(可选)<br>
指定变量在每一次(每一帧)更新时，都会执行该参数中动作<br>
<em>警告- 谨慎使用！会增加系统负担拖慢帧速率</em></li>
</ul>
<pre><code>tween(view.vlookat, 90.0, 2.0); //视觉转为向上垂直90度，转换视觉过程为2秒
tween(layer[skin_scroll_layer].y, get(mh), 0.5, easeOutQuint, set(layer[skin_map].visible,false) );
//皮肤滚动条组件Y轴坐标改变到指定位置，转换坐标过程为0.5秒，转换模式为easeOutQuint，转换完成后执行set(layer[skin_map].visible,false)
</code></pre>
<p><strong>停止动画：</strong></p>
<pre><code>stoptween(variable, ...)
</code></pre>
<p>停止当前运行中的补间动作</p>
<ul>
<li>variable<br>
当前正在对该变量进行补间操作的动作将被停止</li>
<li>… variable, variable, …(可选)<br>
将被停止补间的其它的变量</li>
</ul>
<pre><code>ondown=&quot;tween(layer[text].y, 10, distance(400,0.7), linear);&quot;
onup=&quot;stoptween(layer[text].y);&quot;
</code></pre>
<p><strong>动画类型tweentype：</strong></p>
<figure data-type="image" tabindex="9"><img src="https://www.bwrong.cn/post-images/1566708583071.png" alt="" loading="lazy"></figure>
<h2 id="动态加载">动态加载</h2>
<p><strong>加载新的全景</strong><br>
注意- 只有具备 keep=“true” 属性的图层、插件、热点、事件和光晕元素在新场景中才被保留</p>
<pre><code>loadpano(xmlpath, vars*, flags*, blend*)
loadscene(scenename, vars*, flags*, blend*)
loadpanoscene(xmlpath, scenename, vars*, flags*, blend*)
loadxml(xmlstring, vars*, flags*, blend*)
</code></pre>
<figure data-type="image" tabindex="10"><img src="https://www.bwrong.cn/post-images/1566708600662.png" alt="" loading="lazy"></figure>
<p><img src="https://www.bwrong.cn/post-images/1566708611502.png" alt="" loading="lazy"><br>
<em>注意- 当选定的混合模式不被环境支持时(例如在Flashplayer下使用仅支持WebGL的模式)，那么将自动回退到默认的混合方式(NOBLEND)</em></p>
<pre><code>loadpano(pano2.xml);
loadpano(pano2.xml, null, MERGE, BLEND(1));
loadscene(scene1);
loadscene(scene1, null, MERGE, BLEND(1));
loadxml('&lt;krpano&gt;&lt;image&gt;&lt;sphere url=&quot;pano.jpg&quot;/&gt;&lt;/image&gt;&lt;/krpano&gt;');
loadxml(get(data[xml].content), null, KEEPALL);
loadpano('%SWFPATH%/pano.xml', null, MERGE, BLEND(2));
loadpano(sphere.xml, image.hfov=1.0&amp;view.limitview=fullrange);
</code></pre>
<p><strong>打开地址：</strong></p>
<pre><code>openurl(url, target*)
</code></pre>
<ul>
<li>url<br>
待打开的url</li>
<li>target(可选)<br>
_blank - 在新窗口中打开(默认)<br>
_self - 在当前窗口的当前帧中打开<br>
_parent - 在当前帧的父窗口中打开<br>
_top - 在当前窗口的顶层帧中打开<br>
<em>Flash模式时要注意 - 该动作需要Flashplayer的扩展接口支持，它只在浏览器内部有效，当工作在离线或使用“file:“本地url浏览时就需要对Flashplayer进行安全设置</em></li>
</ul>
<pre><code>openurl('http://krpano.com',_self);
openurl('help.html');
</code></pre>
<p><strong>调用js网页跳转：</strong></p>
<pre><code>js(eval(this.location=&quot;{url}&quot;))
</code></pre>
<h2 id="视图-相机控制">视图、相机控制</h2>
<p><strong>视图设置：</strong></p>
<pre><code>lookat(h, v, fov*, distortion*, architectural*, pannini*)
</code></pre>
<p>观看全景的指定位置</p>
<ul>
<li>h - 球面坐标中的水平方向角度(-180 到 +180)-view.hlookat</li>
<li>v - 球面坐标中的垂直方向角度(-90 到 +90)-view.vlookat</li>
<li>fov(可选) - 视域度数(0 到 179)-view.fov</li>
<li>distortion (可选) - 鱼眼扭曲设置 -view.distortion</li>
<li>architectural (可选) - 建筑投影设置 -view.architectural<br>
pannini1)(可选) - pannini投影设置 -view.pannini</li>
</ul>
<pre><code>lookat(0,0);
lookat(0,0,90);
loadpano(pano.xml);
lookat(45.1, -20.2, 110.0);
</code></pre>
<p><strong>视图变化：</strong></p>
<pre><code>lookto(toH,toV,fov*,motiontype*,shortestway*,nonblocking*,donecall*)
 looktohotspot(hotspotname*, fov*, motiontype*, shortestway*)
 moveto(toH, toV, motiontype*)
 zoomto(fov, motiontype*)
</code></pre>
<p>将视图从当前位置移动给定的位置</p>
<p><em>注意- 在移动期间所有用户界面及其它动作都将被阻塞，这意味着其它动作只能在当前动作完成后才能执行。可以使用 oninterrupt() 来充许用户中断该动作</em></p>
<p><img src="https://www.bwrong.cn/post-images/1566708638653.png" alt="" loading="lazy"><br>
例子</p>
<pre><code>moveto(100.0,5,linear(10));
zoomto(130,smooth());
lookto(33,-22,30,smooth(100,50,20));
looktohotspot(hotspot1);
looktohotspot(hotspot2, 40);
looktohotspot(hotspot3, 25, smooth(100,50,20));
looktohotspot(get(name));
</code></pre>
<p><strong>调整视图：</strong></p>
<pre><code>adjusthlookat(desthlookat) //调整view.hlookat值
</code></pre>
<p>解决360度环绕中到达目标水平位置(desthlookat)的最短路径</p>
<ul>
<li>desthlookat<br>
为 0 时，可以从 view.hlookat 中获取正确的当前水平位置值：-180 到 +180<br>
为任意 0到360 的值时，则会修正从当前位置到达该水平位置的最短运动方式<br>
可以直接使用变量，会自动获取实际值<br>
此时当前的view.hlookat会被调整到与该参数的邻近值(不改变当前视图)</li>
</ul>
<pre><code>//用途一:让读取的view.hlookat值正确落在 -180到+180 的范围内
adjusthlookat(0);
trace(view.hlookat);
//用途二:修正view.hlookat，以期通过最短路径方式移动到目标水平位置
adjusthlookat(140);
tween(view.hlookat, 140);
</code></pre>
<p><strong>获得球面距离：</strong></p>
<pre><code>getlooktodistance(result, toH, toV, fromH*, fromV*)
</code></pre>
<p>获取球面坐标中两个位置之间的夹角度数(0到180度)</p>
<p><img src="https://www.bwrong.cn/post-images/1566708655652.png" alt="" loading="lazy"><br>
<strong>停止 lookto / looktohotspot / moveto / zoomto事件：</strong></p>
<pre><code>stoplookto()
</code></pre>
<p>停止一个未阻塞的 <code>lookto()/looktohotspot()/moeto()/zoomto()</code>动作</p>
<p><strong>停止用户操作：</strong></p>
<pre><code>stopmovements()
</code></pre>
<p>立即停止用户触发的(通过鼠标、键盘或触控板)所有panning投影和缩放行为</p>
<p><strong>等待：</strong></p>
<pre><code>wait(parameter)
</code></pre>
<p>等待若干秒的时间或等待特定的事件(LOAD 或 BLEND)<br>
<em>注意- 用户界面及所有后续动作将被阻塞，这意味着后面的动作只能在当前动作完成之后才能得到执行。可以使用 oninterrupt 以便让用户有中断能力</em></p>
<ul>
<li>parameter 有以下三种可能<br>
任意数字 - 等待的时间秒数<br>
LOAD - 一直等待直到加载完成<br>
BLEND - 一直等待直到混合效果处理完成</li>
</ul>
<pre><code>oninterrupt(break);
lookto(150,30,70);
wait(3);
lookto(242,0,150);
lookto(280,-10,50);
wait(3);
loadpano(pano2.xml,null,MERGE,BLEND(2));
lookat(100,50,5);
wait(BLEND);
lookto(100,50,150);
</code></pre>
<p><strong>oninterrupt：</strong></p>
<pre><code>oninterrupt(actions)
</code></pre>
<p>在处理一些会阻塞用户界面的动作之前(如 lookto()、looktohotspot()、moveto()、zoomto()、wait()以及使用WAIT作为donecall参数的tween())，使用该语句，用户就可以随时通过操控界面(如点击动作)来中止这些动作的执行，同时执行参数内容中的动作。</p>
<ul>
<li>action<br>
用户中断后要执行的命令<br>
另外这里还有一个特殊的命令：<br>
break - 仅中断当前动作(无其它附加命令)</li>
</ul>
<h2 id="坐标相关">坐标相关</h2>
<p><strong>屏幕坐标和球坐标之间的转换：</strong></p>
<pre><code>screentosphere(x,y, h,v)
spheretoscreen(h,v, x,y, stereoside*)
</code></pre>
<p>屏幕坐标与球面坐标之间的相互转换</p>
<ul>
<li>screentosphere - 将屏幕上的x/y转换为球面中的h/v</li>
<li>spheretoscreen - 将球面中的h/v转换为屏幕上的x/y</li>
</ul>
<ul>
<li>x/y - 以左上角为原点的屏幕像素坐标</li>
<li>h/v - 球面上的方位角度(380×180)</li>
<li>stereoside (可选)<br>
针对分屏VR模式 - 定义哪一边的屏幕坐标，可能的设置有两种：l- 左屏；r- 右屏；或者不设置表示无分屏的普通坐标</li>
<li>注意：<br>
x,y,h,v必须为变量名，不充许使用确切的数值<br>
如果变量未定义，它将被自动创建<br>
<code>screentosphere(mouse.x, mouse.y, toh, tov);</code></li>
</ul>
<p><strong>屏幕坐标和球坐标之间的转换，层的坐标：</strong></p>
<pre><code>screentolayer(layer, screenx,screeny, layerx,layery)
layertoscreen(layer, layerx,layery, screenx,screeny)
</code></pre>
<p>在真实屏幕与相对图层坐标之间转换</p>
<ul>
<li>layer - 图层元素名称</li>
<li>screenx/screeny - 屏幕上相对左上角的坐标像素值变量</li>
<li>layerx/layery - 相对于左上角的图层坐标变量</li>
</ul>
<p><strong>注意：</strong><br>
屏幕坐标系是从左上角 (x=0; y=0) 到右下角 (x=stagewidth; y=stateheight)<br>
如果使能scalechildren，那么层坐标也会被缩放<br>
不支持旋转的层<br>
所有参数必须为变量，不充许使用常量<br>
当变量不存在时，它将被创建</p>
<pre><code>screentolayer(bar, mouse.stagex,mouse.stagey, lx,ly);
div(fill, lx, layer[bar].pixelwidth);
mul(fill, 100);
clamp(fill, 0, 100);
txtadd(layer[barfill].width, get(fill), '%');
</code></pre>
<p><strong>remapfovtype：</strong></p>
<pre><code>remapfovtype(fov, srcfovtype, dstfovtype)
remapfovtype(fov, srcfovtype, dstfovtype, width, height)
</code></pre>
<p>就当前视域范围，重新计算出另一种fovtype对应的新fov值<br>
在改变fovtype及重新计算对应fov的过程中，当前视域(镜头变焦)不会变化</p>
<ul>
<li>fov<br>
将被改变的fov变量<br>
返回的新值也将存贮在该变量中</li>
<li>srcfovtype<br>
当前的fovtype<br>
可以是：HFOV,VFOV,DFOV或者MFOV</li>
<li>dstfovtype<br>
新的fovtype<br>
可以是：HFOV,VFOV,DFOV或者MFOV</li>
<li>bwidth (可选)<br>
指定视图区域的宽度像素数<br>
默认为当前视图尺寸</li>
<li>height (可选)<br>
指定视图区域的高度像素数<br>
默认为当前视图尺寸</li>
</ul>
<pre><code>set(view.fovtype, HFOV);
set(view.fov, 90);
...
set(view.fovtype, VFOV);
remapfovtype(view.fov, HFOV, VFOV);
</code></pre>
<h2 id="更新重绘">更新重绘</h2>
<p><strong>更新/重建pano对象的内部3D模型：</strong></p>
<pre><code>updateobject(updateall*, updatefov*)
</code></pre>
<p>重建全景对象的3D模型</p>
<p>在浏览时动态改变display.details以及display.tessmode后必须使用这个语句以更新全景。当在交互方式更改image.hfov,image.vfov或者image.voffset这些设置时，应使用updatefov=true试调用该语句，以便得到更新后的全景对象</p>
<p><em>注意-该语句很消耗系统资源，请谨慎使用!</em></p>
<ul>
<li>updateall (可选)<br>
针对多重分辨率 - 是否更新所有层<br>
可能的设置：true 或 false (默认为 false)</li>
<li>updatefov (可选)<br>
全景更新同时重新解析出新的image.hfov,image.vfov以及image.voffset<br>
可能的设置：true 或 false (默认为 false)</li>
</ul>
<pre><code>set(image.hfov,1);
updateobject(true,true);
</code></pre>
<p><strong>屏幕重绘：</strong></p>
<pre><code>updatescreen()
</code></pre>
<p>直接强制重绘当前屏幕内容</p>
<p><strong>重绘屏幕，并重置idletime计数器：</strong></p>
<pre><code>invalidatescreen()
</code></pre>
<p>直接强制重绘当前屏幕内容，并全重置idletime计数(无用户交互时间计数)</p>
<h2 id="热点添加及移除">热点添加及移除</h2>
<p><strong>动态地创建和添加:</strong></p>
<pre><code>addlayer(name)
 addplugin(name)
 addhotspot(name)
 addlensflare(name, ath*, atv*)
</code></pre>
<p>动态创建一个新的图层、插件、热点或光晕</p>
<ul>
<li>name - 待创建的新元素名称(最好使用小写英文,不要使用数字或其它字符开头)</li>
<li>ath/atv (仅针对光晕) - 光晕的空间位置</li>
</ul>
<pre><code>addlayer(button);
addhotspot(newspot);
addhotspot(polyspot);
addlensflare(sun, 20, -60);
</code></pre>
<p><strong>移除：</strong></p>
<pre><code>removelayer(name, removechildren*)
 removeplugin(name, removechildren*)
 removehotspot(name)
 removelensflare(name)
</code></pre>
<p>动态删除一个图层、插件、热点或光晕</p>
<ul>
<li>name - 待删除的元素名称</li>
<li>removechildren (可选) - 设置为true时，该元素的所有子元素也将被删除</li>
</ul>
<p><strong>layer/plugin/hotspot专属：</strong></p>
<pre><code>layer / plugin / hotspot[name].loadstyle(name)
layer / plugin / hotspot[name].registercontentsize(imagewidth,imageheight)
layer / plugin / hotspot[name].resetsize()
layer / plugin / hotspot[name].updatepos()
layer / plugin / hotspot[name].changeorigin(align,edge)
layer / plugin / hotspot[name].getfullpath()
hotspot[name].getcenter(ath,atv)
</code></pre>
<h2 id="js扩展">JS扩展</h2>
<p><strong>调用js函数：</strong></p>
<pre><code>js( &quot;Javascript函数(参数)&quot; )
</code></pre>
<p>调用一个Javascript函数，在实际调用js代码之前，其中的参数将预先被krpano解析，记得要使用get(var)语句去获取变量的确切值<br>
<em>Flash模式时注意 - 该语句需要使用Flashplayer的扩展接口，它仅在浏览器内部且在线时有效，当离线浏览或本地url浏览，那么就需要设置Flashplayer的安全设置项</em></p>
<pre><code>//以下是存在于js或 html文件中的Javascript代码
function test(p1, p2, p3)
{
  alert(p1 + &quot;: &quot; + p2 + &quot; / &quot; + p3);
}
//全景项目中的调用代码
js( test('Lookat', get(view.hlookat), get(view.vlookat)) );
</code></pre>
<p><strong>调用js代码：</strong></p>
<pre><code>jscall( &quot;...任意Javascript代码... &quot;)
</code></pre>
<p>直接在全景中执行任何Javascript代码，可以在Javascript代码中直接读写krpano的js接口对象<br>
<em>Flash模式时注意 - 该语句需要使用Flashplayer的扩展接口，它仅在浏览器内部且在线时有效，当离线浏览或本地url浏览，那么就需要设置Flashplayer的安全设置项</em></p>
<pre><code>//改变html元素的风格
jscall('document.getElementById(&quot;test&quot;).style.display=&quot;none&quot;;');
//使用calc()语句构建js语句并使用krpano变量
jscall(calc('console.log(&quot;krpano version: ' + version + '&quot;)'));
//返回前一页面
jscall('history.back()');
</code></pre>
<p><strong>获取一个Javascript变量的值或一个Javascript函数的返回值：</strong></p>
<pre><code>jsget(variable, ...Javascript代码... )
</code></pre>
<p>获取Javascript变量或Javascript函数的值，可以在js代码读写krpano接口对象</p>
<ul>
<li>variable<br>
用于存贮返回值的变量名<br>
如果变量不存在则自动创建<br>
<em>Flash模式时注意 - 该语句需要使用Flashplayer的扩展接口，它仅在浏览器内部且在线时有效，当离线浏览或本地url浏览，那么就需要设置Flashplayer的安全设置项</em></li>
</ul>
<pre><code>//得到当前页面的地址
jsget(ret, 'location.href');
trace('地址为：', get(ret));
//让用户输入内容
jsget(passwort, 'prompt(&quot;请输入口令&quot;)');
if(password == 'hidden', ...);
//得到当前日期(YYYY-MM-DD):
jsget(date, 'new Date().toISOString().slice(0,10);');
trace('日期为：', get(date));
js网页跳转： js(eval(this.location=&quot;{url}&quot;))
调用软窗口： js(openWindow({url},{width},{height},{name},{yes/no}));
调用搜索查询窗口： js(openWindow(search.html,290,330,搜索查询,no));
提示窗口： js(alert({弹出窗口}));
</code></pre>
<h2 id="调试">调试</h2>
<p><strong>是否显示输出日志：</strong></p>
<pre><code>showlog(state*)
</code></pre>
<p>显示或隐藏日志信息</p>
<ul>
<li>state (可选)<br>
true - 显示日志信息(默认)<br>
false - 隐藏日志信息</li>
</ul>
<p><strong>变量跟踪：</strong></p>
<pre><code>debugvar(varname)
</code></pre>
<p>在输出日志中显示/跟踪关于变量的详细信息（值和类型），当变量是一个对象时，也将显示所有对象属性。</p>
<p><strong>打印调试信息</strong></p>
<pre><code>debug(...)
 trace(...)
 warning(...)
 error(...)
</code></pre>
<p>将文本或变量输出到日志信息中</p>
<ul>
<li>trace - 信息以”INFO:“开头(白色字体)</li>
<li>error - 信息以”ERROR:“开头(黄色字体)</li>
<li>warning - 信息以”WARNING:“开头(蓝色字体)</li>
<li>debug - 信息以”DEBUG:“开头(绿色字体)，并且仅在 debugmode=true 时才显示<br>
<em>注意- 过多地输入跟踪信息会影响全景渲染效率，尤其不要在每一帧都有跟踪信息</em></li>
</ul>
<pre><code> trace('view.maxpixelzoom=', view.maxpixelzoom);
&lt;events onkeydown=&quot;trace('keycode=',keycode);&quot; /&gt;
onresize=&quot;trace('size=',stagewidth,'x',stageheight);&quot;
onclick=&quot;trace('mouse clicked at ', mouse.x, ' / ', mouse.y);&quot;
trace('xyz=',xyz,' get(xyz)=',get(xyz));
</code></pre>
<p><strong>显示一个错误消息,并阻止用户交互:</strong></p>
<pre><code>fatalerror(errormessage)
</code></pre>
<ul>
<li>errormessage<br>
待显示的错误信息</li>
</ul>
<h2 id="文字">文字</h2>
<p><strong>显示文字（废弃）：</strong></p>
<pre><code>showtext(text, textstyle*)
</code></pre>
<p>在屏幕上显示字符串内容</p>
<ul>
<li>注意：</li>
</ul>
<ol>
<li>以前是内置语句，现在已由showtext.xml这个默认内含插件实现</li>
<li>同一时刻只能显示一个字符串，再次显示新字符串时，当前字符将被清除</li>
</ol>
<figure data-type="image" tabindex="11"><img src="https://www.bwrong.cn/post-images/1566708712771.png" alt="" loading="lazy"></figure>
<pre><code>onhover=&quot;showtext(you are hovering me);&quot;
onhover=&quot;showtext(style text,TEXTSTYLE);&quot; //样式调用
onhover=&quot;showtext(line 1[br]line 2[br]line 3);&quot; //分行
onhover=&quot;showtext([b]bold[/b] [i]italic[/i]);&quot; //字体
</code></pre>
<h2 id="api">API</h2>
<p>官方地址：<a href="https://krpano.com/docu/quickref/#top">地址</a></p>
<h1 id="常用操作">常用操作</h1>
<h2 id="层级问题">层级问题</h2>
<p>方法1.在html中可以使用最大z-index：2147483647避免全屏下弹窗被覆盖问题（慎用）<br>
方法2：将弹窗生成在全景容器内</p>
<figure data-type="image" tabindex="12"><img src="https://www.bwrong.cn/post-images/1566708835193.png" alt="" loading="lazy"></figure>
<h2 id="音乐">音乐</h2>
<p>预加载MP3文件：</p>
<pre><code>preloadsound({mp3})
</code></pre>
<pre><code>playsound: playsound({voice},{mp3},*{Cycle},*{execution});

playsound2D:   playsound2D({voice},{mp3},*{Volume},*{Track },*{Cycle},*{execution});

playsound3D:   playsound3D({voice}, {mp3},{ath},{atv},*{range},*{Volume},*{Cycle},*{execution});

playsound3DHS:
playsound3DHS({voice},{mp3},*{range},*{Volume },*{Cycle },*{execution});
</code></pre>
<p>暂停声音：<code>pausesound({voice});</code></p>
<p>恢复声音：<code>resumesound({voice});</code></p>
<p>暂停/恢复声音：<code>pausesoundtoggle({voice});</code></p>
<p>停止声音：<code>stopsound({voice});</code></p>
<p>停止所有声音：<code>stopallsounds();</code></p>
<h2 id="视频热点">视频热点</h2>
<p><strong>内部控制</strong></p>
<pre><code>播放视频： playvideo({video});

关闭视频： closevideo();

停止：stop();

暂停： pause();

播放：play();

播放/停止：togglepause();
</code></pre>
<p><strong>外部控制</strong></p>
<pre><code>播放视频：hotspot[{name}].playvideo({video});

关闭视频：hotspot[{name}].closevideo();

停止： hotspot[{name}].stop();

暂停： hotspot[{name}].pause();

播放： hotspot[{name}].play();

播放/停止：hotspot[{name}].togglepause();
</code></pre>
<h2 id="全屏">全屏</h2>
<p>切换全屏：<code>switch(fullscreen,true);</code></p>
<p>进入全屏：<code>set(fullscreen,true);</code></p>
<p>退出全屏：<code>set(fullscreen,false);</code></p>
<h2 id="键盘鼠标">键盘鼠标</h2>
<p><strong>鼠标类型：</strong></p>
<pre><code>移动到：set(control.mousetype,moveto);

2D拖拽：set(control.mousetype,drag2d);

3D拖拽： set(control.mousetype,drag3d);
</code></pre>
<p><strong>旋转缩放：</strong></p>
<pre><code>
放大：set(fov_moveforce,-1);

缩小：set(fov_moveforce,1);

停止缩放：(fov_moveforce,0);

向左：set(hlookat_moveforce,-1);

向右：set(hlookat_moveforce,1);

停止左右：set(hlookat_moveforce,0);

向上： set(vlookat_moveforce,-1);

向下：set(vlookat_moveforce,1);

停止上下：set(vlookat_moveforce,0);
</code></pre>
<p><strong>鼠标控制类型：</strong><code>control.mousetype </code></p>
<h2 id="场景">场景</h2>
<p><strong>前一场景：</strong></p>
<pre><code>_loadpano(%FIRSTXML%GigaMap/{scene_id}/scene.xml,MERGE,{blend})
</code></pre>
<p><strong>后一场景：</strong></p>
<pre><code>_loadscene(get(SSet.Next_Scene_ID));
</code></pre>
<p><strong>场景调用：</strong></p>
<pre><code>loadpano(%FIRSTXML%scene/{scene_id}/scene.xml,MERGE,{blend})
loadpano(pano2.xml);
loadpano(pano2.xml, null, MERGE, BLEND(1));
loadscene(scene1);
loadscene(scene1, null, MERGE, BLEND(1));
loadxml('&lt;krpano&gt;&lt;image&gt;&lt;sphere url=&quot;pano.jpg&quot;/&gt;&lt;/image&gt;&lt;/krpano&gt;');
loadxml(get(data[xml].content), null, KEEPALL);
loadpano('%SWFPATH%/pano.xml', null, MERGE, BLEND(2));
loadpano(sphere.xml, image.hfov=1.0&amp;view.limitview=fullrange);
</code></pre>
<p><strong>矩阵地图调用：</strong></p>
<pre><code>loadpano(%FIRSTXML%GigaMap/{scene_id}/scene.xml,MERGE,{blend})
</code></pre>
<h2 id="js通信">JS通信</h2>
<p><strong>JavaScript 调用 Krpano 对象</strong></p>
<pre><code>embedpano({
    //省略其它不相关设置...
    id: &quot;krpanoSWFObject&quot;,
    onready: krpanoReady
});
function krpanoReady() {
    var krpano = document.getElementById('krpanoSWFObject');
    var btn = document.getElementById('btn');
    btn.onclick = function() {
        krpano.call(&quot;webvr.enterVR()&quot;); //进入VR
    };
}
</code></pre>
<p>krpano 对象默认 ID 为krpanoSWFObject，不过为了确定每次都能正常获取到，请在embedpano的onready函数中处理。</p>
<p><strong>Krpano JavaScript 接口对象</strong></p>
<pre><code>set(variable, value) - 将指定数值赋值给指定 krpano 对象
get(variable) - 返回指定 krpano 变量的数值
call(action) - 调用和执行任意 krpano 动作代码
spheretoscreen(h, v) - 直接调用 spheretoscreen 动作
screentosphere(x ,y) - 直接调用 screentosphere 动作
</code></pre>
<p><strong>Krpano 调用 JavaScript</strong></p>
<pre><code>jscall(&quot;任何JS代码&quot;)
jscall(&quot;alert('11')&quot;)
jscall(&quot;window.funName()&quot;)
jsget(variable, &quot;javascript code&quot;) //返回值所存储的krpano变量的名字，变量不存在则创建
</code></pre>
<p><strong>js获取任何标签的属性</strong></p>
<pre><code>function Getinfo() {

var krpano = document.getElementById(&quot;krpanoSWFObject&quot;);

var ath = krpano.get('hotspot[hotspot1].ath');
var atv = krpano.get('hotspot[hotspot1].atv');
alert(&quot;ath:&quot; + ath+&quot; atv:&quot; + atv);

}

&lt;hotspot name=&quot;hotspot1&quot; url=&quot;http://www.new720.com/images/logo.png&quot;  onclick=&quot;js(Getinfo())&quot;  ath=&quot;0&quot; atv=&quot;0&quot; ondown=&quot;draghotspot();&quot; /&gt;
</code></pre>
<p>Flash 注意事项<br>
该动作需要 Flashplayer 的外部接口，这样在浏览器运行时才可用。本地或离线使用有<code>file://</code>的路径时，使用 Flashplayer 的本地/离线调用设置。</p>
<h3 id="js调用全景action带参数">JS调用全景action(带参数)</h3>
<p>在xml中编写一个action,如：</p>
<pre><code>&lt;action name=&quot;layerinfo&quot;&gt;
trace(%1);
&lt;/action&gt;
</code></pre>
<p>在页面中编写js脚本，如：</p>
<p>注意事项，embedpano中的ID名称和JS获取的ID名称要一致</p>
<pre><code>&lt;script type=&quot;text/javascript&quot;&gt;
 var krpano = document.getElementById(&quot;krpanoSWFObject&quot;);
 krpano.call(&quot;layerinfo('New720.cn');&quot;);
&lt;/script&gt;
</code></pre>
<h2 id="获取中心坐标">获取中心坐标</h2>
<p>方法一：</p>
<pre><code>var krpano = document.getElementById(‘krpanoSWFObject’);

krpano.set(“curscreen_x”, window.innerWidth / 2);
krpano.set(“curscreen_y”, window.innerHeight/ 2);
krpano.call(“screentosphere(curscreen_x, curscreen_y, curscreen_ath, curscreen_atv);”);
ath = krpano.get(“curscreen_ath”);
atv = krpano.get(“curscreen_atv”);
</code></pre>
<p>方法二：</p>
<pre><code>var ath = krpano.view.hlookat;
var atv = krpano.view.vlookat;
</code></pre>
<h2 id="全景视频">全景视频</h2>
<pre><code>&lt;krpano&gt;
    &lt;!-- include the videoplayer plugin --&gt;
    &lt;plugin name=&quot;video&quot;
            url.flash=&quot;videoplayer.swf&quot;
            url.html5=&quot;videoplayer.js&quot;
            videourl=&quot;video.mp4|video.webm&quot;
            /&gt;
    &lt;!-- define the pano image and refer to the videoplayer plugin --&gt;
    &lt;image&gt;
        &lt;sphere url=&quot;plugin:video&quot; /&gt;
    &lt;/image&gt;
&lt;/krpano&gt;
</code></pre>
<p><strong>方法：</strong></p>
<pre><code>plugin[video].playvideo('video2.mp4|video2.webm');
</code></pre>
<h2 id="krpano-tools使用">krpano tools使用</h2>
<p>具体使用方法参考官网：<a href="https://krpano.com/tools/">地址</a></p>
<h1 id="常用插件">常用插件</h1>
<p>krpano提供了一个小而简单的接口开发自己的插件，插件可以是<code>Flash(. swf)</code>,<code>Javascript(js)</code>,<code>xml(xml)</code>插件。</p>
<p>官网地址：<a href="https://krpano.com/docu/plugininterface">地址</a></p>
<p>可以自己开发插件，这里只介绍官方的免费插件</p>
<h3 id="建议">建议</h3>
<p>在日常开发中，需要定制高级功能的时候建议按照插件来开发，每个插件可单独配置、低耦合，在需要的时候引入文件即可，不对其他功能造成影响，以下是个人开发结构，为了减少请求数，通过构建工具自动监听文件变化，最终合并成一个主文件，上线也只需要此文件即可。<br>
如果您有更好的方案或者其他想法也可以一起探讨。</p>
<figure data-type="image" tabindex="13"><img src="https://www.bwrong.cn/post-images/1566708965236.png" alt="" loading="lazy"></figure>
<h2 id="combobox">Combobox</h2>
<p>首先需要导入插件<code>&lt;include url=&quot;plugins/combobox.xml&quot; /&gt;</code><br>
<strong>创建静态列表框：</strong></p>
<pre><code>&lt;combobox name=&quot;box1&quot; design=&quot;default&quot; ...any layer settings...&gt;
    &lt;item name=&quot;item1&quot; caption=&quot;Item 1&quot; onclick=&quot;...&quot; /&gt;
    &lt;item name=&quot;item2&quot; caption=&quot;Item 2&quot; onclick=&quot;...&quot; /&gt;
    &lt;item name=&quot;item3&quot; caption=&quot;Item 3&quot; onclick=&quot;...&quot; /&gt;
&lt;/combobox&gt;
</code></pre>
<p><strong>动态创建列表框：</strong></p>
<pre><code>&lt;action name=&quot;test&quot;&gt;
    addComboboxLayer(box1, default);
    set(layer[box1].align, 'lefttop');
    set(layer[box1].x, 20);
    set(layer[box1].y, 20);
    layer[box1].addItem('Item 1', trace(Item 1 clicked) );
    layer[box1].addItem('Item 2', trace(Item 2 clicked) );
    layer[box1].addItem('Item 3', trace(Item 3 clicked) );
&lt;/action&gt;
</code></pre>
<p><strong>大小位置：</strong></p>
<ul>
<li>位置类似layer一样通过align，edeg，x，y，parent来设置</li>
<li>如不设置宽度，将取item中的最大宽度</li>
<li>无需设置高度，高度总是自适应的</li>
</ul>
<p><strong>属性/事件</strong></p>
<pre><code>design=&quot;default&quot;  设计方案
selecteditemindex  选中项的索引（只读）
onchange=&quot;&quot;  选定项目改变时调用
item=&quot;&quot;  包含的项目，数组格式，layer[cbname].item[itemname].*/layer[cbname].item.count
item[itemname].caption   项目的标题文本
item[itemname].onclick   项目的点击事件
</code></pre>
<p><strong>插件操作</strong></p>
<pre><code>addComboboxLayer(name, design*)   添加列表框（名字，设计方案）
removeComboboxLayer(name)    移除
layer[name].addItem(caption, onclick)    添加项及对应事件
layer[name].addNamedItem(name, caption, onclick)    添加项，标题及对应事件
layer[name].selectItem(caption)    根据标题选择项
layer[name].selectItemByName(name)    根据name选择项
layer[name].removeAll()    移除所有项
layer[name].openList()    打开列表
layer[name].closeList()    关闭列表
</code></pre>
<p><strong>自定义设计方案</strong><br>
通过 &lt; combobox_design &gt;元素定义，具有以下属性</p>
<pre><code>margin=&quot;2&quot;   边距
open_close_speed=&quot;0.25&quot;   打开/关闭速度(秒)
</code></pre>
<p>内部包含三个style元素分别设置容器，遮罩及项目的样式</p>
<pre><code>&lt;combobox_design name=&quot;default&quot; margin=&quot;2&quot; open_close_speed=&quot;0.25&quot;&gt;
    &lt;style name=&quot;combobox_container_style&quot;
           bgalpha=&quot;1.0&quot;
           bgcolor=&quot;0xFFFFFF&quot;
           bgborder=&quot;1 0xFFFFFF 0.5&quot;
           bgroundedge=&quot;1&quot;
           bgshadow=&quot;0 1 3 0x000000 1.0&quot;
           /&gt;
    &lt;style name=&quot;combobox_marker_style&quot;
           css=&quot;color:#FFFFFF;&quot;
           bg=&quot;false&quot;
           txtshadow=&quot;0 0 2 0x000000 1&quot;
           /&gt;
    &lt;style name=&quot;combobox_item_style&quot;
           css=&quot;color:#222222;&quot;
           padding=&quot;4 4&quot;
           bg=&quot;false&quot;
           bgcolor=&quot;0xC7E4FC&quot;
           bgalpha=&quot;1.0&quot;
           bgroundedge=&quot;1&quot;
           txtshadow=&quot;0 0 1 0xFFFFFF 1.0&quot;
           /&gt;
&lt;/combobox_design&gt;
</code></pre>
<h3 id="此处有坑combobox和actioncalc_pos_from_hfov_yaw_pitch_roll中cb变量冲突">此处有坑：combobox和action（calc_pos_from_hfov_yaw_pitch_roll）中cb变量冲突</h3>
<ul>
<li>combobox不能放在其他layer内，可以通过parent来指定父级</li>
<li>如果同时使用了最新版（1.19 pr13）的combobox 插件 及calc_pos_from_hfov_yaw_pitch_roll这个action  会出错，因为他们都使用了同一个变量 cb 。 只需要将calc_pos_from_hfov_yaw_pitch_roll中的变量改下名字就好。<br>
<img src="https://www.bwrong.cn/post-images/1566708991259.png" alt="" loading="lazy"></li>
</ul>
<hr>
<p>官方文档：<a href="https://krpano.com/plugins/combobox/#top">地址</a></p>
<h2 id="videoplayer">Videoplayer</h2>
<p><strong>layer：</strong></p>
<pre><code>&lt;layer name=&quot;video&quot;
       url.flash=&quot;videoplayer.swf&quot;
       url.html5=&quot;videoplayer.js&quot;
       videourl=&quot;video.m4v|video.webm&quot;
       posterurl=&quot;videoposter.jpg&quot;
       align=&quot;center&quot; x=&quot;0&quot; y=&quot;0&quot;
       pausedonstart=&quot;false&quot;
       loop=&quot;false&quot;
       volume=&quot;1.0&quot;
       onvideoready=&quot;&quot;
       onvideoplay=&quot;&quot;
       onvideopaused=&quot;&quot;
       onvideocomplete=&quot;&quot;
       onerror=&quot;&quot;
       /&gt;
</code></pre>
<p><strong>3 d-distorted热点：</strong></p>
<pre><code>&lt;hotspot name=&quot;video&quot;
         url.flash=&quot;videoplayer.swf&quot;
         url.html5=&quot;videoplayer.js&quot;
         videourl=&quot;video.m4v|video.webm&quot;
         posterurl=&quot;videoposter.jpg&quot;
         ath=&quot;0.0&quot; atv=&quot;0.0&quot;
         distorted=&quot;true&quot;
         scale=&quot;1.0&quot;
         rx=&quot;0.0&quot;
         ry=&quot;0.0&quot;
         rz=&quot;0.0&quot;
         pausedonstart=&quot;false&quot;
         loop=&quot;false&quot;
         volume=&quot;1.0&quot;
         directionalsound=&quot;true&quot;
         range=&quot;90.0&quot;
         rangefalloff=&quot;1.0&quot;
         outofrangevolume=&quot;0.0&quot;
         onvideoready=&quot;&quot;
         onvideoplay=&quot;&quot;
         onvideopaused=&quot;&quot;
         onvideocomplete=&quot;&quot;
         onerror=&quot;&quot;
         /&gt;
</code></pre>
<p><strong>全景图像:</strong></p>
<pre><code>&lt;plugin name=&quot;video&quot;
        url.flash=&quot;videoplayer.swf&quot;
        url.html5=&quot;videoplayer.js&quot;
        videourl=&quot;video.m4v|video.webm&quot;
        posterurl=&quot;videoposter.jpg&quot;
        panovideo=&quot;true&quot;
        pausedonstart=&quot;false&quot;
        loop=&quot;false&quot;
        volume=&quot;1.0&quot;
        onvideoready=&quot;&quot;
        onvideoplay=&quot;&quot;
        onvideopaused=&quot;&quot;
        onvideocomplete=&quot;&quot;
        onerror=&quot;&quot;
        /&gt;

&lt;image hfov=&quot;360&quot; vfov=&quot;180&quot;&gt;
   &lt;sphere url=&quot;plugin:video&quot; /&gt;
&lt;/image&gt;
</code></pre>
<p><strong>属性：</strong></p>
<pre><code>`videourl：`视频地址，一般就是MP4+webm，优先从左到右，可用preferredformat调整（MPEG4 / H264 (。 mp4,。 m4v。mov)- flash播放器/ Firefox(Windows 7 +)/ Safari和Chrome / IE Android / iOS /
WebM (.webm)——Firefox和Chrome
Ogg Theora (。 ogg,.ogv)- Firefox和Chrome
Flash视频 (。 flv,.f4v)——flash播放器
RTMP视频流 ( rtmp:/ / url)- flash播放器
HTTP流媒体直播 (。 m3u,.m3u8)——iOS,Mac Safari只——而且只有&lt;层&gt;用法,不是因为帕诺人——因为这个视频 iOS错误 !）

posterurl（html5）：封面，默认第一帧
panovideo （use_as_videopano 老版）：false是否用作全景视频
pausedonstart：false在一开始是否暂停
loop:false循环
volume：音量 0.0-1.0
muted（html5）：静音
playbackrate（html5）：1.0回放速度
directionalsound（flash）：3d声音音效
range（flash）：90.0
rangefalloff （flash）：1.0
outofrangevolume（flash）：0.0
preferredformat（html5）：格式优先
autopause（html5） ：true自动暂停视频当浏览器选项卡/窗口被隐藏
autoresume（html5）：false自动恢复视频的时候停顿了一下,然后通过隐藏浏览器选项卡/窗口
html5controls（html5）：false当启用(设置为true),显示浏览器内置的视频控件。
html5preload（html5）：auto预加载
buffertime（falsh）：0.1视频应该在开始之前加载/缓冲的时间
ignoremetadata（flash）：false
playsinline（html5）：true在移动设备上播放视频内联krpano(iPhone、iPad、Android)。当禁用,那么浏览器就可以最终在自己内部的放像机播放视频
iphoneworkarounds（html5）：true使工作区为iPhone视频支持(iOS版本iOS前10)。
touchworkarounds（html5）：true使播放通过触摸手机和平板设备的解决方案
</code></pre>
<p><strong>事件：</strong></p>
<pre><code>onvideoready：准备就绪
onvideoplay：播放
onvideopaused：暂停
onvideocomplete：播放完成
onerror：错误
onneedtouch：需要触摸
ongottouch：触摸时
</code></pre>
<p><strong>状态（只读）：</strong></p>
<pre><code>isvideoready
ispaused
isseeking
iscomplete
isautopaused
needtouch
videoerror
time
totaltime
videowidth
videoheight
loadedbytes
totalbytes
</code></pre>
<p><strong>操作：</strong></p>
<pre><code>playvideo(url, posterurl, pausedonstart, starttime)
play()
pause()
togglepause()
stop()
seek(time)
</code></pre>
<hr>
<p>官网地址:<a href="https://krpano.com/plugins/videoplayer">地址</a></p>
<h2 id="scrollarea">Scrollarea</h2>
<pre><code>&lt;layer name=&quot;scrollarea&quot;
       url=&quot;scrollarea.swf&quot; alturl=&quot;scrollarea.js&quot;
       parent=&quot;...&quot;
       align=&quot;...&quot; width=&quot;...&quot; height=&quot;...&quot;
       direction=&quot;all&quot;      //方向h/v/all
       draggable=&quot;true&quot;   //允许拖动
       mwheel=&quot;true&quot;        //鼠标滚动
       onhover_autoscrolling=&quot;false&quot;  //hover自动滚动
       overscroll=&quot;1.0&quot;   //滚动超出
       friction=&quot;0.95&quot;   //摩擦
       acceleration=&quot;0.08&quot;  //运动加速度
       returnacceleration=&quot;0.15&quot;  //回弹
       momentum=&quot;0.06&quot; //动力加速度
       onscroll=&quot;&quot;  //滚动回调
       /&gt;
</code></pre>
<p><strong>只读属性：</strong></p>
<pre><code>loverflow (只读) loverflow =左溢
roverflow (只读) roverflow =对溢出
toverflow (只读) toverflow =顶部溢出
boverflow (只读) boverflow =底部溢出
woverflow (只读) woverflow =总宽度溢出
hoverflow (只读) hoverflow =总高度溢出
</code></pre>
<p><strong>事件</strong><br>
onscroll  //滚动<br>
setcenter(x,y)   //设置中心<br>
scrolltocenter(x,y)  //滚动到中心<br>
scrollby(dx,dy)  //设置滚动速度向量<br>
stopscrolling()   //停止滚动</p>
<hr>
<p>官方文档：<a href="https://krpano.com/plugins/scrollarea/#top">地址</a></p>
<h2 id="gyro2新">Gyro2（新）</h2>
<p>使用手机/平板电脑设备的陀螺仪和加速度传感器来控制全景查看方向，相比旧版（gyro插件），此版本更快，相应更及时、准确、流畅，建议使用新版。</p>
<p><strong>支持：</strong><br>
ios,android，windows phone只要设备本身有硬件支持都可以使用<br>
<strong>用法：</strong></p>
<pre><code>&lt;plugin name=&quot;gyro&quot;
		devices=&quot;html5&quot;
        keep=&quot;true&quot;
        url=&quot;gyro2.js&quot;  //引入插件
        enabled=&quot;false&quot;   //是否启用陀螺仪
        camroll=&quot;true&quot;  //根据设备旋转调整观看位置
        friction=&quot;0.0&quot;   0.0-0.99或者auto  摩擦力，auto和zoom/fov/frame-rate有关
        touch_mode=&quot;full&quot;  off(关闭)/horizontaloffset（横向）/full（全部）/disablegyro（）,触摸方式
        sensor_mode=&quot;1&quot;  传感器类型
        softstart=&quot;0.5&quot;  启用陀螺时，方向改变的时间，为0将立即使用gyro-tracked值
        autocalibration=&quot;false&quot;  自动校准陀螺仪
        onavailable=&quot;&quot;
        onunavailable=&quot;&quot;
        onenable=&quot;&quot;
        ondisable=&quot;&quot;
        /&gt;
</code></pre>
<p><strong>属性：</strong><br>
<code>sensor_mode：</code>传感器类型</p>
<ul>
<li>0 =直接使用最新的可用的传感器数据。 没有内插或外推法。 根据sensor-time-intervals的浏览器 运动可以是不平稳的或平滑。</li>
<li>1 =最新之间顺利插入 可用的传感器数据。 这将给一个非常光滑但延迟运动。</li>
<li>2 =预测设备传感器数据之间的旋转,然后插入。</li>
<li>3 =推断最新可用的传感器数据 当前帧的时间。 这将给一个快速响应和平滑运动,但可以有抽搐 当外推/预测数据和实际运动不匹配。</li>
<li>4 =预测当前帧的旋转装置。 这将给一个快速响应和平滑运动,但可以有抽搐 当外推/预测数据和实际运动不匹配。</li>
<li>5 =预测设备旋转和推断 传感器数据从最新的事件当前帧时间。<br>
<strong>状态</strong><br>
<code>isavailable=&quot;false&quot; </code>设备是否支持陀螺仪<br>
<strong>事件</strong></li>
</ul>
<pre><code>onavailable:   在支持陀螺仪的设备上调用
onunavailable：在不支持陀螺仪的设备上调用
onenable： 在陀螺仪启用的时候调用
ondisable： 在陀螺仪禁用的时候调用
</code></pre>
<p><strong>操作</strong><br>
<code>resetSensor(hlookat, vlookat*)：重置陀螺仪方向</code></p>
<h2 id="moretweentypes-plugin">MoreTweenTypes Plugin</h2>
<p>本插件作为tween方法的参数使用。<br>
<strong>Ease Out and In:</strong></p>
<ul>
<li>easeOutInQuart</li>
<li>easeOutInQuint</li>
<li>easeOutInSine</li>
<li>easeOutInBounce</li>
<li>easeOutInCirc</li>
<li>easeOutInCubic</li>
<li>easeOutInExpo<br>
<strong>Ease In and Out:</strong></li>
<li>easeInOutQuad</li>
<li>easeInOutQuart</li>
<li>easeInOutQuint</li>
<li>easeInOutSine</li>
<li>easeInOutBounce</li>
<li>easeInOutCirc</li>
<li>easeInOutCubic</li>
<li>easeInOutExpo</li>
</ul>
<h3 id="引入插件">引入插件</h3>
<pre><code>&lt;plugin url.html5=&quot;moretweentypes.js&quot;
        url.flash=&quot;moretweentypes.swf&quot;
    	preload=&quot;true&quot;
        /&gt;
</code></pre>
<h2 id="gridmenu">Gridmenu</h2>
<h3 id="插件属性配置">插件属性配置</h3>
<p><strong>button(可选)</strong></p>
<ul>
<li>是否展示显示和隐藏网格菜单的默认按钮</li>
<li>默认值=true</li>
</ul>
<p><strong>padding_top(可选)</strong></p>
<ul>
<li>缩略图滚动区域的顶部边距</li>
<li>对手机端该边距将被设置为0</li>
<li>默认值=75</li>
</ul>
<p><strong>padding_bottom(可选)</strong></p>
<ul>
<li>缩略图滚动区域的底部边距</li>
<li>对手机端该边距将被设置为0</li>
<li>默认值=75</li>
</ul>
<p><strong>width_margin(可选)</strong></p>
<ul>
<li>缩略图滚动区域的左右边距</li>
<li>对手机端该边距将被设置为0</li>
<li>默认值=0</li>
</ul>
<p><strong>grid_bgcolor(可选)</strong></p>
<ul>
<li>背景颜色</li>
<li>默认值=0x000000</li>
</ul>
<p><strong>grid_bgalpha(可选)</strong></p>
<ul>
<li>背景透明度</li>
<li>默认值=0.7</li>
</ul>
<p><strong>display_title(可选)</strong></p>
<ul>
<li>展示网格菜单标题</li>
<li>默认值=true</li>
</ul>
<p><strong>grid_title(可选)</strong></p>
<ul>
<li>网格菜单标题</li>
<li>默认值=GRID MENU</li>
</ul>
<p><strong>grid_title_css(可选)</strong></p>
<ul>
<li>网格菜单标题的CSS样式</li>
<li>默认值=<code>color:#ffffff;font-family:Raleway;font-size:35px</code>;</li>
</ul>
<p><strong>group(可选)</strong></p>
<ul>
<li>是否按照分组安排缩略图</li>
<li>注意不在分组中的场景不会被展示</li>
<li>默认值=false</li>
</ul>
<p><strong>current(可选)</strong></p>
<ul>
<li>只展示当前分组的缩略图</li>
<li>默认值=false</li>
</ul>
<p><strong>cat_container_height(可选)</strong></p>
<ul>
<li>分组标题容器的高度</li>
<li>默认值=35</li>
</ul>
<p><strong>cat_container_border(可选)</strong></p>
<ul>
<li>分组标题容器的边框设置</li>
<li>默认值=<code>0,0,1,0 0xffffff 1.00</code></li>
</ul>
<p><strong>cat_container_title_css(可选)</strong></p>
<ul>
<li>分组标题的CSS样式</li>
<li>默认值=<code>color:#ffffff;font-family:Raleway;font-size:25px</code>;</li>
</ul>
<p><strong>cat_container_title_align(可选)</strong></p>
<ul>
<li>分组标题的对齐位置</li>
<li>默认值=left</li>
</ul>
<p><strong>cat_container_border_height(可选)</strong></p>
<ul>
<li>分组标题的底部边距</li>
<li>默认值=1</li>
</ul>
<p><strong>display_cat_desc(可选)</strong></p>
<ul>
<li>是否显示分组的描述</li>
<li>默认值=true</li>
</ul>
<p><strong>cat_desc_css(可选)</strong></p>
<ul>
<li>分组描述的CSS样式</li>
<li>默认值=<code>color:#ffffff;font-family:Raleway;font-size:14px;text-align:left</code></li>
</ul>
<p><strong>thumbs_crop(可选)</strong></p>
<ul>
<li>缩略图的CROP属性</li>
<li>默认值=0|75|240|150</li>
</ul>
<p><strong>thumbs_width(可选)</strong></p>
<ul>
<li>缩略图的宽度</li>
<li>默认值=240</li>
</ul>
<p><strong>thumbs_height(可选)</strong></p>
<ul>
<li>缩略图的高度</li>
<li>默认值=150</li>
</ul>
<p><strong>thumbs_padding(可选)</strong></p>
<ul>
<li>缩略图的边距</li>
<li>默认值=25</li>
</ul>
<p><strong>thumbs_scale (可选)</strong></p>
<ul>
<li>按照百分比为单位的最大缩略图尺寸</li>
<li>默认值=100</li>
</ul>
<p><strong>active_thumb_border(可选)</strong></p>
<ul>
<li>激活的缩略图的边框设置</li>
<li>默认值=3 0xffffff 1.00</li>
</ul>
<p><strong>display_thumb_title(可选)</strong></p>
<ul>
<li>是否展示缩略图标题</li>
<li>默认值=true</li>
</ul>
<p><strong>thumb_title_align(可选)</strong></p>
<ul>
<li>缩略图标题的对齐方式</li>
<li>默认值=bottom</li>
</ul>
<p><strong>thumb_title_x(可选)</strong></p>
<ul>
<li>缩略图标题的X位置</li>
<li>默认值=0</li>
</ul>
<p><strong>thumb_title_y(可选)</strong></p>
<ul>
<li>缩略图标题的Y位置</li>
<li>默认值=5</li>
</ul>
<p><strong>thumb_title_css(可选)</strong></p>
<ul>
<li>缩略图标题的CSS样式</li>
<li>默认值=<code>color:#ffffff;font-family:Raleway;font-size:16px;text-align:left</code>;</li>
</ul>
<p><strong>thumb_title_roundedge(可选)</strong></p>
<ul>
<li>缩略图标题的背景圆角设置</li>
<li>默认值=5</li>
</ul>
<p><strong>thumb_title_background(可选)</strong></p>
<ul>
<li>缩略图标题背景是否显示</li>
<li>默认值=true</li>
</ul>
<p><strong>thumb_title_backgroundcolor(可选)</strong></p>
<ul>
<li>缩略图标题背景颜色</li>
<li>默认值=<code>0x000000</code></li>
</ul>
<p><strong>thumb_title_backgroundalpha(可选)</strong></p>
<ul>
<li>缩略图标题背景透明度</li>
<li>默认值=0.8</li>
</ul>
<p><strong>thumb_title_border(可选)</strong></p>
<ul>
<li>缩略图标题背景边框是否显示</li>
<li>默认值=false</li>
</ul>
<p><strong>thumb_title_borderwidth(可选)</strong></p>
<ul>
<li>缩略图标题边框宽度</li>
<li>默认值=1</li>
</ul>
<p><strong>thumb_title_bordercolor(可选)</strong></p>
<ul>
<li>缩略图标题边框颜色</li>
<li>默认值=<code>0xffffff</code></li>
</ul>
<p><strong>thumb_title_borderalpha(可选)</strong></p>
<ul>
<li>缩略图标题边框透明度</li>
<li>默认值=1</li>
</ul>
<p><strong>thumb_title_padding(可选)</strong></p>
<ul>
<li>缩略图标题边距</li>
<li>默认值=3 10</li>
</ul>
<p><strong>display_thumb_desc(可选)</strong></p>
<ul>
<li>是否在缩略图上显示场景描述</li>
<li>默认值=true</li>
</ul>
<p><strong>thumb_desc_css(可选)</strong></p>
<ul>
<li>场景描述的CSS样式</li>
<li>默认值=<code>color:#ffffff;font-family:Raleway;font-size:15px;text-align:center</code></li>
</ul>
<p><strong>thumb_desc_bg_color(可选)</strong></p>
<ul>
<li>场景描述的背景颜色</li>
<li>默认值=0x000000</li>
</ul>
<p><strong>thumb_desc_bg_alpha(可选)</strong></p>
<ul>
<li>场景描述的背景透明度</li>
<li>默认值=0.6</li>
</ul>
<p><strong>thumb_desc_padding(可选)</strong></p>
<ul>
<li>场景描述的边距</li>
<li>默认值=8 15</li>
</ul>
<p><strong>loadscene_flags(可选)</strong></p>
<ul>
<li>Loadscene动作的flag参数</li>
<li>默认值=MERGE</li>
</ul>
<p><strong>loadscene_blend(可选)</strong></p>
<ul>
<li>Loadscene动作的blend参数</li>
<li>默认值=BLEND(1)</li>
</ul>
<p><strong>vcenter(可选)</strong></p>
<ul>
<li>网格菜单是否垂直居中</li>
<li>默认值=false</li>
</ul>
<h3 id="插件action">插件action</h3>
<p><code>rg_show_thumbs_grid(true/false)</code>:显示或隐藏网格菜单</p>
<p>可以选择不使用默认按钮，或者用下面代码来覆盖</p>
<pre><code>&lt;layer name=&quot;thumbs_button&quot; url=&quot;gridbut.png&quot; keep=&quot;true&quot; align=&quot;bottom&quot; onclick=&quot;rg_show_thumbs_grid(true);&quot; crop=&quot;0|0|45|45&quot; y=&quot;15&quot; zorder=&quot;101&quot;/&gt;
</code></pre>
<h1 id="skin_setting">skin_setting</h1>
<pre><code>&lt;!-- skin_setting 自定义元素，默认皮肤的参数设置--&gt;
maps=&quot;false&quot;  &lt;!-- 是否使用必应地图或谷歌地图 --&gt;
maps_type=&quot;bing&quot;  &lt;!-- 选择使用谷歌地图或必应地图 --&gt;
maps_bing_api_key=&quot;&quot;   &lt;!-- 必应地图所需的API密钥，需申请 --&gt;
maps_google_api_key=&quot;&quot;   &lt;!-- 谷歌地图所需的API密钥，需申请 --&gt;
maps_zoombuttons=&quot;false&quot;   &lt;!-- 是否在地图上显示缩放按钮 --&gt;
gyro=&quot;true&quot;   &lt;!-- 是否使用陀螺仪 --&gt;
webvr=&quot;true&quot;    &lt;!-- 是否启用VR --&gt;
webvr_gyro_keeplookingdirection=&quot;false&quot; &lt;!-- 进入陀螺仪或VR时是否保持观看方向 --&gt;
webvr_prev_next_hotspots=&quot;true&quot;  &lt;!-- 在VR下是否启用导航到前后场景的链接热点--&gt;
littleplanetintro=&quot;false&quot;    &lt;!-- 是否使用小行星开场 --&gt;
title=&quot;true&quot;  &lt;!-- 是否左下角显示title --&gt;
thumbs=&quot;true&quot;  &lt;!-- 是否使用缩略图，如不使用，则没有缩略图一栏 --&gt;
thumbs_width=&quot;120&quot; thumbs_height=&quot;80&quot; thumbs_padding=&quot;10&quot; thumbs_crop=&quot;0|40|240|160&quot;  &lt;!-- 缩略图宽度、高度、间距以及缩略图裁切范围 --&gt;
thumbs_opened=&quot;false&quot;   &lt;!-- 是否在启动时弹出缩略图一栏 --&gt;
thumbs_text=&quot;false&quot;  &lt;!-- 是否在缩略图上显示名字 --&gt;
thumbs_dragging=&quot;true&quot;   &lt;!-- 是否允许鼠标拖拽缩略图区域 --&gt;
thumbs_onhoverscrolling=&quot;false&quot;  &lt;!-- 是否允许鼠标悬停缩略图自动滚动 --&gt;
thumbs_scrollbuttons=&quot;false&quot;   &lt;!-- 是否显示缩略图滚动按钮 --&gt;
thumbs_scrollindicator=&quot;false&quot;   &lt;!-- 是否显示缩略图滚动条 --&gt;
thumbs_loop=&quot;false&quot;  &lt;!-- 滚动按钮是否使用缩略图循环 --&gt;
tooltips_buttons=&quot;false&quot; &lt;!-- 鼠标在按钮悬停时是否弹出文字提示 --&gt;
tooltips_thumbs=&quot;false&quot;  &lt;!-- 鼠标在缩略图悬停时是否弹出文字提示 --&gt;
tooltips_hotspots=&quot;false&quot;   &lt;!-- 鼠标在热点上悬停时是否弹出文字提示 --&gt;
tooltips_mapspots=&quot;false&quot;   &lt;!-- 鼠标在地图热点悬停时是否弹出文字提示 --&gt;
deeplinking=&quot;false&quot;       &lt;!-- 是否使用深度链接获取功能，可使得当前页面路径获取场景及视角信息 --&gt;
loadscene_flags=&quot;MERGE&quot;  &lt;!-- 缩略图切换场景时的变量 --&gt;
loadscene_blend=&quot;OPENBLEND(0.5, 0.0, 0.75, 0.05, linear)&quot;  &lt;!-- 缩略图切换场景时的融合 --&gt;
loadscene_blend_prev=&quot;SLIDEBLEND(0.5, 180, 0.75, linear)&quot;  &lt;!-- 缩略图切换到上一个场景时的融合 --&gt;
loadscene_blend_next=&quot;SLIDEBLEND(0.5, 0, 0.75, linear)&quot;  &lt;!-- 缩略图切换到下一个场景时的融合 --&gt;
loadingtext=&quot;载入中...&quot; &lt;!-- 在全景图载入中时显示的文字 --&gt;
layout_width=&quot;100%&quot;  &lt;!--导航条容器相对屏幕宽度的百分比 --&gt;
layout_maxwidth=&quot;814&quot;  &lt;!--导航条容器的最大宽度像素 --&gt;
controlbar_width=&quot;-24&quot; &lt;!--导航条背景的宽度像素 --&gt;
controlbar_height=&quot;40&quot;  &lt;!--导航条背景的高度像素 --&gt;
controlbar_offset.normal=&quot;20&quot;  &lt;!--导航条背景与屏幕底部的距离--&gt;
controlbar_offset_closed=&quot;-40&quot;  &lt;!--导航条隐藏状态时与屏幕底部的距离--&gt;
controlbar_overlap.no-fractionalscaling=&quot;10&quot;  &lt;!--在不支持分级缩放页面和设置像素比的设备的导航条重叠的像素--&gt;
controlbar_overlap.fractionalscaling=&quot;0&quot; &lt;!--支持分级缩放页面和设置像素比的设备的导航条重叠的像素--&gt;
design_skin_images=&quot;vtourskin.png&quot; &lt;!--皮肤所用的源图片--&gt;
design_bgcolor=&quot;0x000000&quot; &lt;!--皮肤的背景颜色--&gt;
design_bgalpha=&quot;0.5&quot; &lt;!--皮肤的透明度--&gt;
design_bgborder=&quot;0 0xFFFFFF 1.0&quot; &lt;!--皮肤的边框--&gt;
design_bgroundedge=&quot;1&quot; &lt;!--皮肤边框圆角设置--&gt;
design_bgshadow=&quot;0 0 9 0xFFFFFF 0.5&quot; &lt;!--皮肤的背景阴影--&gt;
design_thumbborder_bgborder=&quot;4 0xFFFFFF 1.0&quot; &lt;!--皮肤的缩略图边框--&gt;
design_thumbborder_padding=&quot;2&quot; &lt;!--皮肤缩略图边框间距--&gt;
design_thumbborder_bgroundedge=&quot;5&quot; &lt;!--皮肤缩略图边框的圆角--&gt;
design_text_css=&quot;color:#FFFFFF; font-family:Arial; font-weight:bold;&quot;&lt;!--皮肤文字样式--&gt;
design_text_shadow=&quot;1&quot; &lt;!--皮肤的文字阴影--&gt;
&lt;!-- 如果你要更改皮肤样式，你可以改变上面的skin_settings数值，或者选择性地include下面一个预设的设计，可以通过移除特定include元素的if属性或者在html文件的embedpano()中增加initvar:{design:’flat_light’}。 --&gt;
&lt;include url=&quot;skin/vtourskin_design_glass.xml&quot;       if=&quot;design === 'glass'&quot;       /&gt;
&lt;include url=&quot;skin/vtourskin_design_flat.xml&quot;        if=&quot;design === 'flat'&quot;        /&gt;
&lt;include url=&quot;skin/vtourskin_design_flat_light.xml&quot;  if=&quot;design === 'flat_light'&quot;  /&gt;
&lt;include url=&quot;skin/vtourskin_design_ultra_light.xml&quot; if=&quot;design === 'ultra_light'&quot; /&gt;
&lt;include url=&quot;skin/vtourskin_design_117.xml&quot;         if=&quot;design === '117'&quot;         /&gt;
</code></pre>

							</div>
	<div class="wow fadeInUp vt-post-tags">
 
				<a href="https://www.bwrong.cn/tag/krpano/" rel="tag">krpano</a>
				 
				<a href="https://www.bwrong.cn/tag/8oJ3wVbjv/" rel="tag">全景漫游</a>
				 
				<a href="https://www.bwrong.cn/tag/DgJ4jOTy2/" rel="tag">720</a>
				 
					</div>
<nav class="navigation3 post-navigation3" role="navigation">

		<div class="nav-links3">
      
		<div class="wow fadeInUp nav-previous3"><a href="https://www.bwrong.cn/post/vue-jsx-quan-mian-zhi-nan/" rel="prev"> Vue jsx全面指南</a></div>
		 
		 
		<div class="wow fadeInUp nav-next3"><a href="https://www.bwrong.cn/post/vue2/" rel="next"> VUE2.0学习笔记</a></div>
		
		</div>
	</nav>
	<div class="wow fadeInUp author-info">
	<div class="author-avatar pull-left"><img src="https://www.bwrong.cn/images/avatar.png" ></div>
 
	<div class="author-description"><div class="author-title"><div class="author-link" rel="author">BWrong</div></div>


	<p class="author-bio">愿你走出半生，归来仍是少年</p></div></div>
	
		</div>



</article>

<div id="marlin_lite_about_widget-2" class="wow fadeInUp widget marlin_lite_about_widget" data-wow-delay="0.1s">

        
		<script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
<script src='https://www.bwrong.cn/media/scripts/Valine.min.js'></script>

<div class="comment"></div>
<script>
        new Valine({
            av: AV,
            el: '.comment',
            lang: 'zh-cn',
            visitor: false, // 阅读量统计
            
            admin_email:'wang11535041@qq.com',
            
            
            emoticon_url: '/media/alu',
             
      emoticon_list: ["吐.png","喷血.png","狂汗.png","不说话.png","汗.png","坐等.png","献花.png","不高兴.png","中刀.png","害羞.png","皱眉.png","小眼睛.png","中指.png","尴尬.png","瞅你.png","想一想.png","中枪.png","得意.png","肿包.png","扇耳光.png","亲亲.png","惊喜.png","脸红.png","无所谓.png","便便.png","愤怒.png","蜡烛.png","献黄瓜.png","内伤.png","投降.png","观察.png","看不见.png","击掌.png","抠鼻.png","邪恶.png","看热闹.png","口水.png","抽烟.png","锁眉.png","装大款.png","吐舌.png","无奈.png","长草.png","赞一个.png","呲牙.png","无语.png","阴暗.png","不出所料.png","咽气.png","期待.png","高兴.png","吐血倒地.png","哭泣.png","欢呼.png","黑线.png","喜极而泣.png","喷水.png","深思.png","鼓掌.png","暗地观察.png"],
     
      app_id: 'jaz3TfUjRowK9fOMAPb9yw6i-MdYXbMMI',
      
      
      app_key: 'pbltxx4rElIP1RStL3AwujSp',
         
          
      placeholder: '欢迎你留下足迹'
       
        });
    </script>





		</div>

			</div>
			


<div class="tocc col l3 hide-on-med-and-down">

        <div class="toc-widget">

            <div class="toc-title"></div>

            <div id="toc-content">


			</div>
        </div>
    </div>


<script src="https://www.bwrong.cn/media/scripts/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '.entry-summary',
            headingsOffset: -($(window).height() * 0.4 - 45),
            // headingsOffset: -205,
            headingSelector: 'h1,h2' //**
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('.entry-summary').children('h1, h2').each(function () {/**/
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget').parent();
        // let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });
    });
</script>






			</div>
		</div>


		 <footer id="colophon" class="site-footer">

	<div class="container">

		<div class="copyright"> <br>Theme: <a
				href="https://github.com/alterfang/gridea-theme-pan" target="_blank" title="Pan"><span>Pan</span></a>.
			Powered by <a href="https://gridea.dev/" target="_blank" title="Gridea"><span>Gridea</span></a> . 版权所有：<a href="https://beian.miit.gov.cn/" target="_blank"><span>蜀ICP备2023018303号-1</span></a></div>
	</div>

</footer>
		<!-- loding -->
		<div class="loader">
			<div class="loader-content">
				<div class="songjingge">
					<span></span>
					<span></span>
					<span></span>
					<span></span>
					<span></span>
				</div>
			</div>
		</div>
<script id="rendered-js">
	window.onload = function () {
			var loader = document.getElementsByClassName("loader")[0];
			loader.className = "loader fadeout"; //使用渐隐的方法淡出loading page
			setTimeout(function () {
				loader.style.display = "none";
			}, 0);
	};
</script>


</div>

<script src="https://cdn.bootcss.com/fitvids/1.2.0/jquery.fitvids.min.js"></script>
<script type='text/javascript' src='https://www.bwrong.cn/media/scripts/marlin-scripts.js'></script>
<script src="https://www.bwrong.cn/media/scripts/lately.min.js"></script>
<script>jQuery(document).ready(function () { $.lately({ 'target': '.lately-a,.lately-b,.lately-c' }) });</script>
<style type="text/css">
  a.back_to_top {
    text-decoration: none;
    position: fixed;
    bottom: 40px;
    right: 30px;
    background: #f0f0f0;
    height: 40px;
    width: 40px;
    border-radius: 50%;
    line-height: 36px;
    font-size: 18px;
    text-align: center;
    transition-duration: .5s;
    transition-propety: background-color;
    display: none;
  }

  a.back_to_top span {
    color: #888;
  }

  a.back_to_top:hover {
    cursor: pointer;
    background: #dfdfdf;
  }

  a.back_to_top:hover span {
    color: #555;
  }

  @media print,
  screen and (max-width: 580px) {
    .back_to_top {
      display: none !important;
    }
  }
</style><a id="back_to_top" href="#" class="back_to_top"><span><i class="iconfont icon-xiangshang"></i></span>
</a>

<script>
$(document).ready((function (_this) {
    return function () {
      var bt;
      bt = $('#back_to_top');
      if ($(document).width() > 480) {
        $(window).scroll(function () {
          var st;
          st = $(window).scrollTop();
          if (st > 30) {
            return bt.css('display', 'block');
          } else {
            return bt.css('display', 'none');
          }
        });
        return bt.click(function () {
          $('body,html').animate({
            scrollTop: 0
          }, 800);
          return false;
        });
      }
    };
  })(this));
//   $(window).load(function () {
//     //异步延迟加载样式
//     var link = $('<link />');
//     link.attr('href', 'https://fonts.googleapis.com/css?family=Dancing+Script|Noto+Sans+SC:300|Montserrat&display=swap');
//     link.attr('rel', 'stylesheet');
//     link.appendTo($('head'));
// });
</script>

<!-- 宠物 -->
<canvas id="live2dcanvas" width="200" height="400" class="live2d"></canvas>
<style>
  #live2dcanvas {
    position: fixed;
    right: 0px;
    z-index: 999;
    pointer-events: none;
    bottom: -40px;
    width: 200px;
    height: 400px;
  }

  @media (max-width: 768px) {
    #live2dcanvas {
      width: 150px;
      height: 300px;
    }
  }

  @media (max-width: 639px) {
    #live2dcanvas {
      display: none !important;
    }
  }
</style>
<script src="https://www.bwrong.cn/media/scripts/L2Dwidget.min.js"></script>
<script>
  //初始化小人物 需设置属性pluginRootPath: "live2dw/"指明资源跟路径
  L2Dwidget.init({
    pluginRootPath: "media/",//资源root路径
    pluginJsPath: "scripts/",//js相对root的路径
    pluginModelPath: "model/",//模型相对root的路径
    tagMode: !1,
    debug: !1,
    model: {
      scale: 2,
      jsonPath: "/media/model/live2d-widget-model-epsilon/Epsilon2.1.model.json"
    },
    display: {//大小位置什么的自己慢慢调就是了
      position: "right",//定位
      width: 130,//宽度
      height: 210,//高度
      hOffset: -40,//左右
      vOffset: 0//上下
    },
    mobile: {
      show: !1
    },
    log: !1
  });
</script>
<!-- 宠物结束 -->

		<script data-no-instant>
    // (function ($) {
    //     $.extend({
    //         adamsOverload: function () {
    //             $('.navigation:eq(0)').remove();
    //             $("").attr("rel" , "external");
    //             $("a[rel='external'],a[rel='external nofollow']").attr("target","_blank");
    //             $("a.vi").attr("rel" , "");
    //             $.viewImage({
    //                 'target'  : 'img',
    //                 'exclude' : '.vsmile-icons img,.gallery img',
    //                 'delay'   : 300
    //             });
    //             $.lately({
    //                 'target' : '.commentmetadata a,.infos time,.post-list time'
	// 			});
	// 			console.log(prettyPrint)
	// 			if(prettyPrint) prettyPrint();

    //             $('ul.links li a').each(function(){
    //                 if($(this).parent().find('.bg').length==0){
    //                     $(this).parent().append('<!---<div class="bg" style="background-image:url(https://c3.glgoo.top/s2/favicons?domain='+$(this).attr("href")+')"></div>--->')
    //                 }
    //             });
    //         }
    //     });
    // })(jQuery);
	// jQuery.adamsOverload();

    (function ($) {
        $.extend({
            adamsOverload: function () {
                $.viewImage({
                    'target'  : '.song img',
                    'exclude' : '.vsmile-icons img',
                    'delay'   : 300
                });
            }
        });
    })(jQuery);
    jQuery.adamsOverload();
</script>

</body>
</html>
