<!DOCTYPE html>
<html lang="zh">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>
    
    【前端工程化】篇四 席卷八荒-Webpack（进阶） - Bwrong的拾光
    
    </title>
    <link rel="shortcut icon" href="asset/avatar.png" type="image/png" />

    
    
    <link href="atom.xml" rel="alternate" title="Bwrong的拾光" type="application/atom+xml">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="asset/css/style.min.css">
    <link rel="stylesheet" href="asset/css/doc.css">
    <script src="asset/app.js"></script>
</head>
  <body>
    <section class="hero">
      <div class="hero-head animate__animated animate__fadeInDown">
          <nav class="navbar" role="navigation" aria-label="main navigation">
              <div class="container">
              <div class="navbar-brand">
                
                <a target="_self" class="navbar-item " href="index.html">首页</a>
                
                <a target="_self" class="navbar-item " href="archives.html">归档</a>
                
                <a target="_self" class="navbar-item " href="about.html">关于</a>
                

                <a role="button" id="navbarSNSRssSwitchBtn" class="navbar-burger burger" aria-label="menu" aria-expanded="false" data-target="navbarSNSRssButtons">
                  <span aria-hidden="true"></span>
                  <span aria-hidden="true"></span>
                  <span aria-hidden="true"></span>
                </a>
              </div>

              <div id="navbarSNSRssButtons" class="navbar-menu">
                <div class="navbar-start">

                </div>

                <div class="navbar-end">
                  <div class="navbar-item">
                    <!--buttons start-->
                    <div class="buttons">
                      
                        
                        
                        
                        <a href="https://github.com/BWrong" target="_blank" title="github">
                            <span class="icon is-large has-text-grey-darker">
                               <svg class="svg-inline--fa fa-github fa-w-16 fa-lg" aria-hidden="true" focusable="false" data-prefix="fab" data-icon="github" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512" data-fa-i2svg=""><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path></svg><!-- <i class="fab fa-github fa-lg"></i> -->
                            </span>
                          </a>
                        
                        
                        <a href="https://juejin.cn/user/3421335914820280" target="_blank" title="掘金">
                            <span class="icon is-large has-text-grey-darker">
                               <svg t="1728016596078" class="svg-inline--fa fa-github fa-w-16 fa-lg" viewBox="0 0 1212 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="7574" width="400" height="400"><path d="M484.788807 145.803754c-1.4385 1.0665-2.90475 2.088-4.3605 3.129 0.6105-0.3945 1.2195-0.7905 1.83225-1.182 0.79125-0.5805 1.59375-1.1565 2.373-1.755 0.0525-0.0735 0.10425-0.126 0.15525-0.192z m214.184255 109.169252L474.834807 431.698511c-1.14225 4.88475-2.8845 7.83525-7.192501 11.7585 0.26625 0.198 0.5295 0.402 0.79725 0.59625 3.6465 2.65275 7.7115 4.71375 11.268751 7.485 2.667 2.0775 5.115 4.4235 7.67175 6.6345 3.96 4.94175 9.30225 8.18325 13.94325 12.378 4.05 3.66 1.5825 2.24775 4.512 3.710251 2.43975 3.70575 6.5505 7.6005 7.350001 12.135 1.31775 2.0025 2.46525 4.11375 3.7005 6.16875l1.3995 3.135 242.413506-191.148005z m-437.262011 97.875003c-0.54225 0.36675-1.07925 0.74025-1.605 1.12875-0.015 0.14325-0.03675 0.279-0.042 0.438 0.0495 0.051 0.08775 0.0975 0.135 0.147 0.73275-0.4425 1.46475-0.885 2.196-1.329-0.22575-0.1275-0.44625-0.25275-0.684-0.38475z m627.663766 55.042501L471.926307 737.057268c2.487 1.845 0.669 0.414 5.016 4.119 0.768 2.92875 1.575 5.84775 2.33925 8.77725 1.806 2.24625 3.459 4.68 5.58675 6.58575 0.69225 0.62025-0.03-1.18275-0.92175-2.94975-0.615-0.7845-1.233-1.56525-1.9155-2.28975-0.33225-1.683 0.90225 0.2805 1.9155 2.28975 0.32775 0.41775 0.654 0.83775 0.99 1.248 0.18375 0.93675 0.34125 1.8795 0.495 2.823 0.19275 0.132 0.396 0.27 0.62925 0.417001 2.2815 1.91625 3.747 2.85 5.379 5.41875 0.879 1.38375 1.59075 2.86725 2.2935 4.35 0.8865 0.423 1.755 0.873 2.5425 1.4535 4.128 3.036 6.651 6.315 9.1545 10.29375 1.3215 0.79425 2.48775 1.9095 3.621 2.955 0.33375 0.3075 0.627 0.65025 0.9075 1.00725 2.94975 0.486 5.2875 1.46775 8.902501 4.4175 2.15475 0.41325 4.284 0.91875 6.318 1.7175 0.71625 0.2805 1.3485 0.774 1.91175 1.40175 0.31875 0.015 0.57 0.0375 0.84375 0.0585l423.19201-333.681008z m-422.814011 26.553001c-0.1095 0.093-0.2175 0.18825-0.33 0.2775 0 0.8205 0.01875 1.977 0.048 3.4305 0.075-1.209 0.15075-2.4195 0.30375-3.61125-0.00825-0.04275-0.015-0.05625-0.0225-0.09675z m-6.0135 3.53475c-0.03375 0.01725-0.0675 0.036-0.10125 0.0525l0.0585 0.04275zM0.954795 462.922511v0.0045l-0.60825 0.285c-0.045 0.0225-0.0825 0.045-0.123 0.0675 0.288 0.0105 0.552-0.0375 0.7215-0.20925 0.045-0.045 0.0105-0.0975 0.0105-0.14775z m-0.49725 0.77775c-0.51 0.1485-0.717 0.27 0.0375 0.22575-0.015-0.075-0.0225-0.15-0.0375-0.225z m517.437013 31.638001c-0.0135 0.0105-0.0075 0.06 0.02625 0.1575 0.04275 0.1275 0.102 0.249 0.15 0.37425l0.159-0.126c-0.15975-0.22575-0.3075-0.42825-0.33525-0.40575z m-437.367011 28.428001c-0.11475 0.0075-0.49875 0.11475-0.66075 0.1455-0.1335 0.02475-0.26625 0.05325-0.39975 0.08025 0.36675-0.00075 0.7605-0.01725 1.041-0.1815 0.0075-0.015 0.01275-0.03 0.01875-0.04425z m285.106507 130.753503c-0.069 0.1125-0.144 0.222-0.21375 0.33375-0.357 0.5775-0.71925 1.15425-1.07625 1.73175 1.3665 0.02025 2.73225 0.07275 4.095 0.14625z m102.680252 80.970752c-0.14175 0.17775-0.28875 0.35025-0.43125 0.52725 1.701 2.85 3.04725 6.0345 2.11425 4.275-0.735-1.3875-1.395-2.85225-2.115-4.272-0.0345 0.0435-0.0705 0.0855-0.10575 0.129l0.57 2.83275c0.0105 0.051 0.0135 0.08925 0.0225 0.1395 1.3245 1.97325 2.71125 3.88875 4.293751 5.625 0.79425 0.1935 1.5225 0.45975 2.007 0.77025 0.23925 0.153 0.46875 0.3165 0.696 0.48375 0.06225-1.2585-0.357-3.51675-0.753-4.53825-0.61875-1.596-1.9275-2.7975-3.069-4.10475l-0.4305 0.33975z m0.0555 3.6315c-0.4545-0.678-0.8985-1.36575-1.34475-2.05125-0.17775 0.2175-0.35325 0.43725-0.5325 0.654 0.36525 0.705 0.8565 1.67925 1.5945 3.08625-0.018-1.95 0.34425-0.54525 0.71625 1.8225 0.0075 0.00225 0.009 0.00675 0.0135 0.00975-0.018-0.918-0.16425-2.085-0.447-3.52125z m-3.17475 4.545a2.7675 2.7675 0 0 0-0.58725 0.03975 12.9375 12.9375 0 0 1 1.8015 1.72425c0.18225 0.0555 0.35775 0.0975 0.522 0.12-0.11775-0.55425-0.237-1.1085-0.35775-1.66275-0.50775-0.12-0.9855-0.20775-1.3785-0.22125z m9.583501 2.23875a5.47275 5.47275 0 0 0-0.92025 0.07875c0.2535 0.24675 0.51 0.48975 0.77475 0.72675 0.45525 0.40725 0.663 0.0825 0.72-0.573-0.1875-0.07875-0.369-0.159-0.5745-0.2325z m1.0035 0.4185c1.1325 0.9015 2.13 1.962 3.06825 3.09225-0.47175-1.2105-1.33275-2.26725-3.06825-3.09225z m-1.878 1.2105c0.4245 0.696 0.8235 1.4145 1.2825 2.08125 0.0945-0.615-0.435-1.3455-1.2825-2.08125z m9.93 8.7075c-0.03525 0.03225 0.21225 0.342 0.804 0.82425-0.3855-0.5085-0.67275-0.7755-0.7725-0.819-0.01575-0.0075-0.02625-0.009-0.0315-0.00525z m1.7385 2.275501c0.3585 2.20125 0.726 4.401 1.35975 6.53475 0.336 1.134 0.3885-2.4375-0.01725-3.5475-0.45225-1.23375-0.915-2.21775-1.3425-2.98725z m-1.76625 5.21475c0 0.00525 0.0075 0.0255 0.02925 0.063 0.192 0.324 0.405 0.639 0.612 0.9555-0.0075-0.02625-0.012-0.05025-0.01875-0.0765-0.0825-0.29775-0.612-0.9795-0.6225-0.942z m-47.732251 43.962751c0.2625 0.3615 0.6165 0.65025 1.0155 0.876-0.0615-0.1545-0.123-0.3015-0.1845-0.45975 0-0.00075 0-0.003-0.0075-0.00525h-0.0105a11.8575 11.8575 0 0 1-0.816-0.411z m64.374001 4.5675c-0.159 0.31725-0.33225 0.6375-0.5025 0.957l0.8175-0.645c-0.105-0.1065-0.2085-0.20025-0.315-0.312z" p-id="7575"></path><path d="M530.895058 119.956503l-91.155752 71.902502-4.7445 3.8055 95.900252 76.462502 96.230252-76.462502-8.949-6.9z m227.616756 182.782504L530.660308 482.400012 303.044302 302.947507l-61.726501 49.578752L530.634808 580.672514l289.594507-228.346505c-0.4335 0.0075-0.5325-0.1725-1.10325-0.7125l-0.06-0.05925c-0.075-0.0375-0.144-0.07725-0.2175-0.1125 0.0015 0.00675 0 0.0225 0 0.03675 0.0015 0.015-0.02925 0-0.02925-0.0075-0.12525-0.12375-0.26925-0.237-0.35625-0.39075-0.06-0.1065-0.0525-0.1575-0.078-0.234h-0.015c-0.0075-0.0075-0.00375-0.03-0.015-0.045l-6.63825-5.326501-0.28725-0.22575c-0.249-0.14775-0.51675-0.27-0.73875-0.4605-0.138-0.1275-0.2835-0.249-0.41625-0.3825-0.03-0.0225-0.0225-0.07425-0.03-0.1125l-0.13875-0.105-0.0075-0.00675c-0.07425-0.06675-0.1575-0.1065-0.234-0.165-0.06-0.045-0.10425-0.11775-0.174-0.14775-0.14625-0.06-0.306-0.08025-0.4605-0.1215-0.21-0.129-0.4365-0.243-0.6345-0.39075-0.09-0.0675-0.15225-0.16725-0.22575-0.25275-0.10275-0.11775-0.2055-0.234-0.3045-0.35625-0.03-0.04425-0.0375-0.12075-0.087-0.156-0.05925-0.045-0.1275-0.06-0.19125-0.09525-0.21075-0.10575-0.45975-0.1515-0.66-0.2775-0.5175-0.32775-0.492-0.246-0.57375-0.53925-0.015-0.0375 0.00225-0.0975-0.0375-0.12075-0.11025-0.0825-0.249-0.123-0.3735-0.18225-0.1905-0.12-0.38775-0.2295-0.57375-0.35625-0.105-0.075-0.177-0.18375-0.2775-0.261-0.255-0.19275-0.56775-0.3405-0.75675-0.609-0.3975-0.411-0.951-0.6555-1.416-0.98175-0.561-0.336-1.125-0.6645-1.503-1.2165-0.3615-0.36975-0.8985-0.486-1.24275-0.8775-0.2385-0.2325-0.555-0.37875-0.825-0.573a6.0585 6.0585 0 0 1-0.62625-0.5385c-0.015-0.015 0.03 0.00375 0.0525 0.00675 0.21375-0.06 0.06675-0.0075-0.25125-0.1125-0.5235-0.1725-0.8955-0.396-1.312501-0.75675-0.0525-0.045-0.08625-0.09675-0.12975-0.14775-0.0675-0.07725-0.24525-0.342-0.34725-0.42525-0.234-0.18975-0.52875-0.30225-0.78225-0.4605-0.2955-0.18825-0.45-0.27075-0.69525-0.495a6.46875 6.46875 0 0 1-0.40875-0.39975c-0.0225-0.0225-0.0525-0.06-0.045-0.087 0.015-0.0375 0.1485-0.0375 0.11325-0.0525-0.14775-0.0795-0.32625-0.0975-0.486-0.14775-0.06-0.06-1.065-0.735-0.6-0.747 0.10725-0.00225 0.4275 0.006 0.3225-0.0075-0.15825-0.0225-0.31725-0.015-0.4785-0.015-0.216-0.0975-0.444-0.18-0.651-0.29475-0.1635-0.09075-0.52875-0.52275-0.66075-0.678-0.0825-0.11025-0.1275-0.17625-0.1215-0.18225 0.03-0.0225 0.12225 0.0225 0.09525 0-0.05925-0.045-0.14025-0.0525-0.20775-0.078-0.348-0.1425-0.3105-0.13275-0.6345-0.31275-0.1575-0.1215-0.3195-0.2355-0.4695-0.36525-0.1875-0.162-0.3675-0.426-0.52125-0.6255-0.045-0.06-0.0675-0.12525-0.12225-0.174-0.045-0.0375-0.105-0.06-0.1575-0.08775-0.3225-0.17175-0.117-0.08025-0.63375-0.234-0.4785-0.24-0.7605-0.522-1.06875-0.93-0.402-0.33 0.15975 0.105-0.5475-0.33-0.9195-0.56475-0.399-0.201-0.65175-0.495-0.0375-0.045-0.075-0.0945-0.1215-0.1305-0.0675-0.0525-0.14475-0.08625-0.2175-0.12975-0.33675-0.195-0.6525-0.35325-0.9555-0.609-0.42375-0.357 0.0225 0.00075-0.1395-0.1905-0.015-0.015-0.0375-0.0225-0.05175-0.0375-0.117-0.0675-0.42075-0.2475-0.4605-0.28725-0.12825-0.13125-0.225-0.29175-0.33-0.4425-0.414-0.1725-0.816-0.3885-1.06875-0.774-0.08025-0.129-0.0075-0.03-0.339-0.174-0.2235-0.32775-0.273-0.75375-0.513-1.06875v-0.0075l-0.0075-0.00675c0.0015 0.0075 0.003 0.0225 0 0.015-0.0795-0.06675 0.0075 0.324 0.0525 0.4785 0.0225 0.07425 0.21525 0.13725 0.1485 0.174-0.0675 0.0375-0.11025-0.11025-0.165-0.165-0.1395-0.153-0.255-0.2805-0.3825-0.435-0.015-0.0225-0.078-0.05925-0.0525-0.05925h-0.03c-0.15825-0.0915-0.32625-0.17475-0.47775-0.2775-0.23325-0.15975-0.4185-0.50625-0.67725-0.6525-0.17325-0.1605-0.2655-0.22725-0.3915-0.408a3.1845 3.1845 0 0 1-0.14775-0.234c-0.015-0.0225-0.0375-0.099-0.045-0.11325-0.045-0.0525-0.0975-0.0825-0.14775-0.12225 0.0075 0.0375 0.0375 0.08025 0.0525 0.12225 0.00375 0.015-0.03-0.0075-0.045-0.015 0.231 0.26775-0.03-0.0885-0.26025-0.35625-0.138-0.03-0.2775-0.015-0.5385-0.14775-0.0825-0.0375-0.111-0.12675-0.165-0.19125-0.26625 0.03-0.63075 0.08025-0.79125-0.156-0.03-0.0375-0.015-0.09-0.03-0.1305-0.0225-0.0075-0.04425-0.0075-0.06675-0.015-0.5295-0.19125-0.5955-0.22275-0.75525-0.417-0.153 0.201-0.2955 0.006-0.4425-0.339 0 0-0.0045-0.015-0.015-0.015-0.0075-0.015-0.045-0.045-0.045-0.0525 0.15075 0.0225-0.0915-0.00675-0.1215-0.0375-0.06-0.05175-0.0855-0.1275-0.1305-0.1905-0.0525-0.015-0.06-0.015-0.096-0.03-0.0525-0.08625-0.11475-0.171-0.165-0.26025-0.03-0.0225-0.075-0.0375-0.10425-0.06-0.0225-0.0225-0.00375-0.04425-0.03-0.08625-0.045-0.0225-0.09225-0.0225-0.12975-0.0525-0.0675-0.045-0.0525-0.123-0.0675-0.22575-0.135-0.2145-0.231-0.333-0.21675-0.25275 0.0075 0.0225 0.0375 0.0375 0.045 0.06 0.0015 0.0225-0.0375-0.0375-0.045-0.045 0.0075 0.0375 0.0075 0.045 0.03 0.15675 0.05925 0.0825 0.1995 0.15 0.18225 0.252-0.015 0.0945-0.15-0.13125-0.19125-0.2175-0.0375-0.07425-0.06-0.1485-0.078-0.22575-0.5955-0.20475-1.311-0.489-0.765-0.8085-0.0525-0.06-0.102-0.123-0.165-0.174-0.0225-0.015-0.3285-0.18375-0.35625-0.20025-0.14025-0.0825-0.43125-0.26025-0.591-0.35625-0.59025-0.63975-0.58125-0.63-0.5295-0.59025a1.578 1.578 0 0 0-0.19875-0.1395c-0.0975-0.05175-0.204-0.09225-0.30525-0.13875-0.7575-0.3465-1.566-0.65475-2.15475-1.26825-0.09225-0.12075-0.49875-0.36375-0.6165-0.4605-0.0375-0.03-0.075-0.0525-0.096-0.087-0.0075-0.015 0.0375-0.0525 0.015-0.06-0.084-0.0525-0.1875-0.06-0.27825-0.09525-0.3225-0.23775-0.60525-0.357-0.74775-0.7215-0.00675-0.0225 0.0375 0.0375 0.06 0.045 0.0525 0.0225 0.21525 0.08475 0.165 0.0525-0.105-0.0675-0.2265-0.11025-0.339-0.165-0.1665-0.16425-0.3375-0.32325-0.495-0.49575-0.0225-0.0225-0.08475-0.1725-0.105-0.2085-0.081-0.14025-0.1125-0.13125-0.19125-0.3045-0.0045-0.015 0.0375 0.015 0.0525 0.03 0.0525 0.015 0.201 0.075 0.156 0.045-0.11025-0.0765-0.25725-0.09375-0.35625-0.18225-0.1875-0.1695-0.33525-0.3765-0.495-0.57375-0.015-0.015-0.0375-0.06-0.015-0.0525 0.0375 0.0075 0.06 0.0525 0.09525 0.0675 0.0225 0.0075-0.0375-0.0375-0.0525-0.0525-0.26025-0.243-0.52875-0.48525-0.738-0.7725-0.219-0.14025-0.396-0.28125-0.3045-0.40875 0.015 0.006 0.0375 0.015 0.0525 0.015-0.27-0.13725-0.37125-0.19725-0.57375-0.3735-0.0675-0.06-0.13275-0.114-0.20025-0.174-0.17025-0.1725-0.2955-0.36375-0.435-0.5475-0.39-0.21225-0.795-0.429-0.97275-0.86925-0.015-0.156-0.1575-0.21-0.2865-0.28575-0.10125-0.0675-0.2055-0.14475-0.3045-0.2175-0.0225-0.015 0.0525 0.0375 0.078 0.045 0.015 0.0045 0.0675 0.00675 0.0525 0-0.38625-0.15375-0.783-0.23925-0.9825-0.696-0.0375-0.08025-0.0885-0.15-0.1125-0.234-0.00525-0.0225 0.03 0.03 0.0525 0.0375 0.0765 0.03675 0.162 0.05925 0.24225 0.087 0.045 0.015-0.0975-0.015-0.1215-0.0525-0.0075-0.0225 0.07575-0.006 0.06-0.03-0.183-0.23475-0.3855-0.45525-0.58275-0.677251l-0.12225-0.10425h-0.015c-0.0765 0.0075-0.15225-0.0075-0.234 0 0.00375 0.06 0.0375 0.35025 0.045 0.3135 0.0045-0.084 0.05925-0.2475 0.36375 0.2175 0.0525 0.078-0.1815-0.0795-0.26025-0.1305-0.0525-0.03-0.06-0.06-0.10425-0.087-0.144-0.093-0.2625-0.174-0.35625-0.3045-0.015-0.00525-0.03 0.006-0.0375 0-0.29775-0.18225-0.384-0.5925-0.651-0.8175-0.1095-0.09075 0.0675 0.234 0.174 0.39225 0.00525 0.04425-0.0225 0.05175 0.28725 0.1995-0.09-0.0525-0.20625-0.07425-0.2685-0.156-0.015-0.015-0.00225-0.03-0.015-0.045-0.00375-0.04425-0.22725-0.345-0.339-0.59925-0.045-0.0015-0.06 0.00225-0.08625 0-0.0075 0-0.03 0.00225-0.0675-0.015 0.0525 0.084 0.10725 0.16275 0.1485 0.25275 0.0525 0.11025-0.375-0.50475-0.234-0.27825-0.03-0.0525 0.0375 0 0.087 0.03a0.225 0.225 0 0 1-0.0375-0.0525c-0.147 0.03-0.14775 0.06-0.7215-0.504-0.0075-0.0375-0.0525-0.0675-0.0525-0.105 0-0.006 0.045-0.006 0.045-0.01425-0.045-0.09525-0.17025-0.144-0.22575-0.234-0.18075-0.13125-0.3675-0.2745-0.495-0.4605-0.015-0.0225-0.0375-0.045-0.0525-0.0675z m4.761 3.84l-0.243-0.2085c0.00525 0.0375 0.0225 0.1605 0.03 0.20025a0.7875 0.7875 0 0 1 0.2175 0.0075z m55.852501 45.035252c0.135 0.114 0.2745 0.231 0.435 0.30375 0.06 0.03 0.1365 0.015 0.19125 0.0075l-0.12225-0.105c-0.165-0.0855-0.333-0.16575-0.50325-0.243 0.0045 0.0075-0.0075 0.03 0 0.0375z m-57.450751-46.338752c0.00375 0.081-0.015 0.1125 0 0.165 0.0045 0.0225 0.03 0.0375 0.0375 0.0525 0.0225-0.00525 0.1125 0.015 0.15675 0.015-0.0225-0.045-0.0525-0.10275-0.06-0.1305z m0.19125 0.23475c0.00675 0.0225 0.015 0.0375 0.03 0.05175 0.06675 0.00225 0.05925-0.0075 0.12975-0.0075l-0.045-0.03675c-0.015 0.00375-0.081-0.0075-0.1125-0.0075z m14.4405 12.337501c-0.084 0.03-0.2115 0.0525-0.26025 0.07875 0.0675 0.0825 0.132 0.16425 0.2175 0.22575 0.1065 0.11625 0.27 0.279 0.435 0.42525-0.0525-0.11475-0.0975-0.23325-0.1485-0.34725-0.03-0.0375-0.0375-0.045-0.0525-0.06675-0.015-0.015-0.00075-0.0225-0.015-0.045-0.00675-0.03675-0.06675-0.126-0.06675-0.165-0.0375-0.0375-0.07425-0.06675-0.1125-0.1035z m0.35625 0.4875c-0.03-0.075 0.015 0.1605 0.045 0.234 0.015 0.0375 0.0375 0.05925 0.0675 0.087-0.03-0.1095-0.0675-0.2175-0.114-0.32175z m0.3645 0.5115c-0.03-0.0375 0.0375 0.0855 0.045 0.15675 0.0375 0.06675 0.12375 0.1335 0.18225 0.20775-0.00225-0.00675 0.0015-0.00675 0-0.015-0.075-0.11775-0.1335-0.24525-0.2265-0.34725z m0.2265 0.348c0.0075 0.015 0.015 0.03 0.03 0.04425 0.015 0.0225 0.0375 0.0375 0.0525 0.06 0.02175 0.00675 0.04425 0.015 0.066 0.02925-0.06-0.099-0.114-0.195-0.19125-0.27825-0.03-0.0375 0.03 0.075 0.045 0.14775z m0.078 0.1035c-0.00525-0.0015-0.0075 0.00225-0.015 0 0.03 0.045 0.06 0.08475 0.087 0.1305 0.0375 0.0225 0.06 0.045 0.09525 0.06-0.075-0.0675-0.105-0.123-0.165-0.192z m3.49275 2.12925l0.03 0.03c-0.00525-0.00675-0.00225-0.0225-0.015-0.03-0.0045-0.0015-0.0075 0-0.015 0z m168.088504 134.228253l-418.25251 329.807258-417.99151-329.625008-61.752752 49.605001 479.745012 378.26626 479.187762-377.84026c-0.09225-0.06675-0.186-0.13575-0.2775-0.2085-0.045-0.0375 0.08325 0.045 0.036-0.0075-0.12525-0.06675-0.2475-0.135-0.3735-0.1995-0.138-0.15525-0.2745-0.303-0.40875-0.4605-0.012-0.015 0.17025 0.144 0.015-0.0525-0.2025-0.1935-0.456-0.33075-0.669-0.51225-0.03-0.03 0.066 0.0375 0.1035 0.06h0.03675a2.0205 2.0205 0 0 1-0.747-0.41775c-0.2535-0.255-0.29625-0.34275-0.339-0.4515l-0.015-0.0075c-0.045-0.02925-0.08025-0.081-0.12075-0.12-0.0375-0.0225-0.0675-0.0375-0.105-0.06-0.12225-0.045-0.26025-0.0525-0.35625-0.1395-0.04425-0.0375-0.081-0.093-0.12225-0.13875a1.93125 1.93125 0 0 1-0.45975-0.3915 6.11625 6.11625 0 0 1-1.269-0.6435c-0.132-0.153-0.276-0.3-0.39975-0.45975-0.012-0.0225-0.05175-0.07725-0.0285-0.07875 0.07575-0.0045 0.267 0.1275 0.22575 0.06-0.0435-0.0765-0.1725-0.0675-0.25125-0.10425-0.36-0.183-0.396-0.22125-0.7215-0.44325-0.1575-0.11925-0.31575-0.2325-0.468751-0.35625-0.41775-0.3375-0.711-0.8205-1.095-1.19025-0.0375-0.045-0.078-0.0975-0.12225-0.1395a4.611 4.611 0 0 1-0.4695-0.2775c-0.393-0.22575-0.7875-0.4935-1.01625-0.8865-0.0375 0-0.2025-0.00525-0.0675 0-0.02175-0.045-0.03675-0.087-0.0585-0.1305-0.0225-0.0675 0.012-0.0525-0.24375-0.2175a4.458 4.458 0 0 1-1.008-0.903c-0.102-0.11925-0.23325-0.21225-0.29475-0.35625v-0.0075c-0.03-0.03-0.05925-0.0525-0.087-0.078-0.1095-0.0525-0.2565-0.09-0.33-0.12075-0.29475-0.1155-0.44325-0.1425-0.678-0.357a3.21525 3.21525 0 0 1-0.339-0.37275c-0.07575-0.096 0.18525-0.0375 0.1215-0.078-0.117-0.075-0.261-0.093-0.39075-0.1395-0.189-0.1155-0.384-0.2205-0.56475-0.34725a0.64725 0.64725 0 0 1-0.165-0.165c-0.015-0.0225 0-0.06-0.015-0.078-0.096-0.0675-0.213-0.0945-0.31275-0.15675-0.321-0.198-0.35925-0.258-0.591-0.495-0.2685-0.25725-0.552-0.46275-0.834-0.7035-0.02925-0.0225-0.0375-0.09075-0.0675-0.10425-0.13425-0.0675-0.285-0.10425-0.42525-0.1575-0.198-0.147-0.4005-0.2835-0.59025-0.4425a0.2835 0.2835 0 0 1-0.078-0.1215c0-0.0225 0.066-0.03 0.0525-0.045-0.11475-0.09-0.27-0.12375-0.3825-0.21675-0.402-0.33225-0.387-0.34725-0.5565-0.67725 0.012-0.0225-0.012-0.0525 0.012-0.06-0.2085-0.1575-0.41625-0.31875-0.6255-0.477 0-0.0045-0.015-0.00525-0.015-0.0075-0.0375-0.03-0.2325-0.10425-0.25125-0.1125-0.44175-0.1785-0.75675-0.5565-1.0605-0.90375-0.0525-0.06-0.07875-0.14025-0.14775-0.17475-0.0375-0.015 0.015 0.0765 0.03 0.11325-0.642 0.015-1.28025-0.96225-1.59-1.44225-0.18825-0.357-0.5175-0.6165-0.8175-0.8775-0.03675-0.0375-0.087-0.06-0.12-0.10425-0.114-0.14025-0.2085-0.29625-0.3135-0.4425-0.14625-0.3675-0.12675-0.27525-0.0945-0.20925 0-0.0045 0-0.015-0.01275-0.015 0 0.015-0.03-0.05175-0.015-0.03675a4.9065 4.9065 0 0 1-1.008-0.6165c-0.58275-0.315-0.228-0.0525-0.84225-0.7035-0.141-0.32475 0.03675-0.12-0.23475-0.34725-0.36375-0.26175-0.3705-0.28725-0.564-0.4695-0.015-0.0075-0.0225-0.0075-0.0375-0.015-0.08625-0.06-0.1755-0.135-0.26925-0.09525-0.50475-0.2325-0.954-0.5625-1.251-1.0425-0.3615-0.1605-0.61125-0.333-0.73875-0.52125-0.05175-0.03-0.0945-0.045-0.13875-0.0675-0.135-0.084-0.2625-0.18525-0.3915-0.2775-0.012-0.015-0.0225-0.0375-0.0375-0.0525-0.036-0.0225-0.234-0.1545-0.3045-0.20025-0.012-0.00075-0.015-0.0075-0.03-0.0075-0.29025-0.03675-0.198 0.015-0.92925-0.59025-0.1125-0.05925-0.2595-0.09225-0.34725-0.20775-0.03-0.0375-0.04425-0.0675-0.06675-0.10425-0.1815-0.0075-0.213-0.045-0.89475-0.60825-0.012-0.0375 0-0.00525 0-0.03-0.108-0.06-0.21225-0.12225-0.3225-0.18225-0.036-0.0375-0.6705-0.64425-0.66-0.68625 0-0.015 0.03 0.0045 0.045 0.0075 0.17025 0.0735 0.462 0.02175 0.55575-0.015-0.015-0.0075-0.015 0-0.015-0.0075-0.2625-0.0225-0.5445 0.03-0.7905-0.06-0.1845-0.06675-0.26025-0.29475-0.39075-0.4425 0.07575 0.006 0.0225-0.0015 0.174 0.05175-0.14025-0.0765-0.312-0.15975-0.44325-0.243-0.015-0.0075 0.03675 0.015 0.0585 0.015 0.0765 0.015 0.29625 0.06675 0.2265 0.0375-0.894-0.40575-0.375 0.05175-0.9555-0.609-0.01275-0.0225-0.12225-0.0225-0.17475-0.0675-0.066-0.04425-0.144-0.0945-0.2085-0.14775a6.97275 6.97275 0 0 1-0.66-0.7125c-0.01275-0.00375-0.015-0.0045-0.03-0.00675-0.135-0.0525-0.495-0.564-0.6525-0.66-0.0585-0.06-0.105-0.1275-0.165-0.183-0.012-0.0015 0.00075 0.0075-0.1215-0.06675-0.89325-0.57825 0.2805 0.06-0.486-0.29475-0.4365-0.297-0.5835-0.372-0.756-0.756l-0.01275-0.0075v-0.0075c-0.015-0.003-0.015 0-0.03-0.006-0.11625-0.0885-0.24225-0.17625-0.3555-0.27-0.0375-0.02925-0.075-0.05925-0.09525-0.1035 0-0.0075 0.01275-0.015 0.015-0.03-0.0225-0.0225-0.05925-0.0225-0.06675-0.0525-0.2115-0.10125-0.48525-0.1215-0.6165-0.3555-0.159-0.1575-0.306-0.33-0.4695-0.48675h-0.012v-0.0075c-0.1845-0.17775-0.384-0.3435-0.53925-0.5475-0.012-0.015-0.012-0.02175-0.03-0.04425-0.0435-0.0375-0.123-0.05925-0.1815-0.12975-0.0375-0.0375-0.05925-0.0675-0.08625-0.10425-0.2625-0.0675-0.6-0.13275-0.6-0.261-0.15675-0.1935-0.315-0.378-0.46875-0.57375 0-0.006 0.015-0.00075 0.03 0 0.012-0.015 0.02925-0.0225 0.01425-0.0375-0.0225-0.04425-0.07425-0.07425-0.105-0.1125-0.015-0.0225-0.015-0.06-0.04425-0.078-0.066-0.045-0.15225-0.0675-0.22575-0.10425-0.132-0.09-0.2445-0.1935-0.3645-0.2865-0.09525-0.06675-0.18225-0.14625-0.26025-0.2175-0.09525-0.081-0.20175-0.1455-0.2955-0.234-0.10875-0.111-0.16575-0.23625-0.25125-0.34725-0.1095-0.09975-0.22125-0.198-0.3225-0.30375-0.012-0.015-0.05925-0.11475-0.0945-0.17475a3.9855 3.9855 0 0 1-0.53025-0.330001c-0.03-0.006-0.03-0.0075-0.0525-0.015-0.01425-0.0045-0.01425-0.0075-0.02925-0.015a0.207 0.207 0 0 1-0.05925-0.03 3.9285 3.9285 0 0 1-0.7725-0.45975c-0.0525-0.0375-0.075-0.11775-0.1305-0.1485-0.12675-0.06675-0.2685-0.10275-0.39975-0.156-0.1605-0.147-0.31725-0.29625-0.47775-0.4425 0.05175 0.02175 0.22575 0.05175 0.174 0.02925-0.07425-0.0375-0.15525-0.0525-0.23475-0.078-0.29625-0.09075-0.6165-0.14925-0.7995-0.4695 0.015-0.00225 0.4965 0.14775 0.33975 0.078-0.18825-0.08325-0.94575-0.1875-0.93-0.582 0.05175 0.00675 0.108 0.0225 0.165 0.03-0.246-0.273-0.39-0.63375-0.6345-0.91275l-0.015-0.0075c-0.05175-0.04425-0.012 0.1755 0.015 0.25275 0.078 0.21075 0.33825 0.48375 0.1035 0.22575-0.24-0.29775 0.015-0.10125-0.52125-0.39075-0.102-0.2175-0.2055-0.4335-0.3045-0.6525l-0.19875-0.165v0.015c0.17775 0.48825 0.387 0.45975 0.07725 0.27-0.18375-0.1485-0.28725-0.21225-0.416251-0.41775-0.045-0.075-0.08175-0.1545-0.12225-0.234l-9.69675-7.785c-0.20625-0.075-0.24825-0.12-0.5565-0.183 0.01275-0.07425-0.012-0.156 0.03-0.2175 0.012-0.015 0-0.015 0.012-0.015l-0.165-0.12975c-0.05925-0.045-0.12-0.0375-0.18225-0.096-0.0375-0.0375-0.05925-0.08625-0.0945-0.12975l-0.45225-0.36525a0.96975 0.96975 0 0 1-0.19125-0.156z m18.664501 15.11025c0.015 0.006 0.03675 0.0075 0.05175 0.015-0.0375-0.03-0.07425-0.045-0.12225-0.078-0.0225-0.015 0.0375 0.03 0.06675 0.05925z m0.05175 0.015c0.012 0.006 0.015 0.00675 0.02925 0.015 0.015 0.0045 0.04425 0.015 0.04425 0.00675-0.0225-0.015-0.04425-0.015-0.06675-0.03z m14.04975 11.817001c0.0375 0.015 0.05925 0.03 0.0945 0.0375 0.0375 0.00675 0.15 0.00675 0.11325 0-0.15975-0.0375-0.13125-0.0225-0.2085-0.0375z m3.1275 2.259c0.015 0.006 0.015 0.00075 0.0375 0.0075-0.05925-0.06-0.0375-0.015-0.174-0.1395-0.045-0.0375 0.087 0.0975 0.13875 0.12975z m-4.29225-3.1455c0.03 0.0075 0.045 0.03 0.0675 0.0375 0.036 0.006 0.16275-0.0075 0.1215-0.015-0.14475-0.0225-0.10875-0.015-0.19125-0.015z m1.67775 0.756c0.11175 0.7065 0.0585 0.426 0.339 0.68625-0.078-0.12525-0.1665-0.333-0.2865-0.6435l-0.03-0.015c-0.015-0.00675-0.015-0.015-0.02925-0.03z m1.1295 1.27725c0.0225 0.0225 0.05175 0.0375 0.07725 0.0525 0.015 0.00675 0.07875 0.015 0.05925 0.00675-0.07875-0.0375-0.078-0.03-0.1395-0.06z" p-id="7576"></path><path d="M611.56731 114.890253c-0.015 0-0.0375 0.0735-0.0525 0.1035 0.67875 1.092 1.36725 2.1795 2.025 3.28575 0.1455 0.30525 0.315 0.59475 0.4695 0.89475 0.03 0 0.06 0.075 0.09525 0.075 0.114-0.21525 0.24825-0.4095 0.34725-0.6255-0.954-1.24725-1.90275-2.5005-2.8845-3.7335z m34.129501 58.572751c-0.16725 0.0825-0.3465 0.12675-0.5475 0.11175 0.5415 0.57225 1.04775 1.185 1.5555 1.7895-0.30225-0.5205-0.64125-1.02525-0.8955-1.57275-0.03-0.075-0.07875-0.24525-0.1125-0.327z m-20.415001 18.432001l-0.18375 0.7425c0.29025 0.66 0.555 1.335 0.96 1.92675 0.19275 0.28275 0.67725 0.74325 1.1115 1.173-0.015 0-0.02175 0.0015-0.04425-0.07275-0.64875-1.23675-1.245-2.5035-1.84425-3.7695z m-264.261006 65.964001l-61.727252 49.578752 264.912757 208.901255c0.8055-0.56775 1.7595-1.13775 2.931-1.7925 0.25425-0.528 0.52875-1.04325 0.8835-1.509a33.654751 33.654751 0 0 1 2.44575-2.893501c-0.24525-0.7755-0.38175-1.515-0.33675-2.097 0.009-0.11925 0.0225-0.2205 0.03225-0.3375a27.387751 27.387751 0 0 1-2.265-2.45775c-1.54275-1.9095 1.93875-4.512 2.9085-6.76725 0.40575-0.22575 0.96675-0.561 1.44525-0.84075 1.39725-3.1515 3.207-4.10475 4.8975-5.1075a86.491502 86.491502 0 0 1 3.07575-2.4045c0.24825-0.288 0.48825-0.58425 0.744-0.8655 2.49525-2.751 14.45325-13.53825 15.924751-14.817 0.1725-0.15 0.291-0.24525 0.45375-0.3855l0.04275-0.0495c10.50975-12.10275 7.638-8.55375 10.137-11.028751-0.55875-0.92475-1.212-1.80525-1.527-2.8305-1.38975-4.5225-1.851-7.0185-1.58025-10.1055-1.42425 0.25125-2.80575 0.3495-3.0225 0.1725a65.618252 65.618252 0 0 1-3.12975-2.745c-0.09975-0.02325-0.2025-0.0465-0.28875-0.072-1.659 0.078-3.3345-0.7725-4.837501-2.946-0.444-0.64275-0.75525-1.34925-0.99-2.09175-1.60875-1.632-3.10275-3.3825-4.20975-5.364-0.63525-0.36975-1.12125-0.8085-1.515-1.395z m231.130505 184.508255c0.66075 0.67125 1.33875 1.323 2.017501 1.9635a5.12775 5.12775 0 0 0 2.06925 1.2c-1.476-1.44825-2.92875-2.9235-4.389001-4.389 0.087 0.41475 0.177 0.82875 0.30225 1.2255z m4.086751 3.16275c0.3465 0.3405 0.696 0.678 1.047 1.014-0.0255-0.27225-0.048-0.54825-0.07275-0.822a5.4165 5.4165 0 0 1-0.975-0.192z m1.047 1.014c0.01425 0.144 0.024 0.2925 0.03825 0.4365 0.0165 0.168 0.26175 0.30825 0.65475 0.4245 0.06675-0.003 0.13275-0.00525 0.1995-0.01125-0.3-0.2805-0.5955-0.56625-0.8925-0.84975z m234.304505-160.687504v0.01575c-0.03 0-0.05925 0.075-0.0855 0.10425h0.303c-0.075-0.075-0.144-0.0825-0.21675-0.12z m4.1625 8.07825c0.15675 0.20925 0.288 0.3735 0.45 0.5925-0.0015-0.0675 0.0015-0.135 0-0.201-0.075-0.0675-0.159-0.11625-0.234-0.18225-0.08025-0.07425-0.13725-0.1395-0.21675-0.20925z m-104.300252 30.780001l-0.48375 0.38025 0.11175 0.0525c0.12525-0.14325 0.2475-0.2895 0.372-0.4335zM686.379812 360.247509l-11.301001 8.91075a91.327502 91.327502 0 0 1 2.460751-1.6425c2.958-2.409 5.931-4.80075 8.84025-7.2675z m-515.736013 50.508001l-61.752001 49.604251 436.26526 343.983009a127.167753 127.167753 0 0 0 4.53375-5.1075c0.07725-0.0915 0.2175-0.1875 0.375-0.2775 0.3675-0.5325 0.7545-1.05225 1.15575-1.563001-0.03-0.006-0.05925-0.0075-0.09-0.015-2.985-0.67125 0.05475-5.4645 4.325251-9.57a70.402502 70.402502 0 0 1 1.5075-2.42475c2.4825-3.858 15.582-9.57375 10.02375-7.6815-0.94725 0.6315-1.26975 0.99375-0.53625 0.174 0.27225-0.09675 0.32175-0.10125 0.53625-0.174 0.7965-0.5325 2.0295-1.2525 3.51525-1.65 1.56-0.4155 2.592-0.67725 3.6825-0.95625 6.6615-7.01475 14.24625-13.0665 21.951001-18.943501a118.962003 118.962003 0 0 0-3.026251-7.23c-0.159-0.34875 0.65475-0.396 0.984001-0.591 0.5865-0.345 1.1745-0.68775 1.761-1.032-0.165-0.72825-0.3195-1.4625-0.46875-2.196-0.153-0.18375-0.3165-0.36975-0.4455-0.54225a10.2435 10.2435 0 0 1-1.391251-1.185c-2.235 0.02925-4.7025-0.0585-5.178-0.09975a215.247755 215.247755 0 0 0-0.05775-3.135z m843.934521 5.97675c0.0735 0.2325 0.1575 0.47175 0.22725 0.705 0.102-0.093 0.1995-0.1875 0.303-0.279z m3.192 3.93c-0.05325 0-0.081 0.36-0.0135 0.45825 0.1035 0.12525 0.2175 0.2505 0.3225 0.3825-0.0975-0.27375-0.16725-0.567-0.28725-0.8175-0.00975-0.015-0.015-0.024-0.02175-0.02325z m-424.756511 18.369001c-0.22275 2.23725-4.1625 0.996 3.381001 2.316-0.15975-0.28275-0.2805-0.6495-0.3705-1.0575l-0.15525-0.1125a70.114502 70.114502 0 0 0-2.855251-1.146z m6.931501 6.132l0.04275 0.1755c0.0375 0.033 0.072 0.066 0.111 0.0975l0.15-0.04275c-0.1005-0.078-0.2025-0.15375-0.30375-0.23025z m0.303 0.2295c0.12975 0.10125 0.25875 0.2025 0.387 0.30525 0.2175 0.054 0.36 0.08325 0.57 0.135a38.909251 38.909251 0 0 1-0.66675-0.525c-0.0975 0.0315-0.1935 0.057-0.29025 0.0855z m0.387 0.30525l-0.15675-0.0375c-0.10425-0.0255-0.24075-0.11625-0.3795-0.225l-0.08325 0.02475c0.102 0.40875 0.21825 0.81 0.33825 1.2105 0.2775-0.1575 0.54975-0.336 0.819-0.53775-0.17775-0.14775-0.35775-0.291-0.53775-0.435z m4.9335 4.1145c-0.1005 0.024-0.20475 0.045-0.3075 0.0675 0.1305 0.2745 0.267 0.4635 0.3 0.26475a1.26 1.26 0 0 0 0.0075-0.33225z m4.17675 1.191c0.18825 0.312 0.38925 0.61725 0.6 0.915 0.44625 0.084 0.92775 0.17175 1.155 0.2025-0.117-0.14775-0.231-0.2865-0.35625-0.4425-0.35025-0.16875-0.85275-0.41025-1.39875-0.675z m-43.263001 64.998002c-0.3225 0.55125-0.5955 1.07325-0.8055 1.497l0.07575 0.06c0.267-0.50475 0.5055-1.0275 0.72975-1.557z m55.169251 212.662505c0.16725 0.12225 0.3345 0.24375 0.50025 0.36825 0.56475 0.01875 0.98625 0.048 1.1625 0.08775a55.588501 55.588501 0 0 0-1.66275-0.45525z m102.885003 1.017a85.302002 85.302002 0 0 0-1.539 2.997l1.6965-1.33725c-0.051-0.5175-0.099-0.95775-0.1575-1.65975z m-100.562253 0.7005c0.291 0.21075 0.579 0.42825 0.8775 0.6255 0.29775 0.1965-0.58125-0.41625-0.8715-0.624-0.00225 0-0.00375-0.00075-0.006-0.00225z m14.067001 56.835001a0.43275 0.43275 0 0 0 0.03075 0.17625l0.09975-0.114-0.1305-0.063z m-43.091251 37.842001c-3.72825 0.7725-7.54575 1.30425-11.234251 2.187-1.14675 0.5985-2.022 1.134-3.51075 1.875l-0.4545 0.27975c-0.0465 0.09525-0.0915 0.18975-0.13875 0.285 4.74-1.91625 11.226-1.6425 15.338251-4.62675z m-15.338251 4.626c-0.1635 0.066-0.324 0.1365-0.48375 0.20775-0.144 0.3855-0.24 0.66-0.34725 0.963l0.15225 0.12c0.231-0.4275 0.46125-0.855 0.67875-1.29z m-0.48375 0.20775l0.05175-0.13725-0.97875 0.60525c0.3-0.16875 0.6075-0.324 0.927-0.468z m0.05175-0.13725l0.57075-0.35475 0.04125-0.08325c-0.17175 0.08325-0.3585 0.1725-0.5475 0.2625-0.02475 0.0645-0.0405 0.11025-0.0645 0.1755z" p-id="7577"></path></svg>
                            </span>
                          </a>
                        
                        
                      
                      
                    </div>
                    <!--buttons end-->

                  </div>
                </div>
                </div>
              </div>
            </nav>
      </div>

 <div class="hero-body ct-body">
  <div class="container">
    <h1 class="title-only animate__animated animate__fadeInUp">
      <span clsss="tran-archives">【前端工程化】篇四 席卷八荒-Webpack（进阶）</span>
    </h1>
  </div>
</div>

</section>
<section class="ct-body">
  <div class="container">
    <div class="columns is-variable bd-klmn-columns is-4 is-centered animate__animated animate__fadeInUp">
      <div class="column is-four-fifths">
        <div class="post-body single-content">
          
          <!-- <h1 class="title">
            【前端工程化】篇四 席卷八荒-Webpack（进阶）
          </h1> -->


          <div class="media">
            
            <figure class="media-left">
              <p class="image is-48x48">

                <img class="is-rounded" src="asset/avatar.png">

              </p>
            </figure>
            
            <div class="media-content">
              <div class="content">
                <p>
                  <span class="date">2020/10/28</span>
                  <span class="tran-posted-in">posted in</span>&nbsp; 
                  
                  <span class="posted-in"><a href='%E5%B7%A5%E7%A8%8B%E5%8C%96.html'>工程化</a></span>
                  
                  

                  

                  <br />
                  <span class="tran-tags">Tags:</span>&nbsp;
                  
                  <a class="tag is-link is-light" href='tag_webwork.html'>#webwork</a>
                  
                  <a class="tag is-link is-light" href='tag_%E5%B7%A5%E7%A8%8B%E5%8C%96.html'>#工程化</a>
                  

                </p>
              </div>
            </div>

          </div>
        </div>
        <article class="markdown-body single-content">
          <p>字数：12197， 阅读时间：35分钟</p>
<blockquote>
<p>石可破也，而不可夺坚；丹可磨也，而不可夺赤         ——《吕氏春秋·诚廉》</p>
</blockquote>
<p>【前端工程化】系列文章链接：</p>
<ul>
<li><a href="17280324109501.html">【前端工程化】篇一 扬帆起航：开发环境</a></li>
<li><a href="17280325692997.html">【前端工程化】篇二 白璧微瑕-包管理器</a></li>
<li><a href="17280326211130.html">【前端工程化】篇三 席卷八荒-Webpack（基础）</a></li>
<li><a href="17280327068074.html">【前端工程化】篇四 席卷八荒-Webpack（进阶）</a></li>
<li><a href="17280327574437.html">【前端工程化】篇五 未来已来-Babel</a></li>
<li><a href="17280328175326.html">【前端工程化】篇六 规矩方圆-ESLint</a></li>
<li><a href="17280328680249.html">【前端工程化】篇七 沧海遗珠-其他工具</a></li>
</ul>
<p><em>示例代码仓库：<a href="https://github.com/BWrong/dev-tools">https://github.com/BWrong/dev-tools</a></em></p>
<p><em>声明：本篇文章基于webpack v4.43.0，如按照文中代码执行报错，请检查依赖模块版本是否和示例代码仓库中一致。</em></p>
<p>*温馨提示：*本篇内容更偏实战，涉及大量代码，如有代码密集恐惧症的老爷，请速速离场。</p>
<p>在上一篇的内容中，介绍了webpack的核心概念以及常用的核心配置，并尝试着配置了一个项目脚手架。那么接下来，就进入飞升环节——性能优化和实现原理。</p>
<h1><a id="%E9%94%A6%E4%B8%8A%E6%B7%BB%E8%8A%B1%E4%BC%98%E5%8C%96" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>锦上添花-优化</h1>
<h2><a id="%E4%BD%BF%E7%94%A8%E5%88%86%E6%9E%90%E5%B7%A5%E5%85%B7" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>使用分析工具</h2>
<p>优化如果没有数据量化做支撑，而仅仅凭感觉，都是扯淡的，所以在做优化前，有必要先来了解一些构建结果分析工具，用来获取相关的量化指标，为优化工作提供了方向和依据。</p>
<h4><a id="stats%E5%88%86%E6%9E%90%E5%B7%A5%E5%85%B7" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>stats分析工具</h4>
<p><a href="http://webpack.github.io/analyse/">stats分析工具</a>是webpack官方提供的在线工具，使用方法如下：</p>
<ol>
<li>生成<code>stat.json</code>文件。</li>
</ol>
<pre class="line-numbers"><code class="language-shell">webpack --profile --json &gt; stats.json
</code></pre>
<ol start="2">
<li>将<code>stat.json</code>文件上传到<a href="http://webpack.github.io/analyse/">stats分析工具</a>页面中，即可得到分析结果。</li>
</ol>
<p><img src="media/17280327068074/17281443522325.png" alt="" /></p>
<h4><a id="%E4%BD%BF%E7%94%A8webpack-bundle-analyzer" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>使用<code>webpack-bundle-analyzer</code></h4>
<p>除了官网提供的分析工具，社区还提供了一个更加好用的分析神器<a href="https://github.com/webpack-contrib/webpack-bundle-analyzer">webpack-bundle-analyzer</a> ，不仅界面美观，而且各个依赖包及其体积大小也更加直观。</p>
<pre class="line-numbers"><code class="language-shell">npm install webpack-bundle-analyzer -D
</code></pre>
<pre class="line-numbers"><code class="language-js">// build/webpack.prod.conf.js
const merge = require('webpack-merge');
const BundleAnalyzerPlugin = require('webpack-bundle-analyzer').BundleAnalyzerPlugin;
const baseConfig = require('./webpack.base.conf.js');

 module.exports = merge(baseConfig, {
   	mode: 'production',
    plugins: [
        new BundleAnalyzerPlugin(),
   		// ...
    ],
   // ...
 });
</code></pre>
<p><img src="media/17280327068074/17281443522355.png" alt="" /></p>
<p>图里面我们可以查看Gzip和原始的打包结果，也可以看到每个chunk包含哪些包，以及它们的体积大小等信息。</p>
<h4><a id="%E9%80%9F%E5%BA%A6%E5%88%86%E6%9E%90" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>速度分析</h4>
<p>上面的两个工具均是侧重于打包结果的分析，重在优化打包品质。而通过 <a href="https://github.com/stephencookdev/speed-measure-webpack-plugin">speed-measure-webpack-plugin</a> 这个插件还可以实现对构建过程分析，从而优化构建效率，提升打包的体验。</p>
<pre class="line-numbers"><code class="language-shell">npm i -D speed-measure-webpack-plugin
</code></pre>
<pre class="line-numbers"><code class="language-js">// build/webpack.prod.conf.js
const SpeedMeasurePlugin = require(&quot;speed-measure-webpack-plugin&quot;);
const smp = new SpeedMeasurePlugin();
const webpackConfig = {
    // ...
}
module.exports = smp.wrap(webpackConfig) // 需要包裹原来的配置
</code></pre>
<p>现在就可以看到每个loader和plugin耗费的时间，以便对其进行优化。</p>
<p><img src="media/17280327068074/17281443522370.png" alt="image-20201009111235625" /></p>
<h2><a id="%E4%BC%98%E5%8C%96%E5%8C%85%E5%93%81%E8%B4%A8" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>优化包品质</h2>
<p>webpack4.0在mode设置为production时，其实已经默认做了很多优化手段来提升输出成果品质，不过了解一下还是有助于我们做一些更加深层次的优化。毕竟这些内容是直接关系到用户体验的，非常重要。</p>
<h3><a id="tree-shaking" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>Tree shaking</h3>
<p>Tree shaking 这个术语起源于 <a href="https://github.com/rollup/rollup">rollup</a>，在webpack2.0正式版开始内置，可以检测到未使用的模块，以便将其剔除。它依赖于 ESModule 模块系统（其他模块系统不支持）中的<a href="http://exploringjs.com/es6/ch_modules.html#static-module-structure">静态结构特性</a>，可以移除 JavaScript 上下文中的未引用代码，删掉未使用的代码，能够有效减少 JS 代码文件的大小。</p>
<blockquote>
<p>Tree shaking这个名字非常形象，摇树-摇掉树上多余的东西。</p>
</blockquote>
<pre class="line-numbers"><code class="language-js">// src/math.js
export function square(x) {
  return x * x;
}

export function cube(x) {
  return x * x * x;
}

// src/index.js
import { cube } from './math.js' // 仅引用了 cube 这个方法

console.log(cube(3))
</code></pre>
<p>上面的代码其实只是使用了cube，一般我们会希望未使用的代码（dead code）最好能够不包含到成果中。在新版的webpack中，在production的mode下，它会自动帮我们移除没有用到的代码，减少输出成果的体积。</p>
<p>在development的mode下，我们可以添加如下配置：</p>
<pre class="line-numbers"><code class="language-js">// build/webpack.dev.conf.js
module.exports = {
  mode: 'development',
  optimization: {
    usedExports: true, // 不导出模块中未使用的代码
  },
}
</code></pre>
<p>在进行此配置后，webpack会标识未使用的代码，然后在<a href="https://github.com/webpack-contrib/terser-webpack-plugin">TerserPlugin</a>执行压缩的时候移除那部分代码（没有额外的副作用）。</p>
<p>如果开发者需要自己来指定哪些模块没有副作用，可以使用另外一种方式（side effect），它可以配置在<code>package.json</code>的&quot;sideEffects&quot; 属性（主要针对一些库），也可以在 <a href="https://webpack.docschina.org/configuration/module/#module-rules"><code>module.rules</code> 配置选项</a> 中设置 <code>&quot;sideEffects&quot;</code>。大概有如下几种情形：</p>
<ul>
<li>如果所有代码都不包含有side effect的代码，直接将该属性标记为false，来告知 webpack，它可以安全地删除未用到的 export。</li>
</ul>
<pre class="line-numbers"><code class="language-json">//package.json
{
  &quot;name&quot;: &quot;your-project&quot;,
  &quot;sideEffects&quot;: false
}
</code></pre>
<ul>
<li>如果代码中有部分文件有副作用，需标记</li>
</ul>
<pre class="line-numbers"><code class="language-json">//package.json
{
  &quot;name&quot;: &quot;your-project&quot;,
  &quot;sideEffects&quot;: [
    &quot;./src/some-side-effectful-file.js&quot;,
    &quot;*.css&quot; // 一般css都是具有副作用的，需要在此声明
  ]
}
</code></pre>
<blockquote>
<p><em>&quot;side effect(副作用)&quot; 的定义是，在导入时会执行特殊行为的代码，而不是仅仅暴露一个 export 或多个 export。举例说明，例如 polyfill，它影响全局作用域，并且通常不提供 export。</em></p>
<p>针对css也提供了相应的工具 <a href="https://purgecss.com/plugins/webpack.html#usage">PurgeCSS</a>来去除未使用的代码，和tree shaking有异曲同工之妙。</p>
</blockquote>
<h3><a id="%E4%BB%A3%E7%A0%81%E5%88%86%E5%89%B2" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>代码分割</h3>
<p>在单页应用（single-page application 简称为 SPA）当道的时代，我们不可能将所有的代码都打包在一个js文件中，也不可能在应用启动时一次性加载所有的js文件，否则长时间的白屏会让用户抓狂，大大影响用户体验。这时可以将代码进行分割，使其可以并行加载，也可以在不同的阶段（如不同路由）去加载所需的代码，这即是代码分割和按需加载。</p>
<p>webpack内置了非常强大的代码自动分割功能，也是它最引人注目的特性之一，如果合理使用，可以极大的提升应用加载时间。</p>
<p>常用的代码分离：</p>
<ul>
<li>入口chunk分割：使用entry配置多个chunk，手动分离代码。</li>
<li>提取公用代码：<a href="https://webpack.docschina.org/plugins/split-chunks-plugin/"><code>SplitChunksPlugin</code></a> 去重和分离 chunk。</li>
<li>动态导入与按需加载：通过模块中的内联函数调用来分离代码，目前推荐使用<code>import()</code>语法。</li>
</ul>
<h4><a id="%E5%85%A5%E5%8F%A3chunk%E5%88%86%E5%89%B2" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>入口chunk分割</h4>
<p>最简单的分离方式就是在入口手动将代码分成不同的chunk。</p>
<pre class="line-numbers"><code class="language-js">// build/webpack.base.conf.js
module.exports = {
  entry: {
    app: '../src/index.js',
   	another: '../src/another-module.js'
  },
  output: {
    filename: '[name].bundle.js',
    path: path.resolve(__dirname, '../dist')
  }
};
</code></pre>
<p>构建结果：</p>
<pre class="line-numbers"><code class="language-bash">...
            Asset     Size   Chunks             Chunk Names
another.bundle.js  550 KiB  another  [emitted]  another
  index.bundle.js  550 KiB    index  [emitted]  index
Entrypoint index = index.bundle.js
Entrypoint another = another.bundle.js
...
</code></pre>
<p>这种方式虽然简单，但是存在一些问题：</p>
<ul>
<li>依赖开发者自己手动配置，不够智能。</li>
<li>如果每个入口chunk中均包含有某个模块，不会共享，而是会将该模块打包到各个 bundle 中。</li>
</ul>
<h4><a id="%E6%A8%A1%E5%9D%97%E5%8E%BB%E9%87%8D" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>模块去重</h4>
<p>webpack内置了<a href="https://webpack.docschina.org/plugins/split-chunks-plugin/"><code>SplitChunksPlugin</code></a>，可以很方便的把重复模块的提取成公共依赖，减少文件体积。而且将一些第三方依赖（一般不需要频繁变动）提取成公共依赖，也便于客户端做缓存，每次更新代码的时候，用户不需要重新下载这些没发生变化的模块。</p>
<pre class="line-numbers"><code class="language-js">// build/webpack.base.conf.js
module.exports = {
  // ...
  entry: {
    app: '../src/index.js',
   	another: '../src/another-module.js'
  },
  output: {
    filename: '[name].bundle.js',
    path: path.resolve(__dirname, '../dist')
  },
  optimization: {
     splitChunks: { // 添加此配置
       chunks: 'all'
     }
   }
};
</code></pre>
<p>现在重新打包，app和another中共用的模块将会抽离到vender中，避免了产生重复的模块。</p>
<pre class="line-numbers"><code class="language-bash">...
                          Asset      Size                 Chunks             Chunk Names
              another.bundle.js  5.95 KiB                another  [emitted]  another
                index.bundle.js  5.89 KiB                  index  [emitted]  index
vendors~another~index.bundle.js   547 KiB  vendors~another~index  [emitted]  vendors~another~index
Entrypoint index = vendors~another~index.bundle.js index.bundle.js
Entrypoint another = vendors~another~index.bundle.js another.bundle.js
...
</code></pre>
<p>chunk自动拆分是webpack4.0改进最大的功能， 如果同时满足以下条件，chunk 就会被拆分：</p>
<ul>
<li>新的 chunk 被复用，或者来自 node_modules 目录。</li>
<li>新的 chunk 大于 30Kb(min+gzip前）。</li>
<li>按需加载 chunk 的并发请求数量小于等于 5 个。</li>
<li>页面初始加载时的并发请求数量小于等于 3 个。</li>
</ul>
<p><code>splitChunks</code> 官方默认配置如下，可以根据需要进行修改：</p>
<pre class="line-numbers"><code class="language-js">{
  optimization: {

    splitChunks: {
      chunks: &quot;async&quot;, // 对哪些模块优化，取值有&quot;initial&quot;(初始化值) | &quot;all&quot;(所有，推荐) | &quot;async&quot; (动态导入，默认) | 函数
      minSize: 30000,              // 最小尺寸，小于此值才会分割
      minChunks: 1,                // 最小 chunk ，包被引用几次以上才会分割
      maxAsyncRequests: 5,         // 按需加载的最大并行请求数， 默认5
      maxInitialRequests: 3,       // 最大的初始化加载次数，默认3
      automaticNameDelimiter: '~', // 打包分隔符
      name: true,       // 拆分出来块的名字，默认由块名和 hash 值自动生成，此选项可接收 function
      cacheGroups: {   // 这里开始设置缓存的 chunks ，缓存组
        vendors: {
          test: /[\\/]node_modules[\\/]/,
          priority: -10,
        },
        default: {
          minChunks: 2,
          priority: -20,
          reuseExistingChunk: true,
        }
      }
    }
  }
}
</code></pre>
<h4><a id="%E5%8A%A8%E6%80%81%E5%AF%BC%E5%85%A5%E4%B8%8E%E6%8C%89%E9%9C%80%E5%8A%A0%E8%BD%BD" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>动态导入与按需加载</h4>
<p>webpack提供了两种方式进行动态导入代码。</p>
<ul>
<li><a href="https://webpack.docschina.org/api/module-methods#require-ensure"><code>require.ensure</code></a>：早期遗留的方式。</li>
<li><a href="https://webpack.docschina.org/api/module-methods#import-"><code>import()</code> 语法</a>：ES规范中的动态导入模块方法（推荐）。</li>
</ul>
<p><code>import()</code>是<a href="https://github.com/tc39/proposal-dynamic-import">ECMAScript 提案</a>中的一个动态导入模块（异步方式）的方法，webpack在遇到此语法，会以引入的文件为入口单独生成一个chunk，并输出一个单独的bundle。代码执行时，并不会加载全部bundle，而是执行到某个import的文件时，才会去加载该bundle，这即是按需加载的流程。</p>
<p>按需加载也称为“懒加载”，是一种非常好的优化方式，可以大大提升应用的初始加载速度，也可以大大缩小用户加载文件的体积。</p>
<p>比如一个应用，有9个页面是管理员可以访问的，而普通用户只能访问其中的两个页面，如果不采用按需加载，那普通用户虽然只能访问两个页面，但是还是会加载所有页面依赖的文件，这是不合理的。</p>
<p>类似，下面这个页面不需要一开始就加载<code>module.js</code>，而只需在按钮被点击时才加载并执行其中的代码，可在浏览器开发者工具的network选项卡观察加载情况。</p>
<pre class="line-numbers"><code class="language-js">document.getElementById('my-button').onclick = function() {
    import('./module.js').then(fn =&gt; {
        fn.default &amp;&amp; fn.default();
    });
}
</code></pre>
<p><code>module.js</code>和它内部依赖的文件就会单独生成一个bundle，并且是按需加载的。如果我们想控制输出bundle的名字，也可以指定chunk的名字，需要使用到webpack的魔法注释。</p>
<pre class="line-numbers"><code class="language-js">document.getElementById('my-button').onclick = function() {
    import(/* webpackChunkName: &quot;moduleA&quot; */ './module.js').then(fn =&gt; { // 指定chunkName为moduleA
        fn.default &amp;&amp; fn.default();
    });
}
</code></pre>
<p><strong>提示：</strong><code>import()</code>会返回一个promise，所以也可以使用<code>async function</code>优化链式写法。</p>
<pre class="line-numbers"><code class="language-js">document.getElementById('my-button').onclick = async function() {
    const fn = await import(/* webpackChunkName: &quot;moduleA&quot; */ './module.js')
    fn.default &amp;&amp; fn.default();
}
</code></pre>
<p>**扩展：**除了webpackChunkName外，webpack还有另外两种魔法注释用来做模块的prefetch和preload，具体使用方法可以查看<a href="https://webpack.js.org/guides/code-splitting/#prefetchingpreloading-modules">官方文档</a>。</p>
<p>在实际项目中，代码分割也可以参考如下分离原则：</p>
<ul>
<li>业务代码和第三方依赖分离</li>
<li>业务代码、业务公共代码和第三方依赖分离</li>
<li>首次加载和访问后加载的代码分离</li>
</ul>
<h3><a id="%E5%BC%80%E5%90%AFgzip" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>开启Gzip</h3>
<p>如果部署服务器开启了gzip，那么可利用<a href="https://github.com/webpack-contrib/compression-webpack-plugin"><code>compression-webpack-plugin</code></a>生成gzip包，来减少加载时间。</p>
<pre class="line-numbers"><code class="language-shell">npm i compression-webpack-plugin -D
</code></pre>
<pre class="line-numbers"><code class="language-js">// build/webpack.prod.conf.js
const CompressionWebpackPlugin = require('compression-webpack-plugin');
const productionGzipExtensions = ['js', 'css', 'json', 'txt', 'html','ico','svg'];
module.exports = {
	plugins:[
		new CompressionWebpackPlugin({
      // 开启gzip压缩
      algorithm: 'gzip', // 压缩算法
      test: new RegExp('\\.(' + productionGzipExtensions.join('|') + ')$'),
      threshold: 10240, // 仅处理大于此大小的资源（以字节为单位）
      minRatio: 0.8 // 压缩比大于此值才处理
    })
	]
}

</code></pre>
<h3><a id="%E4%BD%BF%E7%94%A8cdn" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>使用CDN</h3>
<p>将一些第三方依赖改用CDN引入，也是常用的优化手段，因为一般第三方模块不会像业务代码一般频繁更新，使用CDN后，客户端会缓存这些资源，提升应用加载速度。不仅如此，这些依赖也不会参与构建过程（不会被打包进输出文件中），也可以提升构建速度。</p>
<pre class="line-numbers"><code class="language-js">// build/webpack.base.conf.js
module.exports = {
    externals: {
        'vue': 'Vue', // 配置需要排除的包名称
        // ...
    }
}
</code></pre>
<p>在js中还是使用<code>import Vue from 'vue'</code>即可，不过别忘了在html做引入。</p>
<pre class="line-numbers"><code class="language-html">&lt;!-- public/index.html --&gt;
&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;en&quot;&gt;
&lt;head&gt;
    &lt;meta charset=&quot;UTF-8&quot;&gt;
    &lt;title&gt;app&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;div id=&quot;root&quot;&gt;root&lt;/div&gt;
    &lt;script src=&quot;https://cdn.jsdelivr.net/npm/vue@2.6.11&quot;&gt;&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>
<h2><a id="%E6%8F%90%E5%8D%87%E6%9E%84%E5%BB%BA%E6%95%88%E7%8E%87" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>提升构建效率</h2>
<p>随着业务发展，我们的项目规模可能越来越大，代码也会越来越多，就会进入改代码十秒钟，build十分钟的尴尬境地，加班什么的都不在话下。所以为了有更多的时间和女神约会，提升webpack构建效率就势在必行了。</p>
<p>提升webpack的构建效率本质就是让它少干点活，应该尽量避免让它去做一些不必要的事情。围绕这个方向，我们就可以动手搞事情了。</p>
<h3><a id="%E4%BC%98%E5%8C%96resolve%E8%A7%A3%E6%9E%90%E8%A7%84%E5%88%99" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>优化<code>resolve</code>解析规则</h3>
<p>可以通过优化resolve下的解析规则来让webpack更加快速的定位到指定的模块，而不用做更多的匹配查询工作。</p>
<pre class="line-numbers"><code class="language-js">// build/webpack.base.conf.js
resolve: {
  modules: [
    path.resolve(__dirname, 'node_modules'), // 使用绝对路径明确指定 node_modules
  ],
  // 减少后缀自动补全类型，减少自动匹配工作，缩短文件路径查询的时间，其他类型的文件需要在引入时指定后缀名
  extensions: [&quot;.js&quot;],
  // 避免使用默认文件，而是必须使用完整的路径
  mainFiles: ['index'],
},
</code></pre>
<h3><a id="%E7%BC%A9%E5%B0%8F%E6%90%9C%E7%B4%A2%E8%8C%83%E5%9B%B4" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>缩小搜索范围</h3>
<p>如，在loader规则配置时，使用一些规则（include，exclude等）来缩小模块的搜索范围，搜索和处理的文件少了，速度自然也就提升了。</p>
<pre class="line-numbers"><code class="language-js">// build/webpack.base.conf.js
module.exports = {
  module: {
    rules: [
      {
        test: /\.js$/,
        include: path.resolve(__dirname, 'src'), // 仅仅搜索src下的文件，一般node_modules中的文件都已编译好，不需再处理，需要排除掉
        loader: 'babel-loader'
      }
    ]
  }
};
</code></pre>
<h3><a id="%E7%B2%BE%E7%AE%80loaderplugin" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>精简<code>loader/plugin</code></h3>
<p>每个loader/plugin都是需要消耗构建时间的，尽量减少冗余或者不必要的工具和配置，在选择这些工具时也尽量选择一些性能好一点的。</p>
<h3><a id="%E4%BD%BF%E7%94%A8dllplugin" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>使用DLLPlugin</h3>
<p><a href="https://doc.webpack-china.org/plugins/dll-plugin">DLLPlugin</a> 是 webpack 官方提供的一个插件，使用 <code>DllPlugin</code> 为更改不频繁的代码(如vue、react等第三方模块)生成单独编译结果缓存下来，后续构建直接使用这些文件，避免重复构建。这样可以显著提高应用程序的编译速度。</p>
<p>需要先利用webpack内置插件<a href="https://doc.webpack-china.org/plugins/dll-plugin">DLLPlugin</a>生成资源动态链接库，然后再使用<a href="https://webpack.docschina.org/plugins/dll-plugin/#dllreferenceplugin">DLLReferencePlugin</a>将对应资源映射到这些动态链接库就可以了，不过这样配置还是比较复杂的。</p>
<p>我们可以选择 <a href="https://github.com/asfktz/autodll-webpack-plugin">AutoDllPlugin</a>，它整合了上述两个插件的功能，而配置比较简单。</p>
<pre class="line-numbers"><code class="language-bash">npm install --save-dev autodll-webpack-plugin
</code></pre>
<pre class="line-numbers"><code class="language-js">// build/webpack.base.conf.js
plugins: [
  //...
  new AutoDllPlugin({
    inject: true,
    filename: '[name].js',
    entry: {
      vendor: [
        'vue'
      ]
    }
  })
]
</code></pre>
<p><img src="media/17280327068074/17281443522384.png" alt="优化前" /></p>
<p><img src="media/17280327068074/17281443522401.png" alt="优化后" /></p>
<p>可以看到两次打包时间差别还是挺大的，确实比较有效，目前示例项目模块较少，在大项目效果应该更加显著。</p>
<h3><a id="%E5%B0%8F%E5%8D%B3%E6%98%AF%E5%BF%AB" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>小即是快</h3>
<p>使用数量更少/体积更小的 library，如将momentJS换成dayJS，减少编译结果的整体大小，以提高构建性能。尽量保持 chunk 体积小。</p>
<ul>
<li>使用数量更少/体积更小的 library。</li>
<li>在多页面应用程序中使用 <code>SplitChunksPlugin</code>。</li>
<li>在多页面应用程序中使用 <code>SplitChunksPlugin </code>，并开启 <code>async</code> 模式。</li>
<li>移除未引用代码。</li>
<li>只编译你当前正在开发的那些代码。</li>
</ul>
<h3><a id="%E6%8C%81%E4%B9%85%E5%8C%96%E7%BC%93%E5%AD%98" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>持久化缓存</h3>
<p>使用 <code>cache-loader</code>为某些耗费性能的loader启用持久化缓存，可以减少重新构建文件的数量，能有效提升构建速度。</p>
<pre class="line-numbers"><code class="language-shell">npm install cache-loader -D
</code></pre>
<pre class="line-numbers"><code class="language-js">// build/webpack.base.conf.js
module.exports = {
    module: {
        rules: [{
            test: /\.jsx?$/,
            use: ['cache-loader','babel-loader'] // 仅需将cache-loader放在需要缓存的loader前面就行了
        }]
    }
}
</code></pre>
<p>**提示：**某些loader本身是支持配置cache的，可选择使用loader自带的缓存功能。如给<code>babel-loader</code>的cacheDirectory配置缓存路径（true或者不设置路径则使用默认路径<code>node_modules/.cache/babel-loader</code>），即可开启缓存。</p>
<blockquote>
<p>除了使用loader外，一些插件也可以提供缓存功能，如<a href="https://www.npmjs.com/package/hard-source-webpack-plugin">HardSourceWebpackPlugin</a> 。</p>
<p>因为缓存需要将文件写入到磁盘，而文件写入也是有开销的，所以好钢要用在刀刃上，建议仅对比较耗费性能的loader开启。</p>
<p>webpack5.0已经内置了<a href="https://webpack.docschina.org/configuration/other-options/#cache">持久缓存方案</a>，能够有效提升构建速度。</p>
</blockquote>
<h3><a id="%E5%9B%A0%E5%9C%B0%E5%88%B6%E5%AE%9C" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>因地制宜</h3>
<p>针对不同环境选择合适的配置，如设置合适的devtool（source-map），开发环境不进行代码压缩优化等。</p>
<h3><a id="%E5%BC%80%E5%90%AF%E5%A4%9A%E8%BF%9B%E7%A8%8B" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>开启多进程</h3>
<p><code>thread-loader</code> 可以管理多个进程，可将非常消耗资源的 loader 分配给一个 worker进程，从而减少主进程的性能开销。</p>
<pre class="line-numbers"><code class="language-shell">npm install thread-loader -D
</code></pre>
<pre class="line-numbers"><code class="language-js">// build/webpack.base.conf.js
module.exports = {
    module: {
        rules: [
            {
                test: /\.jsx?$/,
                use: ['thread-loader', 'babel-loader'] // 仅需在对应的loader前面添加thread-loader即可
            }
        ]
    }
}
</code></pre>
<blockquote>
<p><em>不要使用太多的 worker，因为 Node.js 的 runtime 和 loader 都有启动开销。要最小化 worker 和 main process(主进程) 之间的数据传输，因为进程间通讯(IPC, inter process communication)也是非常消耗资源的。</em></p>
<p>除了<code>thread-loader</code>，HappyPack也可以开启多进程，不过配置更加复杂一点，因为不再维护，固不推荐使用。</p>
<p>现在webpack内置JS压缩使用了TerserWebpackPlugin，本身已开启多进程，固不再需要手动开启。</p>
</blockquote>
<p>除了以上手段，webpack和nodeJS每个版本迭代也会大幅提升性能，及时升级工具也是提升构建效率的有效手段。更多的性能优化手段可以查看<a href="https://webpack.docschina.org/guides/build-performance/">官方文档-构建性能</a>。</p>
<h1><a id="%E4%BF%AE%E7%82%BC%E5%86%85%E5%8A%9F%E5%8E%9F%E7%90%86" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>修炼内功-原理</h1>
<h2><a id="%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>工作原理</h2>
<h3><a id="%E8%BF%90%E8%A1%8C%E6%B5%81%E7%A8%8B" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>运行流程</h3>
<p>webpack运行流程是串行方式的，大致如下：</p>
<ol>
<li>初始化参数：从配置文件和 Shell 语句中读取与合并参数配置，得出最终的参数配置；</li>
<li>开始编译：用上一步得到的参数配置初始化 Compiler 对象，加载所有配置的插件，执行对象的 run 方法开始执行编译；</li>
<li>确定入口：根据配置中的 entry 找出所有的入口文件；</li>
<li>编译模块：从入口文件出发，调用所有配置的 Loader 对模块进行翻译，再找出该模块依赖的模块，再递归本步骤。直到所有入口依赖的文件都经过了本步骤的处理；</li>
<li>完成模块编译：在经过第4步使用 Loader 翻译完所有模块后，得到了每个模块被翻译后的最终内容以及它们之间的依赖关系；</li>
<li>输出资源：根据入口和模块之间的依赖关系，组装成一个个包含多个模块的 Chunk，再把每个 Chunk 转换成一个单独的文件加入到输出列表，这步是可以修改输出内容的最后机会；</li>
<li>输出完成：在确定好输出内容后，根据配置确定输出的路径和文件名，把文件内容写入到文件系统。</li>
</ol>
<p><strong>提示：在以上的过程中，webpack会在特定的时机广播出对应的事件，方便触发插件中监听了这些事件的钩子运行。</strong></p>
<p>看似流程较多，我们可以精简一下：</p>
<ol>
<li>
<p>初始化：启动构建，读取与合并配置参数，加载 Plugin，实例化 Compiler。</p>
</li>
<li>
<p>编译：从 Entry 发出，针对每个 Module 串行调用对应的 Loader 去翻译文件内容，再找到该 Module 依赖的 Module，递归地进行编译处理。</p>
</li>
<li>
<p>输出：对编译后的 Module 组合成 Chunk，把 Chunk 转换成文件，输出到文件系统。</p>
<p><img src="media/17280327068074/17281443522425.png" alt="" /></p>
</li>
</ol>
<p>参考资料：<a href="%5Bhttp://www.xbhub.com/wiki/webpack/5%E5%8E%9F%E7%90%86/5-1%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86%E6%A6%82%E6%8B%AC.html%5D(http://www.xbhub.com/wiki/webpack/5%E5%8E%9F%E7%90%86/5-1%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86%E6%A6%82%E6%8B%AC.html)">webpack工作原理概括</a></p>
<h3><a id="%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84webpack" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>实现一个简单的webpack</h3>
<p>俗话说：读万卷书不如行万里路，讲再多的原理都不如敲敲代码来得实在。下面我们就一步一步实现一个简单的打包器。</p>
<h4><a id="%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>准备工作</h4>
<p>创建一个项目，包含如下文件及文件夹：</p>
<p><img src="media/17280327068074/17281443522446.png" alt="image-20200705215338484" /></p>
<pre class="line-numbers"><code class="language-js">// /src/index.js
import a from './a.js';

console.log(a);
</code></pre>
<pre class="line-numbers"><code class="language-js">// /src/a.js
import b from './b.js';
const a = `b content: ${b}`;
export default a;
</code></pre>
<pre class="line-numbers"><code class="language-js">// /src/b.js
const b = 'Im B';
export default b;
</code></pre>
<p>现在这样的代码在不支持ESModule的浏览器是不能运行的，需要使用打包器进行转换才行，马上开撸。</p>
<h4><a id="%E5%AE%9E%E7%8E%B0%E6%A8%A1%E5%9D%97%E6%89%93%E5%8C%85" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>实现模块打包</h4>
<p>在开撸前，我们明确下打包的目标和流程：</p>
<ol>
<li>找到项目入口（即<code>/src/index.js</code>），并读取其内容；</li>
<li>分析入口文件内容，递归寻找其依赖，生成依赖关系图；</li>
<li>根据生成的依赖关系图，编译并生成最终输出代码</li>
</ol>
<p><code>/myBundle.js</code>即为我们的打包器，所有相关的代码也将写在其中，下面开始吧！</p>
<h5><a id="1%E8%8E%B7%E5%8F%96%E6%A8%A1%E5%9D%97%E5%86%85%E5%AE%B9" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>1. 获取模块内容</h5>
<p>读取入口文件的内容，这个很简单，我们创建一个方法<code>getModuleInfo</code>，使用<code>fs</code>来读取文件内容：</p>
<pre class="line-numbers"><code class="language-js">// myBundle.js
const fs = require('fs')
const getModuleInfo = file =&gt; {
    const content = fs.readFileSync(file, 'utf-8')
    console.log(content)
}
getModuleInfo('./src/index.js')
</code></pre>
<p>毫无疑问，这里会输出<code>index.js</code>文件的内容，不过它是一堆字符串，我们如何才能知道它依赖了哪些模块呢？有如下两种方式：</p>
<ul>
<li>正则：通过正则匹配'import'关键字来获取相应的文件路径，不过太麻烦了，还不可靠，万一代码里面有个字符串也有这些内容呢？</li>
<li>babel：可以通过<code>@babel/parser</code>来将代码转换成AST（抽象语法树，Abstract Syntax Tree, 简称AST），再来分析AST查找依赖。看起来这种比较靠谱。</li>
</ul>
<p>毫无疑问，使用第二种方式。</p>
<pre class="line-numbers"><code class="language-shell">npm i @babel/parser ## 安装 @babel/parser
</code></pre>
<pre class="line-numbers"><code class="language-js">// myBundle.js
const fs = require('fs')
const parser = require('@babel/parser')
const getModuleInfo = file =&gt; {
    const content = fs.readFileSync(file, 'utf-8')
    const ast = parser.parse(content, {
       sourceType: 'module' // 解析ESModule须配置
    })
    console.log(ast)
    console.log(ast.program.body)
}
getModuleInfo('./src/index.js')
</code></pre>
<p>转换结果如下，可以看到一共两个节点，<code>type</code>属性标识了节点的类型，<code>ImportDeclaration</code>即对应了<code>import</code>语句，而其<code>source.value</code>即是引入模块的相对路径。想要的数据都有，是不是很赞！</p>
<p><img src="media/17280327068074/17281443522462.png" alt="image-20200705223745187" /></p>
<h5><a id="2%E7%94%9F%E6%88%90%E4%BE%9D%E8%B5%96%E5%85%B3%E7%B3%BB%E8%A1%A8" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>2. 生成依赖关系表</h5>
<p>有了上一步的数据，我们需要将它们生成一份结构化的依赖表，方便后续对代码处理。</p>
<p>其实就是遍历<code>ast.program.body</code>，将其中的<code>ImportDeclaration</code>类型的节点提取出来，并存入依赖表。</p>
<p>这里也不需要自己手动实现细节，直接使用<code>@babel/traverse</code>即可。</p>
<pre class="line-numbers"><code class="language-shell">npm i  @babel/traverse ## 安装@babel/traverse
</code></pre>
<p><code>getModuleInfo</code>方法做如下修改：</p>
<pre class="line-numbers"><code class="language-js">// myBundle.js
const fs = require('fs')
const path = require('path')
const parser = require('@babel/parser')
const traverse = require('@babel/traverse').default
const getModuleInfo = (file) =&gt; {
	const content = fs.readFileSync(file, 'utf-8');
	const ast = parser.parse(content, {
		sourceType: 'module'
	});
  	const dependencies = {}; // 用于存储依赖
    traverse(ast, {
        ImportDeclaration({ node }) { // 只处理ImportDeclaration类型的节点
            const dirname = path.dirname(file);
            const newFile = '.'+ path.sep + path.join(dirname, node.source.value); // 此处将相对路径转化为绝对路径，
            dependencies[node.source.value] = newFile;
        }
  	});
  	console.log(dependencies);
};
getModuleInfo('./src/index.js')
</code></pre>
<p>输出结果如下：</p>
<p><img src="media/17280327068074/17281443522480.png" alt="image-20200705230403954" /></p>
<p>接下来我们就可以返回一个完整的模块信息了。</p>
<p>在这里，我们顺便通过<code>babel</code>的工具（``@babel/core<code>，</code>@babel/preset-env`）将代码转换成ES5的语法。</p>
<pre class="line-numbers"><code class="language-shell">npm i @babel/core @babel/preset-env ## 安装@babel/core @babel/preset-env
</code></pre>
<pre class="line-numbers"><code class="language-js">// myBundle.js
const fs = require('fs');
const path = require('path');
const parser = require('@babel/parser');
const traverse = require('@babel/traverse').default;
const babel = require('@babel/core');

const getModuleInfo = (file) =&gt; {
	const content = fs.readFileSync(file, 'utf-8');
	const ast = parser.parse(content, {
		sourceType: 'module'
  });
  const dependencies = {};
	traverse(ast, {
		ImportDeclaration({ node }) {
			const dirname = path.dirname(file);
			const newFile = '.'+ path.sep + path.join(dirname, node.source.value);
			dependencies[node.source.value] = newFile; // 使用文件相对路径为key，绝对路径为value
		}
  });
  const { code } = babel.transformFromAst(ast, null, {
		presets: ['@babel/preset-env']
  });
  const moduleInfo = { file, dependencies, code };
  console.log(moduleInfo);
	return moduleInfo;
};

getModuleInfo('./src/index.js');
</code></pre>
<p>输出如下：</p>
<p><img src="media/17280327068074/17281443522498.png" alt="image-20200705231114976" /></p>
<p>现在，模块的代码就已经转换成了一个对象，包含模块的绝对路径、依赖以及被babel转换后的代码，不过上面只处理了<code>index.js</code>的依赖，<code>a.js</code>的依赖并没有进行处理，所以并不是一份完整的依赖表，我们需要进一步处理。</p>
<p>其实也很简单，就是从入口开始，每个模块及其依赖都调用一下<code>getModuleInfo</code>方法进行分析，最终就会返回一个完整的依赖表(也有人叫依赖图，dependency graph)。</p>
<p>我们直接新写一个方法来处理：</p>
<pre class="line-numbers"><code class="language-js">// myBundle.js
const generDepsGraph = (entry) =&gt; {
	const entryModule = getModuleInfo(entry);
	const graphArray = [ entryModule ];
	for(let i = 0; i &lt; graphArray.length; i++) {
		const item = graphArray[i];
		const { dependencies } = item;
		if(dependencies) {
			for(let j in dependencies) {
				graphArray.push(
					getModuleInfo(dependencies[j])
				);
			}
		}
	}
	const graph = {};
	graphArray.forEach(item =&gt; {
		graph[item.file] = {
			dependencies: item.dependencies,
			code: item.code
		};
	});
	return graph;
};
</code></pre>
<p><img src="media/17280327068074/17281443522518.png" alt="image-20200705232430595" /></p>
<p>现在，我们就生成一份完整的依赖表了，接下来，就可以根据这份数据来生成最终的代码了。</p>
<h5><a id="3%E7%94%9F%E6%88%90%E8%BE%93%E5%87%BA%E4%BB%A3%E7%A0%81" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>3.生成输出代码</h5>
<p>在生成代码前，我们先观察一下上面的代码，可以发现里面包含了<code>export</code>和<code>require</code>这样的<code>commonjs</code>的语法，而我们的运行环境（这里是浏览器）是不支持这种语法的，所以还需要自己来实现一下这两个方法。先贴上代码，再慢慢道来：</p>
<p>新建一个build方法，用来生成输出的代码。</p>
<pre class="line-numbers"><code class="language-js">// myBundle.js
const build = (entry) =&gt; {
	const graph = JSON.stringify(generDepsGraph(entry));
	return `
		(function(graph){
			function require(module) {
				var exports = {};
				return exports;
			};
			require('${entry}')
		})(${graph});
	`;
};

const code = build('./src/index.js');
</code></pre>
<p>说明：</p>
<ul>
<li>第三行<code>JSON.stringify</code>是将数据字符串化，否则在下面的立即执行函数中接收到的将是<code>[object object]</code>，因为下面是在字符串模板中使用，会发生类型转换。</li>
<li>返回的代码包裹在IIFE（立即执行函数）中是防止模块间作用域相互污染。</li>
<li><code>require</code>函数需要定义在输出的内容中，而不是当前的运行环境中，因为它会在生成的代码中执行。</li>
</ul>
<p>接下来，我们需要拿到入口文件的code，并使用<code>eval</code>函数来执行它：</p>
<pre class="line-numbers"><code class="language-js">// myBundle.js
const build = (entry) =&gt; {
	const graph = JSON.stringify(generDepsGraph(entry));
	return `
		(function(graph){
			function require(module) {
				var exports = {};
				(function(require, exports, code){
					eval(code)
				})(require, exports, graph[module].code);
				return exports;
			};
			require('${entry}')
		})(${graph});
	`;
};

const code = build('./src/index.js');
console.log(code);
</code></pre>
<p>说明：</p>
<ul>
<li>为了防止code中的代码和我们这里（return的字符串中）作用域有冲突，我们还是使用IIFE包裹，并将需要的参数传递进去。</li>
<li><code>graph[module].code</code>可以从上面的依赖表中获取到入口的代码。</li>
</ul>
<p>输出如下：</p>
<p><img src="media/17280327068074/17281443522537.png" alt="image-20200706091126005" /></p>
<p>这就是打包的成果了，不过先不要高兴过头了，这里还有一个大坑。</p>
<p>我们现在生成的代码中引入模块的方式都是基于'index.js'的相对路径，如果在其他模块引入的模块路径和相较于<code>index.js</code>不一致的时候，对应的模块就会找不到(路径不正确)，所以我们还要处理一下模块的路径。好在前面依赖表的<code>dependencies</code>属性里面记录了模块的绝对路径，只需要拿出来使用即可。</p>
<p>添加一个<code>localRequire</code>函数，用来从<code>dependencies</code>中获取模块绝对路径。</p>
<pre class="line-numbers"><code class="language-js">// myBundle.js
const build = (entry) =&gt; {
	const graph = JSON.stringify(generDepsGraph(entry));
	return `
		(function(graph){
			function require(module) {
				function localRequire(relativePath) {
					return require(graph[module].dependencies[relativePath]);
				}
				var exports = {};
				(function(require, exports, code){
					eval(code)
				})(localRequire, exports, graph[module].code);
				return exports;
			};
			require('${entry}')
		})(${graph});
	`;
};
</code></pre>
<p>接下来，将输出的代码写入到文件就可以了。</p>
<pre class="line-numbers"><code class="language-js">// myBundle.js
const code = build('./src/index.js')
fs.mkdirSync('./dist')
fs.writeFileSync('./dist/bundle.js', code)
</code></pre>
<p>最后，在html中引入一下，测试一下是否能够正常运行。没有疑问，肯定是可以正常运行的。:smile::smile:</p>
<p><img src="media/17280327068074/17281443522557.png" alt="image-20200706092931226" /></p>
<p>最后贴一下完整的代码：     :cow::beers:</p>
<pre class="line-numbers"><code class="language-js">// myBundle.js
const fs = require('fs');
const path = require('path');
const parser = require('@babel/parser');
const traverse = require('@babel/traverse').default;
const babel = require('@babel/core');

const getModuleInfo = (file) =&gt; {
	const content = fs.readFileSync(file, 'utf-8');
	const ast = parser.parse(content, {
		sourceType: 'module'
  });
  const dependencies = {};
	traverse(ast, {
		ImportDeclaration({ node }) {
			const dirname = path.dirname(file);
			const newFile = '.'+ path.sep + path.join(dirname, node.source.value);
			dependencies[node.source.value] = newFile;
		}
  });
  const { code } = babel.transformFromAst(ast, null, {
		presets: ['@babel/preset-env']
  });
  const moduleInfo = { file, dependencies, code };
	return moduleInfo;
};

const generDepsGraph = (entry) =&gt; {
	const entryModule = getModuleInfo(entry);
	const graphArray = [ entryModule ];
	for(let i = 0; i &lt; graphArray.length; i++) {
		const item = graphArray[i];
		const { dependencies } = item;
		if(dependencies) {
			for(let j in dependencies) {
				graphArray.push(
					getModuleInfo(dependencies[j])
				);
			}
		}
	}
	const graph = {};
	graphArray.forEach(item =&gt; {
		graph[item.file] = {
			dependencies: item.dependencies,
			code: item.code
		};
	});
	return graph;
};
const build = (entry) =&gt; {
	const graph = JSON.stringify(generDepsGraph(entry));
	return `
		(function(graph){
			function require(module) {
				function localRequire(relativePath) {
					return require(graph[module].dependencies[relativePath]);
				}
				var exports = {};
				(function(require, exports, code){
					eval(code)
				})(localRequire, exports, graph[module].code);
				return exports;
			};
			require('${entry}')
		})(${graph});
	`;
};

const code = build('./src/index.js');
fs.mkdirSync('./dist');
fs.writeFileSync('./dist/bundle.js', code);
</code></pre>
<p>在完成这个案例之前，webpack就像一位高贵的美人，让人敬而远之。而通过这个案例，我们撕下了她神秘的外衣，发现里面原来如此美妙，是不是美不胜收。当然实际不能如此简单，要去处理各种边界情况，还要支持loader和plugin，美人还是有点东西的😍。</p>
<h2><a id="%E8%81%8A%E8%81%8A%E6%A8%A1%E5%9D%97%E7%83%AD%E6%9B%BF%E6%8D%A2" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>聊聊模块热替换</h2>
<p>之所以在这里单独列出了模块热替换（HMR），是因为一直觉得这是一个很酷的功能，犹如黑魔法一般的存在。</p>
<h3><a id="%E4%BC%98%E5%8A%BF%E4%BD%95%E5%9C%A8" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>优势何在</h3>
<p>模块热替换简称为 HMR(Hot Module Replacement)，能大大提升开发体验，是非常实用的一个功能。在这之前，用得比较多的是<code>live-reload</code>，在编辑器和浏览器安装对应的插件后，当编辑器保存的时候，浏览器会进行页面刷新，其实相比手动F5也算比较方便了。不过它只能采用整页刷新，所以存在一些缺陷：</p>
<ul>
<li>效率低，整页刷新意味着所有资源将重新加载，速度可想而知。</li>
<li>如果页面中的状态未采用持久化，刷新后状态将会重置丢失。</li>
</ul>
<p>在gulp流行的时候，用得比较多的是一个叫<a href="https://browsersync.io/"><code>BrowserSync</code></a>的插件，可以同时在多个设备打开多个浏览器，点击和滚动操作在所有浏览器上都会同步，也算是比较好用的一个工具。这里它不是主角，不做介绍。</p>
<p>webpack的HMR是在应用运行时，尽量在重载整个页面的前提下动态替换、添加或删除模块，相比以往的工具，它有以下优势：</p>
<ul>
<li>更新页面内容的时候不会丢失应用的状态（不是绝对的，取决于模块的影响范围）。</li>
<li>只更新有变更的内容，而不是整页重载，快速和高效。</li>
</ul>
<h3><a id="%E8%BF%90%E8%A1%8C%E5%8E%9F%E7%90%86" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>运行原理</h3>
<p>前面已经介绍了如何使用模块热替换，所以这里不会再赘述用法，仅仅简单了解一下相关概念即可。</p>
<h4><a id="manifest" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a><code>Manifest</code></h4>
<p>首先需要了解一下<code>Manifest</code>，它是webpack维护的一份用于管理构建过程中所有模块及关联关系的数据表，包含了各个模块之间的依赖关系、模块内容等详细信息，是webpack解析和加载模块的重要依据。</p>
<h4><a id="%E6%9B%B4%E6%96%B0%E6%B5%81%E7%A8%8B" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>更新流程</h4>
<p><img src="media/17280327068074/17281443522578.jpg" alt="img" /></p>
<p>上图是webpack 配合 webpack-dev-server 进行应用开发的模块热更新流程图，记录了完整的更新流程。</p>
<ul>
<li>上图底部红色框内是服务端，而上面的橙色框是浏览器端。</li>
<li>绿色的方框是 webpack 代码控制的区域。蓝色方框是 webpack-dev-server 代码控制的区域，洋红色的方框是文件系统，文件修改后的变化就发生在这，而青色的方框是应用本身。</li>
</ul>
<p>上图显示了修改代码到模块热更新完成的一个周期（步骤已使用序号标出），流程如下：</p>
<ol>
<li>webpack 对文件系统进行 watch 打包到内存中。在 webpack 的 watch 模式下，文件系统中某一个文件发生修改，webpack 监听到文件变化，根据配置文件对模块重新编译打包，并将打包后的代码通过简单的 JavaScript 对象保存在内存中（<em>文件写在内存中，速度更快，性能更高，使用<a href="https://link.zhihu.com/?target=https%3A//github.com/webpack/memory-fs">memory-fs</a>工具完成</em>）。</li>
<li>webpack-dev-server 和 webpack 之间的接口交互。而在这一步，主要是 dev-server 的中间件 webpack-dev-middleware 和 webpack 之间的交互，webpack-dev-middleware 调用 webpack 暴露的 API对代码变化进行监控，并且告诉 webpack，将代码打包到内存中。</li>
<li>webpack-dev-server 对文件变化的一个监控。这一步不同于第一步，并不是监控代码变化重新打包。当我们在配置文件中配置了<a href="https://link.zhihu.com/?target=https%3A//webpack.js.org/configuration/dev-server/%23devserver-watchcontentbase">devServer.watchContentBase</a> 为 true 的时候，Server 会监听这些配置文件夹中静态文件的变化，变化后会通知浏览器端对应用进行 live reload。注意，这儿是浏览器刷新，和 HMR 是两个概念。</li>
<li>webpack-dev-server 代码的工作。该步骤主要是通过 <a href="https://link.zhihu.com/?target=https%3A//github.com/sockjs/sockjs-client">sockjs</a>（webpack-dev-server 的依赖）在浏览器端和服务端之间建立一个 websocket 长连接，将 webpack 编译打包的各个阶段的状态信息告知浏览器端，同时也包括第三步中 Server 监听静态文件变化的信息。浏览器端根据这些 socket 消息进行不同的操作。当然服务端传递的最主要信息还是新模块的 hash 值，后面的步骤根据这一 hash 值来进行模块热替换。</li>
<li>webpack-dev-server/client 端并不能够请求更新的代码，也不会执行热更模块操作，而把这些工作又交回给了 webpack，webpack/hot/dev-server 的工作就是根据 webpack-dev-server/client 传给它的信息以及 dev-server 的配置决定是刷新浏览器呢还是进行模块热更新。当然如果仅仅是刷新浏览器，也就没有后面那些步骤了。</li>
<li>HotModuleReplacement.runtime 是客户端 HMR 的中枢，它接收到上一步传递给他的新模块的 hash 值，它通过 JsonpMainTemplate.runtime 向 server 端发送 Ajax 请求，服务端返回一个 json，该 json 包含了所有要更新的模块的 hash 值，获取到更新列表后，该模块再次通过 jsonp 请求，获取到最新的模块代码。这就是上图中 7、8、9 步骤。</li>
<li>而第 10 步是决定 HMR 成功与否的关键步骤，在该步骤中，HotModulePlugin 将会对新旧模块进行对比，决定是否更新模块，在决定更新模块后，检查模块之间的依赖关系，更新模块的同时更新模块间的依赖引用。</li>
<li>最后一步，当 HMR 失败后，回退到 live reload 操作，也就是进行浏览器刷新来获取最新打包代码。</li>
</ol>
<p>如上就是热更新的过程，当然这只是webpack所做的工作，此时业务代码中并不能知道代码是否发生变化，我们必须使用前面提到的<code>accept</code>方法来进行监听，并实现对应的变化相应操作。</p>
<pre class="line-numbers"><code class="language-js">if(module.hot) { // 先判断是否开启HMR
    module.hot.accept('./xxx.js', function() {
        // do something
    })
}
</code></pre>
<p><strong>提示：<code>accept</code>方法内容一般不用自己实现，很多工具（如vue-loader，style-loader）内部已提供，直接使用即可。</strong></p>
<p>参考资料：<a href="https://zhuanlan.zhihu.com/p/30669007">Webpack HMR 原理解析</a>，<a href="https://juejin.im/post/6844904193136787470">了不起的 Webpack HMR 学习指南</a>。</p>
<h2><a id="%E5%BC%80%E5%8F%91loader" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>开发loader</h2>
<p>webpack官方和社区已经提供了非常多的loader，正常来说，常用的文件解析都可以找到现成的loader。不过，来了解一下如何开发loader，有助于自己对loader工作原理的理解，而且在有需求的时候，也可以自己撸一个loader。</p>
<h3><a id="%E5%BC%80%E5%8F%91%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84loader" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>开发一个简单的loader</h3>
<p>其实自定义一个loader非常简单，本质上loader即是一个函数，接收参数并对其进行处理，而后返回处理结果（<strong>须为buffer或string</strong>）。</p>
<ul>
<li>新建<code>/loaders/replaceLoader.js</code>，</li>
</ul>
<pre class="line-numbers"><code class="language-js">// /loaders/replaceLoader.js
module.exports = function (source) {
  source = source.replace(/webpack/gi, 'world'); // 将源文件中的webpack替换成world
  return source;
};
</code></pre>
<ul>
<li>新建<code>/src/index.js</code></li>
</ul>
<pre class="line-numbers"><code class="language-js">// /src/index.js
console.log('hello webpack');
</code></pre>
<ul>
<li>配置webpack</li>
</ul>
<p>接下来，有必要先了解下如何来配置上面的loader。一般第三方的loader，安装了都在<code>node_modules</code>下面，webpack会从此处去找，但是现在loader在<code>/loaders/testLoader.js</code>，所以需要做些处理，有如下几种方式：</p>
<ol>
<li>直接require对应的loader（适用于单个loader）</li>
</ol>
<pre class="line-numbers"><code class="language-js">// webpack.config.js
module: {
  rules: [
    {
      test: /\.js$/,
      exclude: /node_modules/,
      loader: path.resolve('./loaders/replaceLoader.js')
    }
  ]
}
</code></pre>
<ol start="2">
<li>使用<code>resolveLoader</code>配置项（适用于多个loader）</li>
</ol>
<pre class="line-numbers"><code class="language-js">// webpack.config.js
module: {
  rules: [
    {
      test: /\.js$/,
      exclude: /node_modules/,
      use:'replaceLoader'
    }
  ]
},
resolveLoader: {
  modules: ['node_modules', path.resolver(__dirname, 'loaders')] // 查找优先级从左到右
}
</code></pre>
<ol start="3">
<li>如果准备将loader发布到npm，也可以使用 <a href="https://docs.npmjs.com/cli/link">npm-link</a>。</li>
</ol>
<p>这里，采用第二种方式，完整配置如下：</p>
<pre class="line-numbers"><code class="language-js">// webpack.config.js
const path = require('path');
module.exports = {
  mode:'development',
  entry: './src/index.js',
  output: {
    filename: 'bundle.js',
    path: path.resolve(__dirname, 'dist')
  },
  resolveLoader: {
    modules: ['node_modules', path.resolve(__dirname, 'loaders')]
  },
  module: {
    rules: [{
      test: /\.js$/,
      use:'replaceLoader'
    }]
  }
};
</code></pre>
<p>运行一下，打包命令<code>npx webpack</code>，可以看到输出文件中的webpack被替换成了world。</p>
<p><img src="media/17280327068074/17281443522583.png" alt="image-20200614224707431" /></p>
<p>一般loader都会提供配置项(options)，方便用户做个性配置，可以通过<code>this.query</code>获取配置内容，不过一般使用官方推荐的<a href="https://github.com/webpack/loader-utils">loader-utils</a> 工具更加便捷。</p>
<pre class="line-numbers"><code class="language-js">// webpack.config.js
const path = require('path');
module.exports = {
  mode:'development',
  entry: './src/index.js',
  output: {
    filename: 'bundle.js',
    path: path.resolve(__dirname, 'dist')
  },
  resolveLoader: {
    modules: ['node_modules', path.resolve(__dirname, 'loaders')]
  },
  module: {
    rules: [{
      test: /\.js$/,
      use: {
        loader:'replaceLoader',
        options: {
          src: /webpack/ig, // 配置要替换的内容
          to: 'world!' // 配置替换的目标内容
        }
      }
    }]
  }
};
</code></pre>
<p>修改一下<code>replaceLoader</code>：</p>
<pre class="line-numbers"><code class="language-js">// /loaders/replaceLoader.js
const loaderUtils = require('loader-utils');
module.exports = function (source) {
  const options = loaderUtils.getOptions(this);
  source = source.replace(options.src, options.to);
  return source;
};
</code></pre>
<p>**注意：**这里使用了this，this提供了很多有用的信息，所以不能使用箭头函数（会改变this指向）。如果需要对options进行校验，可以使用<a href="https://github.com/webpack/schema-utils">schema-utils</a>。</p>
<h3><a id="%E5%A4%8D%E6%9D%82%E7%9A%84%E6%83%85%E5%86%B5" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>复杂的情况</h3>
<p>至此，一个简单的loader就实现了，当然有时候可能会更加复杂。</p>
<p>其实，loader函数会接收三个参数：content、map、meta</p>
<ul>
<li>content：模块内容，可以是字符串或者buffer</li>
<li>map：sourcemap 对象</li>
<li>meta：一些元数据信息</li>
</ul>
<p>如果仅仅是返回处理结果，直接返回content即可。但如果需要生成sourcemap 对象、meta元数据或者抛出异常，需要将return换成<code>this.callback(err, content, map, meta)</code>来传递数据。</p>
<pre class="line-numbers"><code class="language-js">this.callback(
    // 当无法转换原内容时，给 Webpack 返回一个 Error
    err: Error | null,
    // 原内容转换后的内容
    content: string | Buffer,
    // 用于把转换后的内容得出原内容的 Source Map，方便调试
    sourceMap?: SourceMap,
    // 如果本次转换为原内容生成了 AST 语法树，可以把这个 AST 返回，
    // 以方便之后需要 AST 的 Loader 复用该 AST，以避免重复生成 AST，提升性能
    abstractSyntaxTree?: AST
);
</code></pre>
<p>另外，loader也是支持异步任务处理的，可以借助<code>this.async()</code>实现。</p>
<pre class="line-numbers"><code class="language-js">// /loaders/replaceLoader.js
const loaderUtils = require('loader-utils');
module.exports = function (source) {
  const options = loaderUtils.getOptions(this);
  const asyncfunc = this.async() // 调用异步func
  setTimeout(() =&gt; {
  	source = source.replace(options.src, options.to);
    asyncfunc(null, source) // 传递结果
  }, 200)
};
</code></pre>
<p>关于loader的开发，官方提供了很多api，读者可以查阅 <a href="https://webpack.js.org/api/loaders/">loader interface</a> 了解。</p>
<h3><a id="%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>注意事项</h3>
<ul>
<li>loader要遵循职责单一原则，一个loader只做一种转换，如果需要对源文件进行多次转换处理，则需要多个loader来实现。</li>
<li>调用多个loader来处理一个文件时，默认情况下loader会从后到前链式顺序执行，最后一个loader将会拿到文件的原始内容，处理后会将结果传递给下一个loader继续处理，直到最前面的loader处理完成返回给webpack。</li>
</ul>
<h2><a id="%E5%BC%80%E5%8F%91plugin" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>开发plugin</h2>
<p>plugin是webpack中非常重要的部分，它赋予了webpack强大的扩展能力。和loader不同的是loader主要是为了让webpack能够解析更多类型的文件，而plugin则可以参与打包过程中每个阶段。从使用方式我们可以看出plugin其实就是一个类，在调用构造函数的时候传入配置参数。</p>
<p>**注意：**下面使用的是webpack4.0版本，相比3.0的api是不一样的。</p>
<h3><a id="%E5%BC%80%E5%8F%91%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84plugin" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>开发一个简单的plugin</h3>
<p>自定义plugin的引入方式相比loader来说，非常简单：</p>
<pre class="line-numbers"><code class="language-js">// webpack.config.js
const path = require('path')
const TestWebpackPlugin = require('./test-webpack-plugin')
module.exports = {
    mode: 'development',
    entry: './src/index.js',
    output: {
        path: path.resolve(__dirname, 'dist'),
        filename: '[name]_[hash].js'
    },
    plugins: [
        new TestWebpackPlugin({
            // ...options
        })
    ]
}
</code></pre>
<blockquote>
<p>webpack的plugin命名需要遵循<code>插件名字-webpack-plugin</code>的格式。</p>
</blockquote>
<p>而plugin内部的实现也是比较简单的，由以下几部分组成：</p>
<ul>
<li>一个可以通过new调用的类函数</li>
<li>在该函数的<code>prototype</code>上定义一个<code>apply</code>方法，参数为<code>compiler</code></li>
<li>在<code>apply</code>方法中注册要监听的钩子名称、插件名称、回调函数</li>
<li>在回调函数中通过注入的参数，读取或操纵修改 Webpack 内部实例数据</li>
<li>异步类型的事件钩子，插件处理完成需要调用<code>callback</code>或者返回<code>promise</code></li>
</ul>
<pre class="line-numbers"><code class="language-js">// test-webpack-plugin.js
class TestWebpackPlugin {
    constructor (options) {
        // 在这里获取插件配置
    }
    // Webpack 会调用此 apply 方法并传入 compiler 对象
    apply (compiler) {
     		 // 这里可以在compiler的钩子（hook）上注册一些方法，	当webpack执行到特定的钩子时就会执行该阶段注册的方法
        compiler.hooks.done.tap('TestWebpackPlugin', (stats) =&gt; {
          console.log('Hello TestWebpackPlugin!');
            // ...
        })
      	// 在emit钩子上注册一个处理函数，因为该钩子为异步的，所以需要使用tapAsync
      	// emit钩子执行时机在资源输出到output之前
        compiler.hooks.emit.tapAsync('TestWebpackPlugin', (compilation, cb) =&gt; {
            // 在输出文件中增加一个文件test.js
            compilation.assets['test.js'] = {
              source() { // 文件内容
                return 'console.log(&quot;hello world&quot;)'
              },
              size() { // 文件的长度
                return 27;
              }
            };
            cb();    // 处理完成调用cb
        })
    }
}
module.exports = TestWebpackPlugin
</code></pre>
<h3><a id="%E6%89%A7%E8%A1%8C%E6%B5%81%E7%A8%8B" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>执行流程</h3>
<p>plugin内部核心就是apply，使用插件的时候，webpack会自动调用插件实例的apply方法，并将compiler作为参数传入。在<code>apply</code>内部，我们可以在<code>compiler</code>的hooks中特定的钩子上注册各种监听函数（发布订阅模式），当webpack执行到这些钩子的时候，就会调用对应的监听函数，从而实现对构建流程的处理。</p>
<p>下面我们以前面例子来了解插件具体的执行流程：</p>
<ul>
<li>
<p>通过<code>&lt;instance&gt;.hooks.&lt;hook name&gt;.&lt;tap API&gt;('&lt;plugin name&gt;', callback )</code>方式来进行hooks事件注册。</p>
<ul>
<li><code>instance</code>： <code>compiler</code> 或 <code>compilation</code> 实例</li>
<li><code>hook name</code> ：挂载目标钩子的名称</li>
<li>处理钩子可能是同步，也可能是异步的，需要使用根据不同情况选择使用的<code>tap API</code>，<code>tap API</code> 有三种：</li>
<li><code>tap</code> 用于挂载一个同步回调，适合任何事件钩子类型，使用回调返回结果。
<ul>
<li><code>tapAsync</code> 用于挂载一个异步回调，不能对同步类型钩子使用，回调中会注入 <code>callback</code>参数供插件处理完操作后调用，如果不调用 <code>callback</code> 交回流程控制权，将无法继续进行后续操作。</li>
<li><code>tapPromise</code> 和 <code>tapAsync</code> 的作用和限制类似，不同在于要求返回一个 <code>Promise</code> 实例，并且这个 <code>Promise</code> 一定会被决议（无论 resolve 或 reject ）</li>
</ul>
</li>
</ul>
</li>
</ul>
<pre class="line-numbers"><code class="language-js">// 同步
compiler.hooks.done.tap('MyPlugin', (stats, callback) =&gt; {
  // ...
  callback()
})
// 异步promise
compiler.hooks.emit.tapPromise('MyPlugin', (compilation) =&gt; {
  return new Promise((resolve, reject) =&gt; {
    // ...
  })
})
// 异步async function
compiler.hooks.emit.tapPromise('MyPlugin', async (compilation) =&gt; {
  await new Promise((resolve, reject) =&gt; {
    // ...
  })
})
// 异步回调
compiler.hooks.emit.tapAsync('MyPlugin', (compilation, callback) =&gt; {
	// ...
  callback()
})
</code></pre>
<ul>
<li>
<p>在钩子上注册的函数，接收两个参数，第一个为插件的名字，第二个为回调函数</p>
<ul>
<li>这个回调函数即为处理函数的主要内容，接收的参数由钩子决定，这里的<code>emit</code>钩子接收两个参数（分别是compilation, cb），compilation记录了本次打包的相关内容，cb回调函数在处理完成进行调用交回控制权。</li>
</ul>
</li>
<li>
<p><code>compilation.assets</code>保存了本次打包出来的所有的文件信息，上面的例子即往<code>assets</code>中新增了一个<code>test.js</code>文件（前提是添加之前，assets中没有与该文件同名的文件），source和size分别设置了文件的内容和长度。如果是对文件进行处理，直接对<code>assets</code>中的文件进行操作即可。</p>
</li>
<li>
<p>compilation上也可以注册钩子, 即存在<a href="https://webpack.js.org/api/compiler-hooks/">Compiler Hooks</a>和<a href="https://webpack.js.org/api/compilation-hooks/">Compilation Hooks</a>两种。</p>
</li>
</ul>
<pre class="line-numbers"><code class="language-js">compiler.hooks.compilation.tap('MyPlugin', (compilation) =&gt; {
  compilation.hooks.optimizeChunkAssets.tapAsync(
      'MyPlugin',
      (chunks, callback) =&gt; {
       	// 处理chunks
        // 结束调用callback方法
        callback();
      }
    );
})
</code></pre>
<h3><a id="hooks" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>hooks</h3>
<p>除了上述的<code>emit</code>钩子，webpack还提供了许多其他的钩子，覆盖到打包的各个阶段。</p>
<h4><a id="entryoption" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a><code>entryOption</code></h4>
<p>在<code>entry</code>配置项处理完成后执行，同步钩子。</p>
<pre class="line-numbers"><code class="language-js">compiler.hooks.entryOption.tap('MyPlugin', (context, entry) =&gt; {
  // context保存了当前目录信息，entry保存了入口文件信息
});
</code></pre>
<h4><a id="afteremit" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a><code>afterEmit</code></h4>
<p>生成资源到<code>output</code>后执行，异步钩子。</p>
<h4><a id="done" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a><code>done</code></h4>
<p>编译完成执行，同步钩子。</p>
<pre class="line-numbers"><code class="language-js">compiler.hooks.done.tap('TestWebpackPlugin', (stats) =&gt; {
  // stats保存了生成文件的内容
})
</code></pre>
<p>更多的hooks和用法可以查看<a href="https://webpack.js.org/api/compiler-hooks/#hooks">Plugin-Compiler Hooks</a>。</p>
<p>这些hooks的实现是基于<a href="https://github.com/webpack/tapable/">tapable</a>这个库，这个库提供了大量的钩子。这些钩子大概分为如下几类：</p>
<ul>
<li>并行的：名称带有<code>parallel</code>，该类函数注册后会并行调用。</li>
<li>顺序的：名称带有<code>bail</code>，该类函数注册后会顺序调用。</li>
<li>流式的：名称带有<code>waterfall</code>，该类函数注册后，调用时会流式处理，将上一个函数的返回结果作为下一个函数的参数。</li>
<li>组合的：也存在上述三种规则结合在一起的钩子。</li>
</ul>
<p>通过这些钩子，插件开发者可以干预构建的整个流程，从而实现对构建过程和内容的控制，如依赖查找，文件监听、修改文件内容等，所以编写一个插件的关键就在于使用各种hooks钩子函数。</p>
<p>这里我们仅简单了解了loader和plugin，实际开发中可能要复杂得多，这里也不可能穷尽所有场景和用法，仅做抛砖引玉，在实际开发的时候还需要自行查阅相关文档，作深入了解。</p>
<p>参考文档：<a href="https://webpack.docschina.org/">webpack官网-中文</a>，<a href="http://www.xbhub.com/wiki/webpack/">深入浅出webpack</a>，<a href="https://www.yuque.com/fe9/basic/sdviix">深入了解 Webpack</a></p>
<h1><a id="%E7%BB%93%E8%AF%AD" class="anchor" aria-hidden="true"><span class="octicon octicon-link"></span></a>结语</h1>
<p>webpack每个版本都有一个代号，4.0被命为<code>Legato</code>，意为“连奏”，寓意webpack在不断进化。webpack的进化点都是通过贡献者和用户投票来决定的。在3.0的时候，投票最多的用户体验、构建性能等都在weback4.0得到了巨大改善。</p>
<p>在当下，webpack是稳坐前端构建工具界扛把子之位，它确实是一款优秀的构建工具，它不仅拥有强大的扩展能力，还拥有一群优秀的开发者，拥有活跃的社区，给它提供源源不断的生命力，这些都是webpack最核心的竞争力。</p>
<p>在未来，随着ESModule规范的普及，或许我们将不再需要工具来进行模块打包，webpack也有可能被替代，但是我相信构建工具不会退出舞台，而只会做越来越多的事情，因为工程化的理念已深入人心。</p>
<p>但是，学习webpack这类构建工具并不是我们的最终目的，因为归根结底他们只不过是一个工具而已，是工具就会被更新被取代，而如何利用工具来解放生产力才应该是前端工程化的最终目的。前端工程化更重要的是一种思想，而不是特指某个特定的工具，他们仅是手段而已。在工作中要有意识将一些复杂或耗时的工作交给程序来做，并且可以将用到的工具和方法分享给其他人，如此不仅可以提高自己和团队的开发效率，还能提升自己的影响力，升职加薪，迎娶白富美... 想想是不是觉得有点小心机呢？</p>

        </article>
        <div class="comments-wrap">
          <div class="share-comments">
            

            

            
          </div>
        </div><!-- end comments wrap -->
        <p class="meta post-nav">
          
          <a class="basic-alignment left" href="17280327574437.html"
            title="Previous Post: 【前端工程化】篇五 未来已来-Babel">&laquo; 【前端工程化】篇五 未来已来-Babel</a>
          
          
          <a class="basic-alignment right" href="17280326211130.html" title="Next Post: 【前端工程化】篇三 席卷八荒-Webpack（基础）">【前端工程化】篇三 席卷八荒-Webpack（基础） &raquo;</a>
          
        </p>
      </div>
    </div><!-- end columns -->
  </div><!-- end container -->

  <div class="toc-widget">
    <div id="toc-content"></div>
  </div>
</section>
<style>
  .post-nav{
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  .toc-widget {
    overflow-y: auto;
    position: fixed;
    right: 0;
    top: 180px;
    margin: 20px 0 0 0;
    padding: 20px;
    transition: top .5s ease;
    max-width: 300px;
    overflow-x: hidden;
  }

  .toc-widget.toc-fixed {
    top: 0;
  }

  @media (max-width: 991px) {
    .toc-widget {
      display: none !important;
    }
  }

  .toc-widget .toc-list {
    overflow: hidden;
    position: relative
  }

  .toc-widget .toc-list li {
    list-style: none
  }

  .toc-list {
    margin: 0;
    padding-left: 24px
  }

  a.toc-link {
    color: currentColor;
    max-width: 20em;
    display: block;
    white-space: nowrap;
  }

  .is-collapsible {
    max-height: 1000px;
    overflow: hidden;
    transition: all 300ms ease-in-out
  }

  .is-collapsed {
    max-height: 0
  }

  .is-position-fixed {
    position: fixed !important;
    top: 0
  }

  .is-active-link {
    font-weight: 700
  }

  .toc-link::before {
    background-color: #EEE;
    content: ' ';
    display: inline-block;
    height: inherit;
    left: 0;
    margin-top: -1px;
    position: absolute;
    width: 2px
  }

  .is-active-link::before {
    background-color: #54BC4B
  }
</style>
<script src="asset/tocbot.min.js"></script>
<script>
  // 获取窗口高度
  function getWindowHeight() {
    return window.innerHeight || document.documentElement.clientHeight || document.body.clientHeight;
  }
  let offsetHeight = getWindowHeight() * 0.4 - 45;
  tocbot.init({
    tocSelector: '#toc-content',
    contentSelector: '.markdown-body',
    headingsOffset: -offsetHeight,
    // headingsOffset: -205,
    headingSelector: 'h1,h2,h3' //**
  });

  // 修改TOC链接的href
  let tocHeading = 'toc-heading-';
  var tocLinks = document.querySelectorAll('#toc-content a');
  for (var i = 0; i < tocLinks.length; i++) {
    tocLinks[i].setAttribute('href', '#' + tocHeading + (i + 1));
  }

  // 修改标题的id
  var headings = document.querySelectorAll('.markdown-body h1, .markdown-body h2, .markdown-body h3');
  for (var i = 0; i < headings.length; i++) {
    headings[i].setAttribute('id', tocHeading + (i + 1));
  }

  // 设置滚动TOC固定
  var tocWidget = document.querySelector('.toc-widget');
  var tocHeight = parseInt(offsetHeight);
  window.addEventListener('scroll', function () {
    var scroll = window.scrollY || document.documentElement.scrollTop || document.body.scrollTop;
    if (scroll > tocHeight) {
      tocWidget.classList.add('toc-fixed');
    } else {
      tocWidget.classList.remove('toc-fixed');
    }
  });
</script>    <footer class="footer">
        <div class="content has-text-centered">
          <p>
            Powered by <a href="https://zh.mweb.im/" target="_blank" title="Gridea"><span>MWeb</span></a>
            
            . 版权所有：<a href="https://beian.miit.gov.cn/" target="_blank"><span>蜀ICP备2023018303号-1</span></a> .
            
          </p>
        </div>
      </footer>

<script>(n=>{"use strict";let s,r,e;const l=["cdn.jsdelivr.net","fastly.jsdelivr.net","gcore.jsdelivr.net","cdn.zenless.top","testingcf.jsdelivr.net"],t="//",i=l[0],o=Date.now(),a=2e3,c="jsdelivr-auto-fallback",f="/gh/PipecraftNet/jsdelivr-auto-fallback@main/empty.css?",d=e=>e&&e.includes(t+i),m=e=>e.replace(t+i,t+s),u=window.setTimeout,v=n.querySelectorAll.bind(n),b=()=>{let e,t;for(e of v('link[rel="stylesheet"]'))t=e.href,d(t)&&!t.includes(f)&&(e.href=m(t));for(e of v("script"))if(t=e.src,d(t)){const s=n.createElement("script");s.src=m(t),e.defer=!0,e.src="",e.before(s),e.remove()}for(e of v("img"))t=e.src,d(t)&&(e.src="",e.src=m(t));for(e of v("*[style]"))t=e.getAttribute("style"),d(t)&&e.setAttribute("style",m(t));for(e of v("style"))t=e.innerHTML,d(t)&&(e.innerHTML=m(t))},h=()=>{!e&&r&&s&&(console.warn(i+" is not available. Use "+s),e=!0,u(b,0),u(b,20),setInterval(b,500))},g=(()=>{try{return Object.assign({},JSON.parse(localStorage.getItem(c)||"{}"))}catch{return{}}})(),y=()=>{g.time=o,g.failed=!1,g.fastNode=null;for(const t of l)((e,t)=>{let s;const r=n.createElement("link"),l=e=>{s&&(clearTimeout(s),s=0,e||(r.href="data:text/css;base64,"),r.remove(),t(e))};s=u(l,a),r.addEventListener("error",()=>l(!1)),r.addEventListener("load",()=>l(!0)),r.rel="stylesheet",r.text="text/css",r.href=e+f+o,n.head.insertAdjacentElement("afterbegin",r)})("https://"+t,e=>{e||t!==i||(r=!0,g.failed=!0),e&&!s&&(s=t),e&&!g.fastNode&&(g.fastNode=t),h()});u(()=>{r&&!s&&(s=l[1],h()),localStorage.setItem(c,JSON.stringify(g))},a+100)};if(g.time&&o-g.time<36e5&&g.failed&&g.fastNode)r=!0,s=g.fastNode,h(),u(y,1e3);else if(n.head)y();else{const j=new MutationObserver(()=>{n.head&&(j.disconnect(),y())});j.observe(n,{childList:!0,subtree:!0})}})(document);</script>
<style>.mweb-charts{background:#fff;}
body{ box-sizing: border-box;
    margin: 0 auto;}
@media print{
    pre, code, pre code {
     overflow: visible !important;
     white-space: pre-wrap !important;       /* css-3 */
     white-space: -moz-pre-wrap !important;  /* Mozilla, since 1999 */
     white-space: -pre-wrap !important;      /* Opera 4-6 */
     white-space: -o-pre-wrap !important;    /* Opera 7 */
     word-wrap: break-word !important;       /* Internet Explorer 5.5+ */
    }
    html,body{margin:0;padding:4px;}
}



div.code-toolbar {
  position: relative;
}

div.code-toolbar > .toolbar {
  position: absolute;
  z-index: 10;
  top: .3em;
  right: .2em;
  transition: opacity 0.3s ease-in-out;
  opacity: 0;
}

div.code-toolbar:hover > .toolbar {
  opacity: 1;
}

/* Separate line b/c rules are thrown out if selector is invalid.
   IE11 and old Edge versions don't support :focus-within. */
div.code-toolbar:focus-within > .toolbar {
  opacity: 1;
}

div.code-toolbar > .toolbar > .toolbar-item {
  display: inline-block;
}

div.code-toolbar > .toolbar > .toolbar-item > a {
  cursor: pointer;
}

div.code-toolbar > .toolbar > .toolbar-item > button {
  background: none;
  border: 0;
  color: inherit;
  font: inherit;
  line-height: normal;
  overflow: visible;
  padding: 0;
  -webkit-user-select: none; /* for button */
  -moz-user-select: none;
  -ms-user-select: none;
}

div.code-toolbar > .toolbar > .toolbar-item > a,
div.code-toolbar > .toolbar > .toolbar-item > button,
div.code-toolbar > .toolbar > .toolbar-item > span {
  color: inherit;
  font-size: .8em;
  padding: 4px .5em;
  background: #f5f2f0;
  background: rgba(224, 224, 224, 0.4);
  box-shadow: 0 2px 0 0 rgba(0,0,0,0.2);
  border-radius: .5em;
}

div.code-toolbar > .toolbar > .toolbar-item > a:hover,
div.code-toolbar > .toolbar > .toolbar-item > a:focus,
div.code-toolbar > .toolbar > .toolbar-item > button:hover,
div.code-toolbar > .toolbar > .toolbar-item > button:focus,
div.code-toolbar > .toolbar > .toolbar-item > span:hover,
div.code-toolbar > .toolbar > .toolbar-item > span:focus {
  color: inherit;
  text-decoration: none;
}
</style><script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/prism.min.js"></script><script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/line-numbers/prism-line-numbers.min.js"></script><script>!function(){if("undefined"!=typeof Prism&&"undefined"!=typeof document){var e=[],t={},n=function(){};Prism.plugins.toolbar={};var a=Prism.plugins.toolbar.registerButton=function(n,a){var r;r="function"==typeof a?a:function(e){var t;return"function"==typeof a.onClick?((t=document.createElement("button")).type="button",t.addEventListener("click",(function(){a.onClick.call(this,e)}))):"string"==typeof a.url?(t=document.createElement("a")).href=a.url:t=document.createElement("span"),a.className&&t.classList.add(a.className),t.textContent=a.text,t},n in t?console.warn('There is a button with the key "'+n+'" registered already.'):e.push(t[n]=r)},r=Prism.plugins.toolbar.hook=function(a){var r=a.element.parentNode;var l=a.element.classList;if(l.contains('language-mermaid') || l.contains('language-echarts') || l.contains('language-plantuml')){return;} if(r&&/pre/i.test(r.nodeName)&&!r.parentNode.classList.contains("code-toolbar")){var o=document.createElement("div");o.classList.add("code-toolbar"),r.parentNode.insertBefore(o,r),o.appendChild(r);var i=document.createElement("div");i.classList.add("toolbar");var l=e,d=function(e){for(;e;){var t=e.getAttribute("data-toolbar-order");if(null!=t)return(t=t.trim()).length?t.split(/\s*,\s*/g):[];e=e.parentElement}}(a.element);d&&(l=d.map((function(e){return t[e]||n}))),l.forEach((function(e){var t=e(a);if(t){var n=document.createElement("div");n.classList.add("toolbar-item"),n.appendChild(t),i.appendChild(n)}})),o.appendChild(i)}};a("label",(function(e){var t=e.element.parentNode;if(t&&/pre/i.test(t.nodeName)&&t.hasAttribute("data-label")){var n,a,r=t.getAttribute("data-label");try{a=document.querySelector("template#"+r)}catch(e){}return a?n=a.content:(t.hasAttribute("data-url")?(n=document.createElement("a")).href=t.getAttribute("data-url"):n=document.createElement("span"),n.textContent=r),n}})),Prism.hooks.add("complete",r)}}();</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/toolbar/prism-toolbar.min.css"><script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/copy-to-clipboard/prism-copy-to-clipboard.min.js"></script><script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script><style>div.code-toolbar > .toolbar > .toolbar-item > a, div.code-toolbar > .toolbar > .toolbar-item > button, div.code-toolbar > .toolbar > .toolbar-item > span {padding: 4px .5em; background: #f5f2f0; background: rgba(224, 224, 224, 0.4);}</style><script>window.MathJax = {     tex: { tags: 'ams', displayMath: [ ['\\[', '\\]'] ] } ,     startup: {     pageReady() {       return MathJax.startup.defaultPageReady().then(function () {          window.mweb_mathjax_ready_val = 'yes';          if(window.mweb_mathjax_ready !== undefined){ mweb_mathjax_ready(); }       });     }   }};document.addEventListener('DOMContentLoaded', function(event) {    if (typeof Prism != 'undefined') {         Prism.highlightAll();     }});window.mweb_mathjax_ready_val = '';function theMWebMathJaxRenderIsReady(key){ return window.mweb_mathjax_ready_val; }</script><script>window.MathJax = { tex: { tags: 'ams', displayMath: [ ['\\[', '\\]'] ] } }; </script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js"></script>







<!-- 宠物 -->
<canvas id="live2dcanvas" width="200" height="400" class="live2d"></canvas>
<style>
  #live2dcanvas {
    position: fixed;
    right: 0px;
    z-index: 999;
    pointer-events: none;
    bottom: -40px;
    width: 200px;
    height: 400px;
  }

  @media (max-width: 768px) {
    #live2dcanvas {
      width: 150px;
      height: 300px;
    }
  }

  @media (max-width: 639px) {
    #live2dcanvas {
      display: none !important;
    }
  }
</style>
<script src="asset/L2Dwidget.min.js"></script>
<script>
  //初始化小人物 需设置属性pluginRootPath: "live2dw/"指明资源跟路径
  L2Dwidget.init({
    pluginRootPath: "media/",//资源root路径
    pluginJsPath: "scripts/",//js相对root的路径
    pluginModelPath: "model/",//模型相对root的路径
    tagMode: !1,
    debug: !1,
    model: {
      scale: 2,
      jsonPath: "asset/live2d-widget-model-epsilon/Epsilon2.1.model.json"
    },
    display: {//大小位置什么的自己慢慢调就是了
      position: "right",//定位
      width: 130,//宽度
      height: 210,//高度
      hOffset: -40,//左右
      vOffset: 0//上下
    },
    mobile: {
      show: !1
    },
    log: !1
  });
</script>
  </body>
</html>
